(()=>{var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\u2026":"&hellip;"};function w(c){return f[c]||c}function d(c){return c.replace(/[&<>"]/g,w)}function T(c){return c.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}var g=class p{data;form;input;list;resultTitle;resultTitleTemplate;constructor({form:t,input:r,list:e,resultTitle:l,resultTitleTemplate:i}){this.form=t,this.input=r,this.list=e,this.resultTitle=l,this.resultTitleTemplate=i,this.handleQueryString(),this.bindQueryStringChange(),this.bindSearchForm()}static processMatches(t,r,e=!0,l=140,i=20){r.sort((n,a)=>n.start-a.start);let h=0,s=0,o=0,u=[];for(;h<r.length;){let n=r[h];e&&n.start-i>s?(u.push(`${d(t.substring(s,s+i))} [...] `),u.push(`${d(t.substring(n.start-i,n.start))}`),o+=i*2):(u.push(d(t.substring(s,n.start))),o+=n.start-s);let a=h+1,m=n.end;for(;a<r.length&&r[a].start<=m;)m=Math.max(r[a].end,m),++a;if(u.push(`<mark>${d(t.substring(n.start,m))}</mark>`),o+=m-n.start,h=a,s=m,e&&o>l)break}if(s<t.length){let n=t.length;e&&(n=Math.min(n,s+i)),u.push(`${d(t.substring(s,n))}`),e&&n!=t.length&&u.push(" [...]")}return u.join("")}async searchKeywords(t){let r=await this.getData(),e=[],l=new RegExp(t.filter((i,h,s)=>(s[h]=T(i),i.trim()!=="")).join("|"),"gi");for(let i of r){let h=[],s=[],o={...i,preview:"",matchCount:0},u=i.content.matchAll(l);for(let a of Array.from(u))s.push({start:a.index,end:a.index+a[0].length});let n=i.title.matchAll(l);for(let a of Array.from(n))h.push({start:a.index,end:a.index+a[0].length});h.length>0&&(o.title=p.processMatches(o.title,h,!1)),s.length>0?o.preview=p.processMatches(o.content,s):o.preview=d(o.content.substring(0,140)),o.matchCount=h.length+s.length,o.matchCount>0&&e.push(o)}return e.sort((i,h)=>h.matchCount-i.matchCount)}async doSearch(t){let r=performance.now(),e=await this.searchKeywords(t);this.clear();for(let i of e)this.list.append(p.render(i));let l=performance.now();this.resultTitle.innerText=this.generateResultTitle(e.length,((l-r)/1e3).toPrecision(1))}generateResultTitle(t,r){return this.resultTitleTemplate.replace("#PAGES_COUNT",t).replace("#TIME_SECONDS",r)}async getData(){if(!this.data){let t=this.form.dataset.json;this.data=await fetch(t).then(e=>e.json());let r=new DOMParser;for(let e of this.data)e.content=r.parseFromString(e.content,"text/html").body.innerText}return this.data}bindSearchForm(){let t="",r=e=>{e.preventDefault();let l=this.input.value.trim();if(p.updateQueryString(l,!0),l==="")return this.clear();t!==l&&(t=l,this.doSearch(l.split(" ")))};this.input.addEventListener("input",r),this.input.addEventListener("compositionend",r)}clear(){this.list.innerHTML="",this.resultTitle.innerText=""}bindQueryStringChange(){window.addEventListener("popstate",t=>{this.handleQueryString()})}handleQueryString(){let t=new URL(window.location.toString()).searchParams.get("keyword");this.input.value=t,t?this.doSearch(t.split(" ")):this.clear()}static updateQueryString(t,r=!1){let e=new URL(window.location.toString());t===""?e.searchParams.delete("keyword"):e.searchParams.set("keyword",t),r?window.history.replaceState("","",e.toString()):window.history.pushState("","",e.toString())}static render(t){return createElement("article",null,createElement("a",{href:t.permalink},createElement("div",{class:"article-details"},createElement("h2",{class:"article-title",dangerouslySetInnerHTML:{__html:t.title}}),createElement("section",{class:"article-preview",dangerouslySetInnerHTML:{__html:t.preview}})),t.image&&createElement("div",{class:"article-image"},createElement("img",{src:t.image,loading:"lazy"}))))}};window.addEventListener("load",()=>{setTimeout(function(){let c=document.querySelector(".search-form"),t=c.querySelector("input"),r=document.querySelector(".search-result--list"),e=document.querySelector(".search-result--title");new g({form:c,input:t,list:r,resultTitle:e,resultTitleTemplate:window.searchResultTitleTemplate})},0)});var S=g})();
