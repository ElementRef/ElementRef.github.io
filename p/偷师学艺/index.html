<!DOCTYPE html><html lang="zh-cn" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="monorepo 公司的主要业务是混合云管，所以除了官网这种 ToC 的项目之外，其余均是 ToB 的管理后台项目；根据具体业务分为了：容器服务、镜像管理、服务商监控、应用管理等等。这些子项目有统一的 UI 风格、相近的交互逻辑、耦合的业务逻辑；所以非常适合 monorepo 的项目管理方式。
"><title>偷“师”学“艺” · I AM BEA, I DRINK TEA</title>
<link rel="canonical" href="https://ElementRef.github.io/p/%E5%81%B7%E5%B8%88%E5%AD%A6%E8%89%BA/"><link rel="stylesheet" href="/scss/style.min.e3ada81a20a36442eda74d5f51c493f0cd2a5917209f79dbc224fe2348d41d2e.css"><meta property="og:title" content="偷“师”学“艺”"><meta property="og:description" content="monorepo 公司的主要业务是混合云管，所以除了官网这种 ToC 的项目之外，其余均是 ToB 的管理后台项目；根据具体业务分为了：容器服务、镜像管理、服务商监控、应用管理等等。这些子项目有统一的 UI 风格、相近的交互逻辑、耦合的业务逻辑；所以非常适合 monorepo 的项目管理方式。
"><meta property="og:url" content="https://ElementRef.github.io/p/%E5%81%B7%E5%B8%88%E5%AD%A6%E8%89%BA/"><meta property="og:site_name" content="馬腊咯稽"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2021-07-19T00:00:00+00:00"><meta property="article:modified_time" content="2021-07-19T00:00:00+00:00"><meta property="og:image" content="https://ElementRef.github.io/img/cover/engineering.png"><meta name="twitter:title" content="偷“师”学“艺”"><meta name="twitter:description" content="monorepo 公司的主要业务是混合云管，所以除了官网这种 ToC 的项目之外，其余均是 ToB 的管理后台项目；根据具体业务分为了：容器服务、镜像管理、服务商监控、应用管理等等。这些子项目有统一的 UI 风格、相近的交互逻辑、耦合的业务逻辑；所以非常适合 monorepo 的项目管理方式。
"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://ElementRef.github.io/img/cover/engineering.png"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><meta name="robots" content="noarchive, noindex, nofollow"><meta name="theme-color" content="#ffffff"><script defer="" src="https://umami.pavilion0321907.workers.dev/elementref.js" data-website-id="87868be0-a9cf-4f8c-8fee-e3cbb99e6cf2"></script></head><body class="article-page"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
<span class="hamburger-box"><span class="hamburger-inner"></span></span></button><header><figure class="site-avatar"><a href="/"><img src="/img/avatar_hu7590466716559688570.webp" width="300" height="404" class="site-logo" alt="Avatar" fetchpriority="high" decoding="async"></a></figure><div class="site-meta"><h1 class="site-name"><a href="/">馬腊咯稽</a></h1><h2 class="site-description">I AM BEA, I DRINK TEA</h2></div></header><ol class="social-menu"><li><a href="https://space.bilibili.com/593541941" target="_blank" title="Bilibili"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M3 10a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7a4 4 0 01-4-4v-6z"></path><path d="M8 3l2 3"></path><path d="M16 3l-2 3"></path><path d="M9 13v-2"></path><path d="M15 11v2"></path></svg></a></li><li><a href="https://x.com/SpiciComic" target="_blank" title="Twitter"><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"></path></svg></a></li><li><a href="https://github.com/ElementRef" target="_blank" title="GitHub"><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"></path></svg></a></li><li><a href="https://m.weibo.cn/u/6447635754" target="_blank" title="Weibo"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-weibo"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M19 14.127C19 17.2 15.498 20 11 20c-4.126.0-8-2.224-8-5.565.0-1.78.984-3.737 2.7-5.567 2.362-2.51 5.193-3.687 6.551-2.238.415.44.752 1.39.749 2.062 2-1.615 4.308.387 3.5 2.693 1.26.557 2.5.538 2.5 2.742z"></path><path d="M15 4h1a5 5 0 015 5v1"></path></svg></a></li><li><a href="https://last.fm/zh/user/SpiciComic/listening-report" target="_blank" title="Last.fm"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-lastfm"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M20 8c-.83-1-1.388-1-2-1-.612.0-2 .271-2 2s1.384 2.233 3 3 2.125 1.812 2 3-1 2-3 2-3-1-3.5-2-1.585-4.78-2.497-6a5 5 0 10-1 7"></path></svg></a></li></ol><ol class="menu" id="main-menu"><li><a href="/"><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><polyline points="5 12 3 12 12 3 21 12 19 12"></polyline><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"></path></svg>
<span>首页</span></a></li><li><a href="/archives/"><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><rect x="3" y="4" width="18" height="4" rx="2"></rect><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"></path><line x1="10" y1="12" x2="14" y2="12"></line></svg>
<span>归档</span></a></li><li><a href="/search/"><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="10" cy="10" r="7"></circle><line x1="21" y1="21" x2="15" y2="15"></line></svg>
<span>搜索</span></a></li><li><a href="/%E5%90%AF%E5%8F%91/"><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"></path><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"></path></svg>
<span>启发</span></a></li><li><a href="/%E5%91%BD%E4%BB%A4/"><svg class="icon icon-tabler icon-tabler-terminal" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 7l5 5-5 5"></path><line x1="12" y1="19" x2="19" y2="19"></line></svg>
<span>命令</span></a></li><li><a href="/index.xml" target="_blank"><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="5" cy="19" r="1"></circle><path d="M4 4a16 16 0 0116 16"></path><path d="M4 11a9 9 0 019 9"></path></svg>
<span>订阅</span></a></li><li><a href="/%E5%85%B3%E4%BA%8E/"><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"></path></svg>
<span>关于</span></a></li><div class="menu-bottom-section"><li id="dark-mode-toggle"><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="8" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="16" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<span>深色</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class="article-header"><div class="article-image"><a href="/p/%E5%81%B7%E5%B8%88%E5%AD%A6%E8%89%BA/"><img src="/img/cover/engineering.webp" alt="偷“师”学“艺”" fetchpriority="high" decoding="async" width="1998" height="1200" srcset="/img/cover/engineering.webp 1998w, /img/cover/engineering@1398w.webp 1398w, /img/cover/engineering@1098w.webp 1098w, /img/cover/engineering@798w.webp 798w" sizes="100vw"></a></div><div class="article-details"><header class="article-category"><a href="/categories/%E5%B7%A5%E7%A8%8B%E5%8C%96/">工程化</a></header><div class="article-title-wrapper"><h2 class="article-title"><a href="/p/%E5%81%B7%E5%B8%88%E5%AD%A6%E8%89%BA/">偷“师”学“艺”</a></h2></div><footer class="article-time"><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"></path><circle cx="18" cy="18" r="4"></circle><path d="M15 3v4"></path><path d="M7 3v4"></path><path d="M3 11h16"></path><path d="M18 16.496V18l1 1"></path></svg>
<time class="article-time--published">Jul 19, 2021</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
<time class="article-time--reading">阅读时长：10 分钟</time></div></footer></div></header><section class="article-content"><h2 id="monorepo">monorepo</h2><p>公司的主要业务是混合云管，所以除了官网这种 ToC 的项目之外，其余均是 ToB 的管理后台项目；根据具体业务分为了：容器服务、镜像管理、服务商监控、应用管理等等。这些子项目有统一的 UI 风格、相近的交互逻辑、耦合的业务逻辑；所以非常适合 monorepo 的项目管理方式。</p><p>Lerna 是前端 monorepo 比较好的解决方案，搭配 yarn 可以非常好的管理项目外部与项目之间的依赖。每个项目都是一个独立的 package，每个 package 都有自己的 workspace，可以将自己的 APIs 通过 lib 暴露并 publish 到内部 npm 仓库，这样每个 package 既是独立的项目也是其他 package 的依赖。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="c1">// lerna.json
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"packages"</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"packages/@cli/*"</span><span class="p">,</span> <span class="c1">// 脚手架依赖，放置 linters 规则和配置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s2">"packages/@common/*"</span><span class="p">,</span> <span class="c1">// 公共依赖，放置工具函数和组件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s2">"packages/@project/*"</span> <span class="c1">// 业务代码，放置具体的业务实现
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"version"</span><span class="p">:</span> <span class="s2">"independent"</span><span class="p">,</span> <span class="c1">// 独立模式，每个 package 有独立的版本号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">"useWorkspaces"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 启用 workspace 模式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">"npmClient"</span><span class="p">:</span> <span class="s2">"yarn"</span><span class="p">,</span> <span class="c1">// 使用 yarn 取代 npm
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">"command"</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"publish"</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">"ignoreChanges"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"ignored-file"</span><span class="p">,</span> <span class="s2">"*.temp"</span><span class="p">,</span> <span class="s2">"*.md"</span><span class="p">],</span> <span class="c1">// 不会包含在更改/发布中的文件，防止为不必要地更改发布新版本，例如修复 ReadMe 拼写错误
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"chore(release): publish"</span><span class="p">,</span> <span class="c1">// 发布新版本时，自定义的提交消息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nt">"registry"</span><span class="p">:</span> <span class="s2">"https://npm.pkg.github.com"</span><span class="p">,</span> <span class="c1">// 包发在哪里，一般是公司内部的 npm 服务器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nt">"conventionalCommits"</span><span class="p">:</span> <span class="kc">true</span> <span class="c1">// 自动生成 ChangeLog
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"bootstrap"</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">"ignore"</span><span class="p">:</span> <span class="s2">"component-*"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">"npmClientArgs"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"--no-package-lock"</span><span class="p">,</span> <span class="s2">"--production"</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// package.json
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"lerna"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"private"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"workspaces"</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"packages/@cli/*"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"packages/@common/*"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"packages/@project/*"</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>Lerna 两种模式：</p><ul><li>固定模式，项目统一单个版本（所有的包使用一个版本号，Babel 使用的这种模式），版本信息保存在根目录下的 lerna.json 中；如果主版本号为 0，任何更新都将被视为不兼容更新；</li><li>独立模式，每个包的版本号是独立的（公司使用的这种模式，因为每个包是一个独立的项目、不是一个完整功能的一部分）；发包时，需要指定此次更新的粒度（修复、小版本、大版本？）。</li></ul><p>Lerna 常用命令：</p><ul><li>lerna init 创建/升级为 Lerna 仓库；<ul><li>–independent/-i 使用独立的版本控制模式</li></ul></li><li>lerna bootstrap 进入引导流程，安装所有依赖并链接交叉依赖；</li><li>lerna create [name] [loc] 创建新的包，名字为 name，位置在 loc；</li><li>lerna import [pathToRepo] 导入本地路径中的 repo 并提交 commit；</li><li>lerna exec – [command] [..args] 对每个包中执行任意命令；<ul><li>– rm -rf ./node_modules 删除每个包下的 node_modules</li></ul></li><li>lerna publish 发布自上次发布之后有更新的包（private 为 true 的除外），提示“输入新版本号”并更新 git 和 npm 上的所有包；<ul><li>–force-publish [packages] 强制发布“一个、多个（以逗号分隔）或全部（*）”软件包</li><li>–npm-tag [tagname] — 使用给定的 npm dist-tag（默认 latest）发布到 npm</li><li>–canary/-c 创建一个 canary 版本</li><li>–skip-git 不运行 git 命令</li></ul></li><li>lerna changed 检查自上次发布以来哪些软件包被修改过；</li><li>lerna clean 移除所有包的 node_modules 目录（不会移除根目录的 node_modules，即使加上 –hoist 参数）；</li><li>lerna diff [package?] 列出所有或某个软件包自上次发布以来的修改情况；</li><li>lerna info 打印本地环境信息；</li><li>lerna run [script] 在每一个包含 [script] 脚本的包中运行此 NpmScript；<ul><li>lerna run build–concurrency 5 对所有包进行打包，最大并行数为 5</li></ul></li><li>lerna list/ls 列出当前 Lerna 仓库中的所有公共软件包；<ul><li>–json 以 Array JSON 的形式输出</li><li>–ndjson 以 Newline Delimited JSON 的形式输出</li><li>–all 列出 private 为 true 的包（默认不输出）</li><li>–long 展示更多信息</li><li>–parseable 展示可解析输出，而不是列化视图</li><li>–toposort 按拓扑顺序进行排序输出</li><li>–graph 以图的形式输出</li></ul></li><li>lerna link 为所有依赖彼此的包软连接在一起。<ul><li>lerna link convert 将公用的 devDependencies 放到根目录的 package.json</li></ul></li></ul><h2 id="commit">commit</h2><p>对于需要多人维护的复杂项目，相同的代码样式和具体的提交信息是必要的；借助 husky 和 lint-staged（相似的工具还有 pretty-quick，不过只能调用 Prettier，不能调用 Lints），可以对待提交的文件进行校验、格式化，也可以对 commit message 进行约束。</p><h3 id="提交工作流钩子">提交工作流钩子</h3><ul><li>pre-commit：在提交信息前运行；它用于检查即将提交的快照；例如，检查是否有所遗漏，确保测试运行，以及核查代码；不过你可以用 git commit –no-verify 来绕过这个环节。你可以利用该钩子来检查代码风格是否一致（运行类似 lint 的程序）等；</li><li>prepare-commit-msg：在启动提交信息编辑器之前，默认信息被创建之后运行；它允许你编辑提交者所看到的默认信息。它对一般的提交来说并没有什么用；然而对那些会自动产生默认信息的提交，如提交信息模板、合并提交、压缩提交和修订提交等非常实用；</li><li>commit-msg：接收一个参数（存有当前提交信息的临时文件的路径）。可以用来在提交通过前验证项目状态或提交信息；</li><li>post-commit：在整个提交过程完成后运行；该钩子一般用于通知之类的事情。</li></ul><h3 id="workspace-信息">workspace 信息</h3><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">execSync</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'child_process'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 将 yarn workspaces info 输出为对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getWorkspacesInfo</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">yarnStdout</span> <span class="o">=</span> <span class="nx">execSync</span><span class="p">(</span><span class="s1">'yarn workspaces info'</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">encoding</span><span class="o">:</span> <span class="s1">'utf8'</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^yarn workspaces.*$/m</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^Done.*$/m</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">temp</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">yarnStdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="sb">`执行 yarn workspaces info 命令时出错，具体如下：\n</span><span class="si">${</span><span class="nx">error</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">temp</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">'[object Object]'</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">getWorkspaces</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">temp</span> <span class="o">=</span> <span class="nx">getWorkspacesInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`获取不到 workspaces 信息。\n</span><span class="si">${</span><span class="nx">error</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">temp</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">'[object Object]'</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">temp</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">name</span> <span class="p">=&gt;</span> <span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="p">...</span><span class="nx">temp</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="p">}));</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">getWorkspacesName</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">temp</span> <span class="o">=</span> <span class="nx">getWorkspacesInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`获取不到 workspaces name 信息。\n</span><span class="si">${</span><span class="nx">error</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">temp</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">'[object Object]'</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">temp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">getWorkspaces</span> <span class="o">=</span> <span class="nx">getWorkspaces</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">getWorkspacesInfo</span> <span class="o">=</span> <span class="nx">getWorkspacesInfo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">getWorkspacesName</span> <span class="o">=</span> <span class="nx">getWorkspacesName</span><span class="p">;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="git-信息">git 信息</h3><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">execSync</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'child_process'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">getWorkspacesName</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./workspace'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 获取当前所在 git 分支
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getCurrentBranch</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">gitStatus</span> <span class="o">=</span> <span class="nx">execSync</span><span class="p">(</span><span class="s1">'git status'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">encoding</span><span class="o">:</span> <span class="s1">'utf8'</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">gitStatus</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'On branch '</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`执行 git 命令时出错，具体如下：\n</span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">getCommitScopes</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nx">getWorkspacesName</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">temp</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">temp</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">name</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">'@'</span> <span class="o">?</span> <span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="nx">name</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">getCurrentBranch</span> <span class="o">=</span> <span class="nx">getCurrentBranch</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">getCommitScopes</span> <span class="o">=</span> <span class="nx">getCommitScopes</span><span class="p">;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="stylelint-配置">stylelint 配置</h3><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">defaultSeverity</span><span class="o">:</span> <span class="s1">'error'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kr">extends</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'stylelint-config-standard'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'stylelint-config-rational-order'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'stylelint-config-prettier'</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ignoreDisables</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ignoreFiles</span><span class="o">:</span> <span class="p">[</span><span class="s1">'**/*.json'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'stylelint-declaration-block-no-ignored-properties'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'stylelint-declaration-strict-value'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'stylelint-scss'</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rules</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'at-rule-no-unknown'</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'scss/at-rule-no-unknown'</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'plugin/declaration-block-no-ignored-properties'</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'scale-unlimited/declaration-strict-value'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="s1">'/color$/'</span><span class="p">,</span> <span class="s1">'z-index'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ignoreKeywords</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s1">'/color$/'</span><span class="o">:</span> <span class="p">[</span><span class="s1">'currentColor'</span><span class="p">,</span> <span class="s1">'inherit'</span><span class="p">,</span> <span class="s1">'transparent'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="s1">'z-index'</span><span class="o">:</span> <span class="p">[</span><span class="s1">'auto'</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">disableFix</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="eslint-配置">eslint 配置</h3><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">globals</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">__PRERENDER__INJECTED__</span><span class="o">:</span> <span class="s1">'readonly'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">__PROJECT__</span><span class="o">:</span> <span class="s1">'readonly'</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">env</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">browser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">node</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="kr">extends</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'airbnb-base'</span><span class="p">,</span> <span class="c1">// 剔除 react 规则 的 eslint-config-airbnb
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'plugin:vue/essential'</span><span class="p">,</span> <span class="c1">// vue 2.x 规则
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'plugin:promise/recommended'</span><span class="p">,</span> <span class="c1">// promise 规则
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'plugin:markdown/recommended'</span><span class="p">,</span> <span class="c1">// markdown 规则
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'plugin:prettier/recommended'</span> <span class="c1">// prettier 冲突规则
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="s1">'html'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">root</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 根配置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">rules</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'import/prefer-default-export'</span><span class="o">:</span> <span class="s1">'off'</span><span class="p">,</span> <span class="c1">// 不强制使用默认导出
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'no-param-reassign'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'error'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">props</span><span class="o">:</span> <span class="kc">false</span> <span class="c1">// 禁止对函数参数进行重新赋值，形参属性除外
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'no-plusplus'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'error'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">allowForLoopAfterthoughts</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// 允许在 for 循环中使用 ++
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'no-restricted-syntax'</span><span class="o">:</span> <span class="p">[</span><span class="s1">'error'</span><span class="p">,</span> <span class="s1">'WithStatement'</span><span class="p">],</span> <span class="c1">// 可以使用函数表达式和 in 操作符号，不能用 with
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'no-shadow'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'error'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">allow</span><span class="o">:</span> <span class="p">[</span><span class="s1">'state'</span><span class="p">,</span> <span class="s1">'series'</span><span class="p">]</span> <span class="c1">// 禁止变量声明与外层作用域的变量同名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'no-underscore-dangle'</span><span class="o">:</span> <span class="s1">'off'</span><span class="p">,</span> <span class="c1">// 标识符中可以有下划线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'no-unused-expressions'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'error'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">allowShortCircuit</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// 允许在表达式中使用逻辑短路求值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'no-use-before-define'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'error'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">functions</span><span class="o">:</span> <span class="kc">false</span> <span class="c1">// 禁止在变量定义之前使用它们，函数声明除外
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'prefer-destructuring'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'error'</span><span class="p">,</span> <span class="c1">// 不强制使用数组解构
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">array</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">object</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'promise/always-return'</span><span class="o">:</span> <span class="s1">'off'</span><span class="p">,</span> <span class="c1">// then 方法可以没有返回值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'promise/catch-or-return'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'error'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">allowFinally</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// 允许使用 finally
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'vue/require-default-prop'</span><span class="o">:</span> <span class="s1">'off'</span><span class="p">,</span> <span class="c1">// 不要求 prop 有默认值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'vue/require-prop-types'</span><span class="o">:</span> <span class="s1">'off'</span> <span class="c1">// 不要求必须规定 prop 类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="prettier-配置">prettier 配置</h3><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"arrowParens"</span><span class="p">:</span> <span class="s2">"avoid"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"bracketSpacing"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"embeddedLanguageFormatting"</span><span class="p">:</span> <span class="s2">"auto"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"endOfLine"</span><span class="p">:</span> <span class="s2">"lf"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"htmlWhitespaceSensitivity"</span><span class="p">:</span> <span class="s2">"strict"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"jsxBracketSameLine"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"jsxSingleQuote"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"printWidth"</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"proseWrap"</span><span class="p">:</span> <span class="s2">"preserve"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"quoteProps"</span><span class="p">:</span> <span class="s2">"consistent"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"semi"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"singleQuote"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"tabWidth"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"trailingComma"</span><span class="p">:</span> <span class="s2">"es5"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"useTabs"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"vueIndentScriptAndStyle"</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="husky-配置">husky 配置</h3><p>.husky/commit-msg 钩子：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>. <span class="s2">"</span><span class="k">$(</span>dirname <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="k">)</span><span class="s2">/_/husky.sh"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">npx --no-install commitlint --edit <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>.husky/pre-commit 钩子：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>. <span class="s2">"</span><span class="k">$(</span>dirname <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="k">)</span><span class="s2">/_/husky.sh"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">npx lint-staged
</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="commitlint-配置">commitlint 配置</h3><p>commitlint.rules:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">customSubjectActionEnum</span><span class="p">({</span> <span class="nx">subject</span> <span class="p">},</span> <span class="nx">when</span> <span class="o">=</span> <span class="s1">'never'</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">always</span> <span class="o">=</span> <span class="nx">when</span> <span class="o">===</span> <span class="s1">'always'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">always</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="kc">true</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">typeof</span> <span class="nx">subject</span> <span class="o">!==</span> <span class="s1">'string'</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="k">typeof</span> <span class="nx">subject</span> <span class="o">===</span> <span class="s1">'string'</span> <span class="o">&amp;&amp;</span> <span class="nx">subject</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="kc">false</span><span class="p">,</span> <span class="sb">`提交的简要描述不能为空`</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">subject</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">value</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="nx">action</span> <span class="o">===</span> <span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="sb">`提交的简要描述应该以中文动词加一个空格起头，动词可选值为 [</span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">]，当前值为 '</span><span class="si">${</span><span class="nx">action</span><span class="si">}</span><span class="sb">'`</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">subject</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">action</span><span class="si">}</span><span class="sb"> `</span><span class="p">)</span> <span class="o">||</span> <span class="nx">subject</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">===</span> <span class="s1">' '</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="kc">false</span><span class="p">,</span> <span class="sb">`提交的简要描述中动词后需且仅需添加一个空格`</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">[</span><span class="kc">true</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">customScopeEnum</span><span class="p">({</span> <span class="nx">scope</span> <span class="p">},</span> <span class="nx">when</span> <span class="o">=</span> <span class="s1">'never'</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">always</span> <span class="o">=</span> <span class="nx">when</span> <span class="o">===</span> <span class="s1">'always'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">always</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="kc">true</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="nx">scope</span> <span class="o">===</span> <span class="nx">item</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="sb">`scope 必须为 [</span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">] 其中之一，当前为 </span><span class="si">${</span><span class="nx">scope</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s1">'custom-subject-action-enum'</span><span class="o">:</span> <span class="nx">customSubjectActionEnum</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">'custom-scope-enum'</span><span class="o">:</span> <span class="nx">customScopeEnum</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>commitlint.config:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">getCommitScopes</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./git'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">rules</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./commitlint.rules'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">commitScopes</span> <span class="o">=</span> <span class="nx">getCommitScopes</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * type(scope?): subject
</span></span></span><span class="line"><span class="cl"><span class="cm"> * body?
</span></span></span><span class="line"><span class="cl"><span class="cm"> * footer?
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">extends</span><span class="o">:</span> <span class="p">[</span><span class="s1">'@commitlint/config-conventional'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">rules</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">   * Level-[0.1.2]: 0-disables、1-warning、2-error
</span></span></span><span class="line"><span class="cl"><span class="cm">   * Applicable-always|never: never-inverts the rule
</span></span></span><span class="line"><span class="cl"><span class="cm">   * Value: value to use for this rule
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rules</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'body-full-stop'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'body-leading-blank'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'always'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'body-empty'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'body-max-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'always'</span><span class="p">,</span> <span class="mi">144</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'body-max-line-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'body-min-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'body-case'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'footer-leading-blank'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'always'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'footer-empty'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'footer-max-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'footer-max-line-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'always'</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'footer-min-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'header-case'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'header-full-stop'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'header-max-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'header-min-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'references-empty'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'scope-enum'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'scope-case'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'always'</span><span class="p">,</span> <span class="s1">'lower-case'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'scope-empty'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'never'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'scope-max-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'scope-min-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'subject-case'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'subject-empty'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'never'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'subject-full-stop'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'subject-max-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'subject-min-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'always'</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'type-enum'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'always'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="s1">'build'</span><span class="p">,</span> <span class="s1">'ci'</span><span class="p">,</span> <span class="s1">'feat'</span><span class="p">,</span> <span class="s1">'fix'</span><span class="p">,</span> <span class="s1">'st'</span><span class="p">,</span> <span class="s1">'sit'</span><span class="p">,</span> <span class="s1">'style'</span><span class="p">,</span> <span class="s1">'version'</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'type-case'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'always'</span><span class="p">,</span> <span class="s1">'lower-case'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'type-empty'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'never'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'type-max-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'type-min-length'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'signed-off-by'</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'custom-subject-action-enum'</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'always'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'添加'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'完善'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'修复'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'解决'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'删除'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'禁用'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'修改'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'调整'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'优化'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'重构'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'发布'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'合并'</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'custom-scope-enum'</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'always'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'root'</span><span class="p">,</span> <span class="p">...</span><span class="nx">commitScopes</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="commitizen-配置">commitizen 配置</h3><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">getCommitScopes</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./git'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">scopes</span> <span class="o">=</span> <span class="nx">getCommitScopes</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">subjectLimit</span><span class="o">:</span> <span class="mi">72</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">subjectSeparator</span><span class="o">:</span> <span class="s1">': '</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">typePrefix</span><span class="o">:</span> <span class="s1">''</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">typeSuffix</span><span class="o">:</span> <span class="s1">''</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">scopes</span><span class="o">:</span> <span class="p">[{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">'root'</span> <span class="p">},</span> <span class="p">...</span><span class="nx">scopes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">name</span> <span class="p">=&gt;</span> <span class="p">({</span> <span class="nx">name</span> <span class="p">}))],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">scopeOverrides</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">allowCustomScopes</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">allowBreakingChanges</span><span class="o">:</span> <span class="p">[</span><span class="s1">'feat'</span><span class="p">,</span> <span class="s1">'fix'</span><span class="p">,</span> <span class="s1">'st'</span><span class="p">,</span> <span class="s1">'sit'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">skipQuestions</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">appendBranchNameToCommitMessage</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ticketNumberPrefix: '',
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// breakingPrefix: '',
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// footerPrefix: '',
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">breaklineChar</span><span class="o">:</span> <span class="s1">'|'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">upperCaseSubject</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">askForBreakingChangeFirst</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">types</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s1">'build:     涉及构建系统及与其相关的外部依赖变动'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s1">'build'</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s1">'ci:        涉及 CI 配置文件或脚本修改的变动'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s1">'ci'</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s1">'feat:      增加了新的功能特征，对应 action 只能为“添加”'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s1">'feat'</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s1">'fix:       修复 bug，对应 action 只能为“修复”'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s1">'fix'</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s1">'st:        解决 ST 单子，仅限 release 分支，对应 action 只能为“修复”'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s1">'st'</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s1">'sit:       解决 SIT 单子，仅限 release 分支，对应 action 只能为“修复”'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s1">'sit'</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s1">'style:     不影响代码含义的风格修改，比如空格、格式化、缺失的分号等，对应 action 只能为“调整”'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s1">'style'</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s1">'version:   发布版本，一般由脚本自动化发布，对应 action 只能为“发布”'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s1">'version'</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">messages</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span> <span class="s1">'选择本次更改的提交类型：\n'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">scope</span><span class="o">:</span> <span class="s1">'选择本次更改涉及模块：\n'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subject</span><span class="o">:</span> <span class="s1">'输入针对本次更改的简要说明：\n'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">body</span><span class="o">:</span> <span class="s1">'输入针对本次更改的详细描述（非必须），使用" | "进行换行，每行长度不要超过 72: \n'</span><span class="p">,</span> <span class="c1">// 这里有问题
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">breaking</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'如果本次更改存在不兼容的修改，则须对更改的内容进行详细描述，否则无需填写：\n'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">footer</span><span class="o">:</span> <span class="s1">'列举本次更改对应的 Tapd 缺陷 ID（比如 #31、#34）: \n'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">confirmCommit</span><span class="o">:</span> <span class="s1">'是否使用以上提交信息进行提交？'</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="packagejson-对应配置">package.json 对应配置</h3><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">"lint-staged"</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"**/*.{js,ts,vue,htm,html,md}"</span><span class="o">:</span> <span class="s2">"eslint --format=codeframe"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"**/*.{css,scss,sass,vue}"</span><span class="o">:</span> <span class="s2">"stylelint --formatter verbose"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"**/*"</span><span class="o">:</span> <span class="s2">"prettier --check"</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="s2">"config"</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"commitizen"</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"path"</span><span class="o">:</span> <span class="s2">"cz-customizable"</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="s2">"scripts"</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"commit"</span><span class="o">:</span> <span class="s2">"git add . &amp;&amp; cz"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"format"</span><span class="o">:</span> <span class="s2">"prettier --write ."</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"eslint:fix"</span><span class="o">:</span> <span class="s2">"eslint --fix . --ext .js,.ts,.vue,.htm,.html,.md"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"stylelint:fix"</span><span class="o">:</span> <span class="s2">"stylelint --fix **/*.{css,scss,sass,vue}"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="整个提交流程">整个提交流程</h3><p><img src="/p/%E5%81%B7%E5%B8%88%E5%AD%A6%E8%89%BA/commit-process.svg" loading="lazy" alt="" decoding="async"></p><p>注意：git add . 相比 git add –all，不处理删除文件；仅提交当前目录或者后代目录下的文件。</p><h2 id="verdaccio">verdaccio</h2><p>私有仓库使用 Verdaccio 搭建并使用 pm2 守护（找运维小哥）：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 安装 wget</span>
</span></span><span class="line"><span class="cl">yum install -y wget
</span></span><span class="line"><span class="cl"><span class="c1"># 下载 node</span>
</span></span><span class="line"><span class="cl">wget https://nodejs.org/dist/v10.6.0/node-v10.6.0-linux-x64.tar.xz
</span></span><span class="line"><span class="cl"><span class="c1"># 解压 node</span>
</span></span><span class="line"><span class="cl">tar -xvf node-v10.6.0-linux-x64.tar.xz
</span></span><span class="line"><span class="cl"><span class="c1"># 重命名安装目录</span>
</span></span><span class="line"><span class="cl">mv node-v10.6.0-linux-x64.tar.xz nodejs
</span></span><span class="line"><span class="cl"><span class="c1"># 建立软连接</span>
</span></span><span class="line"><span class="cl">ln -s /usr/local/node/nodejs/bin/npm /usr/local/bin
</span></span><span class="line"><span class="cl">ln -s /usr/local/node/nodejs/bin/node /usr/local/bin
</span></span><span class="line"><span class="cl"><span class="c1"># 安装 verdaccio</span>
</span></span><span class="line"><span class="cl">npm install -g verdaccio
</span></span><span class="line"><span class="cl"><span class="c1"># 建立软连接</span>
</span></span><span class="line"><span class="cl">ln -s /usr/local/node/nodejs/bin/verdaccio /usr/local/bin
</span></span><span class="line"><span class="cl"><span class="c1"># 安装 pm2</span>
</span></span><span class="line"><span class="cl">npm install -g pm2
</span></span><span class="line"><span class="cl"><span class="c1"># 建立软连接</span>
</span></span><span class="line"><span class="cl">ln -s /usr/local/node/nodejs/bin/pm2 /usr/local/bin
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 pm2 运行 verdaccio</span>
</span></span><span class="line"><span class="cl">pm2 start verdaccio
</span></span></code></pre></td></tr></tbody></table></div></div><p>配置 .npmrc、.yarnrc：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">registry "http://npm.inner.com/"</span><span class="w">
</span></span></span></code></pre></td></tr></tbody></table></div></div><p>配置 package.json：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"publishConfig"</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"registry"</span><span class="p">:</span> <span class="s2">"http://npm.inner.com/"</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>安装依赖时，会向私服请求 package，如果找不到，服务器就会向 npmjs.org 请求并缓存。</p><h2 id="request">request</h2><p>后端数据会通过无渲染组件请求，组件通过 props 接受请求参数，再将返回数据通过作用域插槽暴露。</p><p><img src="/p/%E5%81%B7%E5%B8%88%E5%AD%A6%E8%89%BA/request.svg" loading="lazy" alt="" decoding="async"></p><p>RlApiRequest 的 render 函数返回了 $scopedSlots.default(this.cSlotScopeProps)；继承了 RlApiRequest 的组件通过传入不同的 props 和 aSlotScopeProps（会改写 cSlotScopeProps），达到不同的目的。</p><h2 id="pipes">pipes</h2><p>对于数据的处理都会交给管道层，组件通过 props 接受原始数据，处理过的数据通过默认的作用域插槽返回。</p><p><img src="/p/%E5%81%B7%E5%B8%88%E5%AD%A6%E8%89%BA/pipes-renderless.svg" loading="lazy" alt="" decoding="async"></p><p>多个 pipe 共同组成了 pipes 总管道，通过传入 enablePipeFormat、enablePipeFilter 等 props 控制对应管道的开闭；本质上是作用域插槽的应用。</p></section><footer class="article-footer"><section class="article-copyright"><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="12" r="9"></circle><path d="M14.5 9a3.5 4 0 100 6"></path></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class="site-footer"><section class="copyright">©
2017 -
2025
<a href="https://github.com/ElementRef" target="_blank">馬腊咯稽</a></section><section class="powerby">Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>, Deploy by Actions<br>主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.13.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计</section></footer><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title="Share"></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js" integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin="anonymous" defer=""></script><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin="anonymous" defer=""></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css" crossorigin="anonymous"></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class="widget-icon"><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><line x1="5" y1="9" x2="19" y2="9"></line><line x1="5" y1="15" x2="19" y2="15"></line><line x1="11" y1="4" x2="7" y2="20"></line><line x1="17" y1="4" x2="13" y2="20"></line></svg></div><h2 class="widget-title section-title">目录</h2><div class="widget--toc"><nav id="TableOfContents"><ol><li><a href="#monorepo">monorepo</a></li><li><a href="#commit">commit</a><ol><li><a href="#提交工作流钩子">提交工作流钩子</a></li><li><a href="#workspace-信息">workspace 信息</a></li><li><a href="#git-信息">git 信息</a></li><li><a href="#stylelint-配置">stylelint 配置</a></li><li><a href="#eslint-配置">eslint 配置</a></li><li><a href="#prettier-配置">prettier 配置</a></li><li><a href="#husky-配置">husky 配置</a></li><li><a href="#commitlint-配置">commitlint 配置</a></li><li><a href="#commitizen-配置">commitizen 配置</a></li><li><a href="#packagejson-对应配置">package.json 对应配置</a></li><li><a href="#整个提交流程">整个提交流程</a></li></ol></li><li><a href="#verdaccio">verdaccio</a></li><li><a href="#request">request</a></li><li><a href="#pipes">pipes</a></li></ol></nav></div></section></aside></div><script src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js" integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin="anonymous"></script><script type="text/javascript" src="/ts/main.js" defer=""></script><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><script>NProgress.configure({showSpinner:!1}),NProgress.start(),document.addEventListener("readystatechange",()=>{document.readyState==="interactive"&&NProgress.inc(.8),document.readyState==="complete"&&NProgress.done()})</script></body></html>