<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1,user-scalable=no'><meta name=description content='业务场景 公司面向 B 端的产品是一个后台管理系统，分了五个业务线，这五个业务线服务于不同的业务对象；但他们都有一个共同的特点：数据展示大多以搜索 + 表格的形式；作为一个有着一二百个页面的管理系统，每次新增页面都要将模版代码拷贝一份；一来开发效率低下，二来复用性不够、冗余代码比较多。
'><title>封装 ProSearch 与 ProTable 组件 · I AM BEA, I DRINK TEA</title>
<link rel=canonical href=https://ElementRef.github.io/p/%E5%B0%81%E8%A3%85-prosearch-%E4%B8%8E-protable-%E7%BB%84%E4%BB%B6/><link rel=stylesheet href=/scss/style.min.497b5f2a752c475722ecfffdb2960cc0a51fcb0c639edf1257c35adfe486dc5f.css><meta property='og:title' content='封装 ProSearch 与 ProTable 组件'><meta property='og:description' content='业务场景 公司面向 B 端的产品是一个后台管理系统，分了五个业务线，这五个业务线服务于不同的业务对象；但他们都有一个共同的特点：数据展示大多以搜索 + 表格的形式；作为一个有着一二百个页面的管理系统，每次新增页面都要将模版代码拷贝一份；一来开发效率低下，二来复用性不够、冗余代码比较多。
'><meta property='og:url' content='https://ElementRef.github.io/p/%E5%B0%81%E8%A3%85-prosearch-%E4%B8%8E-protable-%E7%BB%84%E4%BB%B6/'><meta property='og:site_name' content='馬腊咯稽'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2023-01-03T00:00:00+00:00'><meta property='article:modified_time' content='2023-01-03T00:00:00+00:00'><meta property='og:image' content='https://ElementRef.github.io/img/cover/angular.png'><meta name=twitter:title content="封装 ProSearch 与 ProTable 组件"><meta name=twitter:description content="业务场景 公司面向 B 端的产品是一个后台管理系统，分了五个业务线，这五个业务线服务于不同的业务对象；但他们都有一个共同的特点：数据展示大多以搜索 + 表格的形式；作为一个有着一二百个页面的管理系统，每次新增页面都要将模版代码拷贝一份；一来开发效率低下，二来复用性不够、冗余代码比较多。
"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://ElementRef.github.io/img/cover/angular.png'><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><meta name=robots content="noarchive, noindex, nofollow"><meta name=theme-color content="#ffffff"><script defer src=https://umami.pavilion0321907.workers.dev/elementref.js data-website-id=87868be0-a9cf-4f8c-8fee-e3cbb99e6cf2></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu7590466716559688570.png width=300 height=404 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>馬腊咯稽</a></h1><h2 class=site-description>I AM BEA, I DRINK TEA</h2></div></header><ol class=social-menu><li><a href=https://space.bilibili.com/593541941 target=_blank title=Bilibili><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7a4 4 0 01-4-4v-6z"/><path d="M8 3l2 3"/><path d="M16 3l-2 3"/><path d="M9 13v-2"/><path d="M15 11v2"/></svg></a></li><li><a href=https://x.com/SpiciComic target=_blank title=Twitter><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://github.com/ElementRef target=_blank title=GitHub><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://m.weibo.cn/u/6447635754 target=_blank title=Weibo><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-weibo"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 14.127C19 17.2 15.498 20 11 20c-4.126.0-8-2.224-8-5.565.0-1.78.984-3.737 2.7-5.567 2.362-2.51 5.193-3.687 6.551-2.238.415.44.752 1.39.749 2.062 2-1.615 4.308.387 3.5 2.693 1.26.557 2.5.538 2.5 2.742z"/><path d="M15 4h1a5 5 0 015 5v1"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>首页</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/%E5%90%AF%E5%8F%91/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>启发</span></a></li><li><a href=/%E5%91%BD%E4%BB%A4/><svg class="icon icon-tabler icon-tabler-terminal" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 7l5 5-5 5"/><line x1="12" y1="19" x2="19" y2="19"/></svg>
<span>命令</span></a></li><li><a href=/index.xml target=_blank><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg>
<span>订阅</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>深色</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/%E5%B0%81%E8%A3%85-prosearch-%E4%B8%8E-protable-%E7%BB%84%E4%BB%B6/><img src=/img/cover/angular.png loading=lazy alt="封装 ProSearch 与 ProTable 组件"></a></div><div class=article-details><header class=article-category><a href=/categories/angular/>Angular</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E5%B0%81%E8%A3%85-prosearch-%E4%B8%8E-protable-%E7%BB%84%E4%BB%B6/>封装 ProSearch 与 ProTable 组件</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 03, 2023</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长：8 分钟</time></div></footer></div></header><section class=article-content><h2 id=业务场景>业务场景</h2><p>公司面向 B 端的产品是一个后台管理系统，分了五个业务线，这五个业务线服务于不同的业务对象；但他们都有一个共同的特点：数据展示大多以搜索 + 表格的形式；作为一个有着一二百个页面的管理系统，每次新增页面都要将模版代码拷贝一份；一来开发效率低下，二来复用性不够、冗余代码比较多。</p><p>为了解决这些问题，催生了 ProSearch 和 ProTable，通过配置的方式快速搭建页面。</p><h2 id=实现-prosearch>实现 ProSearch</h2><p>ProSearch 本质就是一个带了样式的 FormGroup，需要将所有筛选项包裹起来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>formGroup</span><span class=err>]=&#34;</span><span class=na>validateForm</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>(</span><span class=na>ngSubmit</span><span class=err>)=&#34;</span><span class=na>submitForm</span><span class=err>()&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>nzLayout</span><span class=o>=</span><span class=s>&#34;inline&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>nz-form</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>nz-row</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;width: 100%&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=err>[</span><span class=na>nzSpan</span><span class=err>]=&#34;</span><span class=na>4</span><span class=err>&#34;</span> <span class=na>nz-col</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=err>[</span><span class=na>nzGutter</span><span class=err>]=&#34;[</span><span class=na>8</span><span class=err>,</span> <span class=na>8</span><span class=err>]&#34;</span> <span class=na>nz-row</span> <span class=na>nzJustify</span><span class=o>=</span><span class=s>&#34;end&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>nz-col</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>button</span> <span class=na>nz-button</span> <span class=na>nzType</span><span class=o>=</span><span class=s>&#34;primary&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>i</span> <span class=na>nz-icon</span> <span class=na>nzType</span><span class=o>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            查询
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>nz-col</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>button</span> <span class=err>(</span><span class=na>click</span><span class=err>)=&#34;</span><span class=na>refresh</span><span class=err>()&#34;</span> <span class=na>nz-button</span> <span class=na>nzType</span><span class=o>=</span><span class=s>&#34;default&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>i</span> <span class=na>nz-icon</span> <span class=na>nzType</span><span class=o>=</span><span class=s>&#34;reload&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            刷新
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>我们需要实现 submitForm 和 refresh 来提供「查询」和「刷新」功能，并通过 EventEmitter 将相关事件抛出：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>ProSearchComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Output</span><span class=p>()</span> <span class=nx>onRefresh</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventEmitter</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Output</span><span class=p>()</span> <span class=nx>onSubmit</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventEmitter</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>  <span class=nx>submitForm() {</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>values</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>onSubmit</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=nx>values</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>refresh() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>onRefresh</span><span class=p>.</span><span class=nx>emit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=封装常见表单>封装常见表单</h3><p>ProSearch 封装了一些常见的搜索项，比如 input、select、range-picker、date-picker；具体渲染哪些表单，需要根据传入的配置来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngFor</span><span class=o>=</span><span class=s>&#34;let item of searchFormList&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>nz-col</span> <span class=na>nzSpan</span><span class=o>=</span><span class=s>&#34;7&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 基础筛选 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;!item.renderSearchType; else renderSelfSearch&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>nz-form-item</span> <span class=err>[</span><span class=na>ngSwitch</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>type</span><span class=err>&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- input --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchCase</span><span class=o>=</span><span class=s>&#34;&#39;input&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-label</span> <span class=na>nzNoColon</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;6&#34;</span><span class=p>&gt;</span>{{ item.label }}<span class=p>&lt;/</span><span class=nt>nz-form-label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-control</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;18&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>formControlName</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>formControlName</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzAllowClear</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>nzAllowClear</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>placeholder</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>placeholder</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>(</span><span class=na>ngModelChange</span><span class=err>)=&#34;</span><span class=na>onChange</span><span class=err>($</span><span class=na>event</span><span class=err>,</span> <span class=na>validateForm</span><span class=err>,</span> <span class=na>item</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>nz-input</span>
</span></span><span class=line><span class=cl>            <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>nz-form-control</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- select --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchCase</span><span class=o>=</span><span class=s>&#34;&#39;select&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-label</span> <span class=na>nzNoColon</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;6&#34;</span><span class=p>&gt;</span>{{ item.label }}<span class=p>&lt;/</span><span class=nt>nz-form-label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-control</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;18&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>nz-select</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>formControlName</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>formControlName</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzAllowClear</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>nzAllowClear</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzPlaceHolder</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>placeholder</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzShowSearch</span><span class=err>]=&#34;</span><span class=na>true</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>(</span><span class=na>ngModelChange</span><span class=err>)=&#34;</span><span class=na>onChange</span><span class=err>($</span><span class=na>event</span><span class=err>,</span> <span class=na>validateForm</span><span class=err>,</span> <span class=na>item</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>nz-option</span>
</span></span><span class=line><span class=cl>                <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;!item.noShowSelectAll&#34;</span>
</span></span><span class=line><span class=cl>                <span class=na>nzLabel</span><span class=o>=</span><span class=s>&#34;全部&#34;</span>
</span></span><span class=line><span class=cl>                <span class=na>nzSelected</span>
</span></span><span class=line><span class=cl>                <span class=na>nzValue</span><span class=o>=</span><span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;&lt;/</span><span class=nt>nz-option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>nz-option</span>
</span></span><span class=line><span class=cl>                <span class=err>*</span><span class=na>ngFor</span><span class=o>=</span><span class=s>&#34;let oItem of item.option&#34;</span>
</span></span><span class=line><span class=cl>                <span class=err>[</span><span class=na>nzLabel</span><span class=err>]=&#34;</span><span class=na>oItem</span><span class=err>.</span><span class=na>label</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=err>[</span><span class=na>nzValue</span><span class=err>]=&#34;</span><span class=na>oItem</span><span class=err>.</span><span class=na>value</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;&lt;/</span><span class=nt>nz-option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>nz-select</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>nz-form-control</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- range-picker --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchCase</span><span class=o>=</span><span class=s>&#34;&#39;range-picker&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-label</span> <span class=na>nzNoColon</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;6&#34;</span><span class=p>&gt;</span>{{ item.label }}<span class=p>&lt;/</span><span class=nt>nz-form-label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-control</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;18&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>nz-range-picker</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>formControlName</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>formControlName</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzAllowClear</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>nzAllowClear</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzRanges</span><span class=err>]=&#34;</span><span class=na>rangePicker</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzShowTime</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>nzShowTime</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>(</span><span class=na>ngModelChange</span><span class=err>)=&#34;</span><span class=na>onChange</span><span class=err>($</span><span class=na>event</span><span class=err>,</span> <span class=na>validateForm</span><span class=err>,</span> <span class=na>item</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>style</span><span class=o>=</span><span class=s>&#34;width: 100%&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>&gt;&lt;/</span><span class=nt>nz-range-picker</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>nz-form-control</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- date-picker --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchCase</span><span class=o>=</span><span class=s>&#34;&#39;date-picker&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-label</span> <span class=na>nzNoColon</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;12&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;width: 200px&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            {{ item.label }}
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>nz-form-label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-control</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;12&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>nz-date-picker</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>formControlName</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>formControlName</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzAllowClear</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>nzAllowClear</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzMode</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>nzMode</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>(</span><span class=na>ngModelChange</span><span class=err>)=&#34;</span><span class=na>onChange</span><span class=err>($</span><span class=na>event</span><span class=err>,</span> <span class=na>validateForm</span><span class=err>,</span> <span class=na>item</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>style</span><span class=o>=</span><span class=s>&#34;width: 100%&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>&gt;&lt;/</span><span class=nt>nz-date-picker</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>nz-form-control</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这里的「配置」指的是 SearchFormListItem，组件会根据 searchFormList 渲染对应的表单：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>interface</span> <span class=nx>SearchFormListItem</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>type</span><span class=o>:</span> <span class=kt>string</span><span class=p>;</span> <span class=c1>// 表单类型，type=&#34;select&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>timeQueryParams?</span>: <span class=kt>string</span><span class=p>[];</span> <span class=c1>// 时间相关字段，timeQueryParams=[&#34;createTimeStart&#34;, &#34;createTimeEnd&#34;]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>renderSearchType?</span>: <span class=kt>string</span><span class=p>;</span> <span class=c1>// 自定义渲染模版，renderSearchType=&#34;companyIdSelectRef&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>placeholder</span>: <span class=kt>string</span><span class=p>;</span> <span class=c1>// 占位描述，placeholder=&#34;请输入姓名&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>option?</span>: <span class=kt>Array</span><span class=o>&lt;</span><span class=p>{</span> <span class=nx>label</span>: <span class=kt>string</span><span class=p>;</span> <span class=nx>value</span>: <span class=kt>string</span> <span class=p>}</span><span class=o>&gt;</span><span class=p>;</span> <span class=c1>// 自定义选项，option=[{label: &#34;选项一&#34;, value: 1},...]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>onChange?</span>: <span class=kt>Function</span><span class=p>;</span> <span class=c1>// 表单值变化时触发 onChange
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>nzShowTime?</span>: <span class=kt>boolean</span><span class=p>;</span> <span class=c1>// type=&#34;range-picker&#34;时，是否显示时间选择
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>nzMode?</span>: <span class=kt>string</span><span class=p>;</span> <span class=c1>// nz-date-picker 属性
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>nzAllowClear?</span>: <span class=kt>boolean</span><span class=p>;</span> <span class=c1>// 是否显示清除按钮
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>noShowSelectAll?</span>: <span class=kt>boolean</span><span class=p>;</span> <span class=c1>// 是否显示「全部」选项
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>label</span>: <span class=kt>string</span><span class=p>;</span> <span class=c1>// 表单描述，label=&#34;商户名称&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>isNumber?</span>: <span class=kt>boolean</span><span class=p>;</span> <span class=c1>// 是否将 option 中的 value 转换为数字
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>initValidate?</span>: <span class=kt>Function</span><span class=p>;</span> <span class=c1>// 表单初始值，initValidate=()=&gt;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>handleQueryParams?</span>: <span class=kt>Function</span><span class=p>;</span> <span class=c1>// 处理成自己想要搜索参数值
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>formControlName</span>: <span class=kt>string</span><span class=p>;</span> <span class=c1>// 表单字段，formControlName=&#34;name&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>dependence?</span>: <span class=kt>string</span><span class=p>[];</span> <span class=c1>// 依赖于其他搜索项，dependence: [&#39;orgId&#39;]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>_reset?</span>: <span class=kt>string</span><span class=p>[];</span> <span class=c1>// 不需要传入
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>ProSearchComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>searchFormList</span>: <span class=kt>SearchFormListItem</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=nx>validateForm</span>: <span class=kt>UntypedFormGroup</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnInit() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 生成 validateForm，并设置初始值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>group</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>searchFormList</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>item</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>nzAllowClear</span> <span class=o>===</span> <span class=kc>undefined</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>item</span><span class=p>.</span><span class=nx>nzAllowClear</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=kr>type</span> <span class=o>===</span> <span class=s1>&#39;range-picker&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>timeQueryParams</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>group</span><span class=p>[</span><span class=nx>item</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=nx>item</span><span class=p>.</span><span class=nx>initValidate</span>
</span></span><span class=line><span class=cl>            <span class=o>?</span> <span class=nx>item</span><span class=p>.</span><span class=nx>initValidate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>searchParams</span><span class=p>.</span><span class=nx>range</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=kr>type</span> <span class=o>===</span> <span class=s1>&#39;date-picker&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>item</span><span class=p>.</span><span class=nx>timeQueryParams</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>group</span><span class=p>[</span><span class=nx>item</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=nx>item</span><span class=p>.</span><span class=nx>initValidate</span>
</span></span><span class=line><span class=cl>            <span class=o>?</span> <span class=nx>item</span><span class=p>.</span><span class=nx>initValidate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>searchParams</span><span class=p>.</span><span class=nx>rangeS</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>group</span><span class=p>[</span><span class=nx>item</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=nx>item</span><span class=p>.</span><span class=nx>initValidate</span>
</span></span><span class=line><span class=cl>            <span class=o>?</span> <span class=nx>item</span><span class=p>.</span><span class=nx>initValidate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>searchParams</span><span class=p>.</span><span class=nx>echoParams</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>,</span> <span class=nx>item</span><span class=p>.</span><span class=nx>isNumber</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>[</span><span class=sb>`get</span><span class=si>${</span><span class=nx>item</span><span class=p>.</span><span class=kr>type</span><span class=si>}</span><span class=sb>`</span><span class=p>]</span><span class=o>?</span><span class=p>.({});</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 生成 validateForm
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>validateForm</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>formBuilder</span><span class=p>.</span><span class=nx>group</span><span class=p>(</span><span class=nx>group</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>handleInitParams</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>initParams</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当然作为一个通用组件，这些还不够；为了尽可能覆盖业务场景，还包含了一些业务相关的比较常用的筛选：BillTypeSelect、CompanyIdSelect、MainstayIdSelect、OrgIdSelect、TransactionTypeSelect 等；具体要包含哪些组件，需要跟着具体业务来；我这里是根据使用频率来的，这些业务相关的筛选几乎存在于所有业务线中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngFor</span><span class=o>=</span><span class=s>&#34;let item of searchFormList&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>nz-col</span> <span class=na>nzSpan</span><span class=o>=</span><span class=s>&#34;7&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;!item.renderSearchType; else renderSelfSearch&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>nz-form-item</span> <span class=err>[</span><span class=na>ngSwitch</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>type</span><span class=err>&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchCase</span><span class=o>=</span><span class=s>&#34;&#39;BillTypeSelect&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-label</span> <span class=na>nzNoColon</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;6&#34;</span><span class=p>&gt;</span>{{ item.label }}<span class=p>&lt;/</span><span class=nt>nz-form-label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-control</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;18&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>nz-select</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>formControlName</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>formControlName</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzAllowClear</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>nzAllowClear</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzPlaceHolder</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>placeholder</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzShowSearch</span><span class=err>]=&#34;</span><span class=na>true</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>(</span><span class=na>ngModelChange</span><span class=err>)=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>onChange</span> <span class=err>&amp;&amp;</span> <span class=na>item</span><span class=err>.</span><span class=na>onChange</span><span class=err>($</span><span class=na>event</span><span class=err>,</span> <span class=na>validateForm</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>nz-option</span>
</span></span><span class=line><span class=cl>                <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;!item.noShowSelectAll&#34;</span>
</span></span><span class=line><span class=cl>                <span class=na>nzLabel</span><span class=o>=</span><span class=s>&#34;全部&#34;</span>
</span></span><span class=line><span class=cl>                <span class=na>nzSelected</span>
</span></span><span class=line><span class=cl>                <span class=na>nzValue</span><span class=o>=</span><span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;&lt;/</span><span class=nt>nz-option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>nz-option</span>
</span></span><span class=line><span class=cl>                <span class=err>*</span><span class=na>ngFor</span><span class=o>=</span><span class=s>&#34;let oItem of selfSelectList[item.type]&#34;</span>
</span></span><span class=line><span class=cl>                <span class=err>[</span><span class=na>nzLabel</span><span class=err>]=&#34;</span><span class=na>oItem</span><span class=err>.</span><span class=na>label</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=err>[</span><span class=na>nzValue</span><span class=err>]=&#34;</span><span class=na>oItem</span><span class=err>.</span><span class=na>value</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;&lt;/</span><span class=nt>nz-option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>nz-select</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>nz-form-control</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchCase</span><span class=o>=</span><span class=s>&#34;&#39;CompanyIdSelect&#39;&#34;</span><span class=p>&gt;</span>...<span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchCase</span><span class=o>=</span><span class=s>&#34;&#39;MainstayIdSelect&#39;&#34;</span><span class=p>&gt;</span>...<span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchCase</span><span class=o>=</span><span class=s>&#34;&#39;TransactionTypeSelect&#39;&#34;</span><span class=p>&gt;</span>...<span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchCase</span><span class=o>=</span><span class=s>&#34;&#39;OrgIdSelect&#39;&#34;</span><span class=p>&gt;</span>...<span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- 如果都没有匹配，就渲染一个 input --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngSwitchDefault</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-label</span> <span class=na>nzNoColon</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;6&#34;</span><span class=p>&gt;</span>{{ item.label }}<span class=p>&lt;/</span><span class=nt>nz-form-label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>nz-form-control</span> <span class=na>nzSm</span><span class=o>=</span><span class=s>&#34;18&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>formControlName</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>formControlName</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>nzAllowClear</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>nzAllowClear</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=err>[</span><span class=na>placeholder</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>placeholder</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>nz-input</span>
</span></span><span class=line><span class=cl>            <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>nz-form-control</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>nz-form-item</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=渲染自定义表单>渲染自定义表单</h3><p>最后，还有一种常见的情况；如果 ProSearch 内置的表单都不能满足需求时，ProSearch 应该有渲染一段 TemplateRef 的能力；我们将通过 renderSelfSearch 提供这种能力：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngFor</span><span class=o>=</span><span class=s>&#34;let item of searchFormList&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>nz-col</span> <span class=na>nzSpan</span><span class=o>=</span><span class=s>&#34;7&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;!item.renderSearchType; else renderSelfSearch&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      ...
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ng-template</span> <span class=err>#</span><span class=na>renderSelfSearch</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>ng-template</span>
</span></span><span class=line><span class=cl>        <span class=err>[</span><span class=na>ngTemplateOutlet</span><span class=err>]=&#34;</span><span class=na>templateRef</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=err>[</span><span class=na>ngTemplateOutletContext</span><span class=err>]=&#34;{</span>
</span></span><span class=line><span class=cl>          <span class=na>record:</span> <span class=na>item</span><span class=err>,</span>
</span></span><span class=line><span class=cl>          <span class=na>rt:</span> <span class=na>item</span><span class=err>.</span><span class=na>renderSearchType</span><span class=err>,</span>
</span></span><span class=line><span class=cl>          <span class=na>validateForm:</span> <span class=na>validateForm</span>
</span></span><span class=line><span class=cl>        <span class=err>}&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>&gt;&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>外部代码段通过 TemplateRef 提供，为了保证外部代码能和 validateForm 产生关联，需要将 validateForm 暴露出去；为了能够渲染到正确的位置，需要将 item.renderSearchType 暴露出去；使用时，直接在插槽中做判断即可：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>app-pro-search</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>searchFormList</span><span class=err>]=&#34;</span><span class=na>searchOption</span><span class=err>.</span><span class=na>searchFormList</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>(</span><span class=na>onSubmit</span><span class=err>)=&#34;</span><span class=na>onSubmit</span><span class=err>($</span><span class=na>event</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>(</span><span class=na>onRefresh</span><span class=err>)=&#34;</span><span class=na>onRefresh</span><span class=err>()&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>#</span><span class=na>proSearch</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- 拿到 ngTemplateOutletContext 暴露的上下文 --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>ng-template</span> <span class=na>let-record</span><span class=o>=</span><span class=s>&#34;record&#34;</span> <span class=na>let-rt</span><span class=o>=</span><span class=s>&#34;rt&#34;</span> <span class=na>let-validateForm</span><span class=o>=</span><span class=s>&#34;validateForm&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 通过 rt 确认渲染位置 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;rt === &#39;searchName&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>input</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>app-pro-search</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Angular 和 Vue 的模版的灵活性都不及 JSX，比如上边的 renderSelfSearch 在 for 循环中会被渲染多次；每次匹配的内容是根据 rt 来的。</p><h3 id=处理表单间的依赖>处理表单间的依赖</h3><p>上文中已经提到了一部分，SearchFormListItem 上有一个私有属性 _reset；它是在初始化的时候，根据 item.dependence 生成的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// 处理表单之间的依赖关系
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>dependence</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>params</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=nx>item</span><span class=p>.</span><span class=nx>dependence</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>x</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 找到 item 依赖项
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>currentDependence</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>searchFormList</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>y</span> <span class=o>=&gt;</span> <span class=nx>y</span><span class=p>.</span><span class=nx>formControlName</span> <span class=o>===</span> <span class=nx>x</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 更新依赖项的 _reset 列表
</span></span></span><span class=line><span class=cl><span class=cm>     * 当表单 ngModelChange 触发时
</span></span></span><span class=line><span class=cl><span class=cm>     * 会遍历 _reset，将对应表单值重置
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>currentDependence</span><span class=p>.</span><span class=nx>_reset</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentDependence</span><span class=p>.</span><span class=nx>_reset</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentDependence</span><span class=p>.</span><span class=nx>_reset</span> <span class=o>=</span> <span class=p>[</span><span class=nx>item</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>params</span><span class=p>[</span><span class=nx>currentDependence</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>searchParams</span><span class=p>.</span><span class=nx>echoParams</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentDependence</span><span class=p>.</span><span class=nx>formControlName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentDependence</span><span class=p>.</span><span class=nx>isNumber</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 获取 options 数据
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>this</span><span class=p>[</span><span class=sb>`get</span><span class=si>${</span><span class=nx>item</span><span class=p>.</span><span class=kr>type</span><span class=si>}</span><span class=sb>`</span><span class=p>]</span><span class=o>?</span><span class=p>.({</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span><span class=nx>params</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当依赖项变动时，我们可以根据依赖项上的 _reset 列表执行一些动作，比如重置「依赖于当前表单值的表单」的值；重新拉取「依赖于当前表单值的表单」options：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>ProSearchComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>onChange</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>validateForm</span><span class=p>,</span> <span class=nx>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>onChange</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>item</span><span class=p>.</span><span class=nx>onChange</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=nx>validateForm</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 依赖关系处理
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>_reset</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>item</span><span class=p>.</span><span class=nx>_reset</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>resetItem</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 重置依赖项的值
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>validateForm</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=nx>resetItem</span><span class=p>).</span><span class=nx>setValue</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>searchFormList</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>x</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>x</span><span class=p>.</span><span class=nx>formControlName</span> <span class=o>===</span> <span class=nx>resetItem</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 找到依赖项对应的 searchFormListItem
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kd>let</span> <span class=nx>params</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>            <span class=nx>x</span><span class=p>.</span><span class=nx>dependence</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>y</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>params</span><span class=p>[</span><span class=nx>y</span><span class=p>]</span> <span class=o>=</span> <span class=nx>validateForm</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=nx>y</span><span class=p>).</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 重新请求依赖项对应的 options
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>this</span><span class=p>[</span><span class=sb>`get</span><span class=si>${</span><span class=nx>x</span><span class=p>.</span><span class=kr>type</span><span class=si>}</span><span class=sb>`</span><span class=p>]</span><span class=o>?</span><span class=p>.({</span>
</span></span><span class=line><span class=cl>              <span class=p>...</span><span class=nx>params</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果处于「无按钮」模式，每次修改都需要重新查询
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>noButton</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>submitForm</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=加载-selectoptions>加载 select.options</h3><p>你可能会有疑问，代码中的 this[`get${x.type}`]?.({}) 这些是什么；这些是用来加载 SelectOptions 的，这些方法被预先写在了 ProSearch 中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>ProSearchComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// CompanyIdSelect 商户选择
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getCompanyIdSelect() {</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// OrgIdSelect 机构选择
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getOrgIdSelect() {</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// MainstayIdSelect 主体选择
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getMainstayIdSelect</span><span class=p>({</span> <span class=nx>orgId</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span> <span class=p>})</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// BillTypeSelect 类型选择
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getBillTypeSelect() {</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// TransactionTypeSelect 交易类型
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getTransactionTypeSelect() {</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如果不在 ProSearch 中提供，也可提供过 SearchFormListItem 提供。</p><h2 id=实现-protable>实现 ProTable</h2><p>同 ProSearch 一样，ProTable 就是一个带了样式的 Table；将 Table 封装起来，就不用一遍遍的写复杂的配置和分页逻辑了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>nz-table</span>
</span></span><span class=line><span class=cl>  <span class=err>#</span><span class=na>basicTable</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzData</span><span class=err>]=&#34;</span><span class=na>data</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzLoading</span><span class=err>]=&#34;</span><span class=na>loading</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzFrontPagination</span><span class=err>]=&#34;</span><span class=na>false</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzPageIndex</span><span class=err>]=&#34;</span><span class=na>paginationData</span><span class=err>.</span><span class=na>pageIndex</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzPageSize</span><span class=err>]=&#34;</span><span class=na>paginationData</span><span class=err>.</span><span class=na>pageSize</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzTotal</span><span class=err>]=&#34;</span><span class=na>paginationData</span><span class=err>.</span><span class=na>total</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzScroll</span><span class=err>]=&#34;{</span> <span class=na>x:</span> <span class=na>xScroll</span> <span class=err>}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzShowQuickJumper</span><span class=err>]=&#34;</span><span class=na>true</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzShowSizeChanger</span><span class=err>]=&#34;</span><span class=na>true</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>nzShowTotal</span><span class=err>]=&#34;</span><span class=na>totalTemplate</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>(</span><span class=na>nzPageIndexChange</span><span class=err>)=&#34;</span><span class=na>handlePageIndex</span><span class=err>($</span><span class=na>event</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>(</span><span class=na>nzPageSizeChange</span><span class=err>)=&#34;</span><span class=na>handlePageSize</span><span class=err>($</span><span class=na>event</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>nzBordered</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>thead</span><span class=p>&gt;</span>...<span class=p>&lt;/</span><span class=nt>thead</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>tbody</span><span class=p>&gt;</span>...<span class=p>&lt;/</span><span class=nt>tbody</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>nz-table</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-template</span> <span class=err>#</span><span class=na>totalTemplate</span> <span class=na>let-total</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  共 {{ total }} 条记录 第 {{ paginationData.pageIndex }} / {{ pages }} 页
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=封装-thead>封装 thead</h3><p>和 ProSearch 的思路相同，通过循环传入的配置来渲染 thead：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>tr</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;columns.length; else selfThead&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngFor</span><span class=o>=</span><span class=s>&#34;let item of columns&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>th</span>
</span></span><span class=line><span class=cl>      <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;!item.renderThType; else renderTheadContent&#34;</span>
</span></span><span class=line><span class=cl>      <span class=err>[</span><span class=na>nzRight</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>right</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=err>[</span><span class=na>nzWidth</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>width</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      {{ item.title }}
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ng-template</span> <span class=err>#</span><span class=na>renderTheadContent</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>th</span> <span class=err>[</span><span class=na>nzRight</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>right</span><span class=err>&#34;</span> <span class=err>[</span><span class=na>nzWidth</span><span class=err>]=&#34;</span><span class=na>item</span><span class=err>.</span><span class=na>width</span><span class=err>&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ng-template</span>
</span></span><span class=line><span class=cl>          <span class=err>[</span><span class=na>ngTemplateOutlet</span><span class=err>]=&#34;</span><span class=na>templateRef</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>          <span class=err>[</span><span class=na>ngTemplateOutletContext</span><span class=err>]=&#34;{</span>
</span></span><span class=line><span class=cl>            <span class=na>record:</span> <span class=na>item</span><span class=err>,</span>
</span></span><span class=line><span class=cl>            <span class=na>rt:</span> <span class=na>item</span><span class=err>.</span><span class=na>renderThType</span><span class=err>,</span>
</span></span><span class=line><span class=cl>            <span class=na>text:</span> <span class=na>item</span><span class=err>.</span><span class=na>title</span><span class=err>,</span>
</span></span><span class=line><span class=cl>            <span class=na>type:</span> <span class=err>&#39;</span><span class=na>th</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl>          <span class=err>}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-template</span> <span class=err>#</span><span class=na>selfThead</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>ng-content</span> <span class=na>select</span><span class=o>=</span><span class=s>&#34;[thead]&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>ng-content</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>thead 的情况很简单，我们只需要渲染 title 就可以了；如果不能满足要求，可以通过 TemplateRef 来自定义渲染内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>app-pro-table</span>
</span></span><span class=line><span class=cl>  <span class=err>#</span><span class=na>proTable</span>
</span></span><span class=line><span class=cl>  <span class=err>[</span><span class=na>columns</span><span class=err>]=&#34;</span><span class=na>columns</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>(</span><span class=na>onChangePageSize</span><span class=err>)=&#34;</span><span class=na>onChangePageSize</span><span class=err>($</span><span class=na>event</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>(</span><span class=na>onChangePageIndex</span><span class=err>)=&#34;</span><span class=na>onChangePageIndex</span><span class=err>($</span><span class=na>event</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>ng-template</span> <span class=na>let-record</span><span class=o>=</span><span class=s>&#34;record&#34;</span> <span class=na>let-rt</span><span class=o>=</span><span class=s>&#34;rt&#34;</span> <span class=na>let-text</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>let-type</span><span class=o>=</span><span class=s>&#34;type&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- type === &#39;th&#39; 渲染到 thead --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;type === &#39;th&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;rt === &#39;check&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>th</span>
</span></span><span class=line><span class=cl>          <span class=err>[</span><span class=na>nzChecked</span><span class=err>]=&#34;</span><span class=na>checkedMap</span><span class=err>.</span><span class=na>get</span><span class=err>(</span><span class=na>record</span><span class=err>.</span><span class=na>id</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>          <span class=err>(</span><span class=na>nzCheckedChange</span><span class=err>)=&#34;</span><span class=na>checkAll</span><span class=err>($</span><span class=na>event</span><span class=err>)&#34;</span>
</span></span><span class=line><span class=cl>          <span class=err>[</span><span class=na>nzDisabled</span><span class=err>]=&#34;</span><span class=na>checkeAllFlag</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>nzShowCheckbox</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;&lt;/</span><span class=nt>th</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>app-pro-table</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这里需要拿 type 做一层判断，判断渲染到 thead 还是 tbody。</p><h3 id=封装-tbody>封装 tbody</h3><p>和 thead 类似，tbody 同样要循环 columns，并在 TemplateRef 中渲染自定义内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;columns.length; else selfTbody&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>tr</span> <span class=err>*</span><span class=na>ngFor</span><span class=o>=</span><span class=s>&#34;let item of basicTable.data; let i = index&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ng-container</span> <span class=err>*</span><span class=na>ngFor</span><span class=o>=</span><span class=s>&#34;let citem of columns&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>td</span>
</span></span><span class=line><span class=cl>        <span class=err>*</span><span class=na>ngIf</span><span class=o>=</span><span class=s>&#34;!citem.renderTdType; else renderContent&#34;</span>
</span></span><span class=line><span class=cl>        <span class=err>[</span><span class=na>nzRight</span><span class=err>]=&#34;</span><span class=na>citem</span><span class=err>.</span><span class=na>right</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=err>[</span><span class=na>nzWidth</span><span class=err>]=&#34;</span><span class=na>citem</span><span class=err>.</span><span class=na>width</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        {{ item[citem.key] | emptyValue }}
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>ng-template</span> <span class=err>#</span><span class=na>renderContent</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>td</span> <span class=err>[</span><span class=na>nzRight</span><span class=err>]=&#34;</span><span class=na>citem</span><span class=err>.</span><span class=na>right</span><span class=err>&#34;</span> <span class=err>[</span><span class=na>nzWidth</span><span class=err>]=&#34;</span><span class=na>citem</span><span class=err>.</span><span class=na>width</span><span class=err>&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>ng-template</span>
</span></span><span class=line><span class=cl>            <span class=err>[</span><span class=na>ngTemplateOutlet</span><span class=err>]=&#34;</span><span class=na>templateRef</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=err>[</span><span class=na>ngTemplateOutletContext</span><span class=err>]=&#34;{</span>
</span></span><span class=line><span class=cl>              <span class=na>index:</span> <span class=na>i</span><span class=err>,</span>
</span></span><span class=line><span class=cl>              <span class=na>pageIndex:</span> <span class=na>paginationData</span><span class=err>.</span><span class=na>pageIndex</span><span class=err>,</span>
</span></span><span class=line><span class=cl>              <span class=na>pageSize:</span> <span class=na>paginationData</span><span class=err>.</span><span class=na>pageSize</span><span class=err>,</span>
</span></span><span class=line><span class=cl>              <span class=na>record:</span> <span class=na>item</span><span class=err>,</span>
</span></span><span class=line><span class=cl>              <span class=na>rt:</span> <span class=na>citem</span><span class=err>.</span><span class=na>renderTdType</span><span class=err>,</span>
</span></span><span class=line><span class=cl>              <span class=na>text:</span> <span class=na>item</span><span class=err>[</span><span class=na>citem</span><span class=err>.</span><span class=na>key</span><span class=err>],</span>
</span></span><span class=line><span class=cl>              <span class=na>type:</span> <span class=err>&#39;</span><span class=na>td</span><span class=err>&#39;,</span>
</span></span><span class=line><span class=cl>            <span class=err>}&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>&gt;&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>td</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>tr</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-container</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ng-template</span> <span class=err>#</span><span class=na>selfTbody</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>ng-content</span> <span class=na>select</span><span class=o>=</span><span class=s>&#34;[tbody]&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>ng-content</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ng-template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=数据请求>数据请求</h3><p>如果使用外部数据，可以传入 data 选项，并通过抛出的 onChangePageIndex、onChangePageSize 触发数据分页请求：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>interface</span> <span class=nx>ColumnsItem</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>key</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>width</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>renderTdType?</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>renderThType?</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>right?</span>: <span class=kt>string</span> <span class=o>|</span> <span class=kr>boolean</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>ex</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>ProTableComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>columns</span>: <span class=kt>ColumnsItem</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Output</span><span class=p>()</span> <span class=nx>onChangePageIndex</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventEmitter</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Output</span><span class=p>()</span> <span class=nx>onChangePageSize</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventEmitter</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这种使用场景不多；因为项目中，接口请求都会封装到不同的 Service 中，我们通过传入不同的 Service 以及不同的请求方法名称，就可以将数据请求逻辑封装到 ProTable 内部：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>ProTableComponent</span> <span class=kr>implements</span> <span class=nx>OnInit</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>columns</span>: <span class=kt>ColumnsItem</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>requestService</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>requestApiName</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>initParams</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Input</span><span class=p>()</span> <span class=nx>otherParams</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>@Output</span><span class=p>()</span> <span class=nx>onRequest</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventEmitter</span><span class=p>&lt;</span><span class=nt>any</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>loading</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>lastQueryParams</span>: <span class=kt>Params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>paginationData</span>: <span class=kt>PaginationData</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>pageIndex</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>pageSize</span>: <span class=kt>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>total</span>: <span class=kt>0</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=nx>pages</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>raw</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>constructor</span><span class=p>(</span><span class=kr>private</span> <span class=nx>route</span>: <span class=kt>ActivatedRoute</span><span class=p>,</span> <span class=kr>private</span> <span class=nx>router</span>: <span class=kt>Router</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ngOnInit() {</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>route</span><span class=p>.</span><span class=nx>queryParams</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>params</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>lastQueryParams</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span><span class=k>this</span><span class=p>.</span><span class=nx>initParams</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span><span class=nx>params</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>lastQueryParams</span> <span class=o>=</span> <span class=nx>lastQueryParams</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>requestService</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>requestApiName</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>getList</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>pageNo</span>: <span class=kt>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>pageSize</span>: <span class=kt>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>...</span><span class=nx>lastQueryParams</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>otherParams</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>getList</span><span class=p>(</span><span class=nx>params</span><span class=p>,</span> <span class=nx>otherParams</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>loading</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>requestService</span><span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>requestApiName</span><span class=p>](</span><span class=nx>params</span><span class=p>,</span> <span class=nx>otherParams</span><span class=p>).</span><span class=nx>subscribe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>result</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>loading</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>data</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>records</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>ext</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>ext</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>pages</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>pages</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>paginationData</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>paginationData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>raw</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>raw</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>onRequest</span><span class=o>?</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当然，你可能会疑惑；数据请求接口的入参从哪里来呢？我们采用的方式是从 URL 中拿取，在 Angular 中 ActivatedRoute.queryParams 是一个 RxJS 对象；当我们修改 URL 中的查询参数时，ActivatedRoute.queryParams 的订阅者会拿到最新的参数并自动运行，无需考虑手动调用和参数传递问题。</p><p>通过 ActivatedRoute，实现了 ProSearch 与 ProTable 的解藕和数据传递问题。</p><h2 id=总结>总结</h2><p>ProSearch 与 ProTable 的诞生主要还是依附于 renderless 模式的使用；通过渲染插槽来实现渲染内容的自定义。</p><p>Angular 中的 ngTemplateOutlet 和 Vue 中的 Slot 的便捷性明显不如 JSX 的 renderProps 模式；毕竟渲染函数的表现力真的不如 JSX。</p><p>虽有诸多不便，但是如果想实现 UI 的复用；插槽可能是唯一的选择。对于 renderless 模式，推荐 Tailwind 作者的 <a class=link href=https://adamwathan.me/renderless-components-in-vuejs target=_blank rel=noopener>Renderless Components in Vue.js
</a>。</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/angular-%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/><div class=article-image><img src=/img/cover/angular.png loading=lazy data-key data-hash=/img/cover/angular.png></div><div class=article-details><h2 class=article-title>Angular 组件设计</h2></div></a></article><article class=has-image><a href=/p/angular-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/><div class=article-image><img src=/img/cover/angular.png loading=lazy data-key data-hash=/img/cover/angular.png></div><div class=article-details><h2 class=article-title>Angular 快速上手</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2017 -
2025
<a href=https://github.com/ElementRef target=_blank>馬腊咯稽</a></section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>, Deploy by Actions<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.13.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#业务场景>业务场景</a></li><li><a href=#实现-prosearch>实现 ProSearch</a><ol><li><a href=#封装常见表单>封装常见表单</a></li><li><a href=#渲染自定义表单>渲染自定义表单</a></li><li><a href=#处理表单间的依赖>处理表单间的依赖</a></li><li><a href=#加载-selectoptions>加载 select.options</a></li></ol></li><li><a href=#实现-protable>实现 ProTable</a><ol><li><a href=#封装-thead>封装 thead</a></li><li><a href=#封装-tbody>封装 tbody</a></li><li><a href=#数据请求>数据请求</a></li></ol></li><li><a href=#总结>总结</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script src=https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js></script><script>NProgress.configure({showSpinner:!1}),NProgress.start(),document.addEventListener("readystatechange",()=>{document.readyState==="interactive"&&NProgress.inc(.8),document.readyState==="complete"&&NProgress.done()})</script></body></html>