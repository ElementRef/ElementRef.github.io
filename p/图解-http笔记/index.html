<!DOCTYPE html><html lang="zh-cn" dir="ltr"><head><meta charset="utf-8"><style>:where(img[jampack-sized]){max-width:100%;height:auto}</style><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="HTTP 与 TCP/IP HTTP（Hypertext Transfer Protocol）是以 TCP/IP（Transmission Control Protocol/Internet Protocol）协议族为基础的，属于 TCP/IP 内部的一个子集；TCP/IP 协议族按层次分别分：
"><title>《图解 HTTP》笔记 · I AM BEA, I DRINK TEA</title>
<link rel="canonical" href="https://ElementRef.github.io/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/"><link rel="stylesheet" href="/scss/style.min.49a542c0449d2ab7de17e0bb72f035d22a011f1361d304a0ff6dc68951166f07.css"><meta property="og:title" content="《图解 HTTP》笔记"><meta property="og:description" content="HTTP 与 TCP/IP HTTP（Hypertext Transfer Protocol）是以 TCP/IP（Transmission Control Protocol/Internet Protocol）协议族为基础的，属于 TCP/IP 内部的一个子集；TCP/IP 协议族按层次分别分：
"><meta property="og:url" content="https://ElementRef.github.io/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="馬腊咯稽"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2020-04-15T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-15T00:00:00+00:00"><meta property="og:image" content="https://ElementRef.github.io/img/cover/http.png"><meta property="og:logo" content="/og-logo.png"><meta name="twitter:title" content="《图解 HTTP》笔记"><meta name="twitter:description" content="HTTP 与 TCP/IP HTTP（Hypertext Transfer Protocol）是以 TCP/IP（Transmission Control Protocol/Internet Protocol）协议族为基础的，属于 TCP/IP 内部的一个子集；TCP/IP 协议族按层次分别分：
"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://ElementRef.github.io/img/cover/http.png"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><meta name="robots" content="noarchive, noindex, nofollow"><meta name="theme-color" content="#ffffff"><script defer="" src="https://umami.pavilion0321907.workers.dev/elementref.js" data-website-id="87868be0-a9cf-4f8c-8fee-e3cbb99e6cf2"></script></head><body class="article-page"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="flex container extended main-container on-phone--column"><aside class="sidebar sticky left-sidebar"><button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
<span class="hamburger-box"><span class="hamburger-inner"></span></span></button><header><figure class="site-avatar"><a href="/"><img src="/img/avatar_hu15751654176150258532.webp" width="300" height="404" class="site-logo" alt="Avatar" fetchpriority="high" decoding="async"></a></figure><div class="site-meta"><h1 class="site-name"><a href="/">馬腊咯稽</a></h1><h2 class="site-description">I AM BEA, I DRINK TEA</h2></div></header><ol class="social-menu"><li><a href="https://douban.com/people/nicknoonan" target="_blank" title="DouBan"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-douban"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M4 20h16"></path><path d="M5 4h14"></path><path d="M8 8h8a2 2 0 012 2v2a2 2 0 01-2 2H8a2 2 0 01-2-2v-2a2 2 0 012-2z"></path><path d="M16 14l-2 6"></path><path d="M8 17l1 3"></path></svg></a></li><li><a href="https://x.com/SpiciComic" target="_blank" title="Twitter"><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"></path></svg></a></li><li><a href="https://github.com/ElementRef" target="_blank" title="GitHub"><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"></path></svg></a></li><li><a href="https://m.weibo.cn/u/6447635754" target="_blank" title="Weibo"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-weibo"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M19 14.127C19 17.2 15.498 20 11 20c-4.126.0-8-2.224-8-5.565.0-1.78.984-3.737 2.7-5.567 2.362-2.51 5.193-3.687 6.551-2.238.415.44.752 1.39.749 2.062 2-1.615 4.308.387 3.5 2.693 1.26.557 2.5.538 2.5 2.742z"></path><path d="M15 4h1a5 5 0 015 5v1"></path></svg></a></li><li><a href="https://last.fm/zh/user/SpiciComic/listening-report" target="_blank" title="Last.fm"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-lastfm"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M20 8c-.83-1-1.388-1-2-1-.612.0-2 .271-2 2s1.384 2.233 3 3 2.125 1.812 2 3-1 2-3 2-3-1-3.5-2-1.585-4.78-2.497-6a5 5 0 10-1 7"></path></svg></a></li></ol><ol class="menu" id="main-menu"><li><a href="/"><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><polyline points="5 12 3 12 12 3 21 12 19 12"></polyline><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"></path></svg>
<span>首页</span></a></li><li><a href="/archives/"><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><rect x="3" y="4" width="18" height="4" rx="2"></rect><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"></path><line x1="10" y1="12" x2="14" y2="12"></line></svg>
<span>归档</span></a></li><li><a href="/search/"><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="10" cy="10" r="7"></circle><line x1="21" y1="21" x2="15" y2="15"></line></svg>
<span>搜索</span></a></li><li><a href="/%E5%90%AF%E5%8F%91/"><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"></path><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"></path></svg>
<span>启发</span></a></li><li><a href="/%E5%91%BD%E4%BB%A4/"><svg class="icon icon-tabler icon-tabler-terminal" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 7l5 5-5 5"></path><line x1="12" y1="19" x2="19" y2="19"></line></svg>
<span>命令</span></a></li><li><a href="/%E5%85%B3%E4%BA%8E/"><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"></path></svg>
<span>关于</span></a></li><div class="menu-bottom-section"><li id="dark-mode-toggle"><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="8" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="16" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<span>深色</span></li></div></ol></aside><main class="full-width main"><article class="has-image main-article"><header class="article-header"><div class="article-image"><a href="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/"><img src="/img/cover/http.webp" alt="《图解 HTTP》笔记" fetchpriority="high" decoding="async" width="1200" height="720" jampack-sized="true"></a></div><div class="article-details"><header class="article-category"><a href="/categories/http/">HTTP</a></header><div class="article-title-wrapper"><h2 class="article-title"><a href="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/">《图解 HTTP》笔记</a></h2></div><footer class="article-time"><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"></path><circle cx="18" cy="18" r="4"></circle><path d="M15 3v4"></path><path d="M7 3v4"></path><path d="M3 11h16"></path><path d="M18 16.496V18l1 1"></path></svg>
<time class="article-time--published">Apr 15, 2020</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
<time class="article-time--reading">阅读时长：23 分钟</time></div></footer></div></header><section class="article-content"><h2 id="http-与-tcpip">HTTP 与 TCP/IP</h2><p>HTTP（Hypertext Transfer Protocol）是以 TCP/IP（Transmission Control Protocol/Internet Protocol）协议族为基础的，属于 TCP/IP 内部的一个子集；TCP/IP 协议族按层次分别分：</p><ul><li>应用层，预存了各类通用的应用服务（比如：FTP、DNS、ARP），HTTP 也处于该层；</li><li>传输层，提供处于网络连接中的两台计算机之间的数据传输；</li><li>网络层，负责数据包的产生以及 IP 数据包在逻辑网络上的路由转发；</li><li>数据链路层，处理连接网络的硬件部分。</li></ul><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/tcp-ip.webp" width="1378" height="1078" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/tcp-ip_hu2649988188385619257.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/tcp-ip_hu17310047811920023667.png 1024w" class="gallery-image" data-flex-grow="127" data-flex-basis="306px" alt="" fetchpriority="high" decoding="async"></p><p>利用 TCP/IP 进行网络通信时，会通过分层顺序与对方进行通信；发送端从应用层往下走，接收端则从链路层往上走；发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息；反之，接收端在层与层传输数据时，每经过一层时会把对应的首部消去。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-floor.webp" width="1372" height="1246" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-floor_hu1966358939281381564.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-floor_hu11259023133328604606.png 1024w" class="gallery-image" data-flex-grow="110" data-flex-basis="264px" alt="" fetchpriority="high" decoding="async"></p><h2 id="iptcp-与-dns">IP、TCP 与 DNS</h2><p>IP 网际协议位于网络层，用于把各种数据包传送给对方；要保证数据传送到对方那里，需要满足两个重要的条件：IP 地址和 MAC 地址（Media Access Control Address 媒体访问控制地址）；互联网中每一个资源都由 IP 地址唯一标识（IP 协议内容），一切网络设备都由 MAC 地址唯一标识。</p><p>IP 间的通信依赖 MAC 地址，通信双方通常是经过多台计算机和网络设备中转才能连接到对方；而在进行中转时，会利用下一站中转设备的 MAC 地址来搜索下一个中转目标；这时，会采用 ARP 协议（Address Resolution Protocol 地址解析协议是一个通过<strong>解析网络层</strong>地址来<strong>找寻数据链路层地址</strong>的网络传输协议），根据通信方的 IP 地址就反查出对应的 MAC 地址。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/ip-mac.webp" width="1440" height="1284" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/ip-mac_hu8746862751935202122.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/ip-mac_hu13515370086602370507.png 1024w" class="gallery-image" data-flex-grow="112" data-flex-basis="269px" alt="" fetchpriority="high" decoding="async"></p><p>TCP 位于传输层，在发送数据前，通信双方必须在彼此间建立一条连接；为了方便传输，TCP 字节流服务会将大块数据分割成以报文段为单位的数据包进行管理；为了准确无误地将数据送达目标处，TCP 协议采用了三次握手四次挥手策略。</p><p>客户端和服务端通信前要进行连接，“三次握手”的作用就是双方都能明确自己和对方的收发能力是正常的（握手的过程会确认协议类型、协议版本、编码方式、传输速率等）：</p><ul><li>第一次握手：客户端发送网络包，服务端收到了；这样服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的；</li><li>第二次握手：服务端发包，客户端收到了；这样客户端就能得出结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的；</li><li>第三次握手：客户端发包，服务端收到了；这样服务端就能得出结论：客户端的接收、发送能力，服务端的发送、接收能力是正常的。</li></ul><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/three-hand.webp" width="1408" height="780" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/three-hand_hu13342715757123569641.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/three-hand_hu5579430359098513345.png 1024w" class="gallery-image" data-flex-grow="180" data-flex-basis="433px" alt="" fetchpriority="high" decoding="async"></p><p>特别的，HTTPS 的连接建立需要七次握手，在 TCP 三次握手建立连接后，使用 TLS 握手建立安全连接（协商加密算法、加密密钥等）；HTTP/3 使用基于 UDP 的 QUIC 协议进行握手，将 TCP 和 TLS 握手过程结合起来，握手次数从七次减少到了三次。</p><p>TCP 断开链接的过程和建立链接的过程比较类似，只不过中间的两部并不总是会合成一步走，所以它分成了 4 个动作；之所以中间的两个动作没有合并，是因为 TCP 存在「半关闭」状态，也就是单向关闭。</p><img style="display:block;margin:0 auto;width:80%" src="four-hand.webp" alt="" fetchpriority="high" decoding="async" width="640" height="207200" jampack-sized="true"><p>上面有一个非常特殊的状态 time_wait，它是主动关闭的一方在回复完对方的挥手后进入的一个长期状态，这个状态标准的持续时间是 4 分钟，4 分钟后才会进入到 closed 状态，释放套接字资源。</p><p>DNS（Domain Name System）服务是和 HTTP 协议一样位于应用层的协议；它提供域名到 IP 地址之间的解析服务。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/dns.webp" width="1422" height="940" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/dns_hu3789035021281694677.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/dns_hu6978526243062653648.png 1024w" class="gallery-image" data-flex-grow="151" data-flex-basis="363px" alt="" fetchpriority="high" decoding="async"></p><h2 id="uri-与-url">URI 与 URL</h2><p>URI（统一资源标志符）就像是人的身份证号，可以把人独一无二地表示出来；URL（统一资源定位符）就像是人的居住地址，我们也可以通过住址找到这个人；不论是用定位的方式还是用编号的方式，我们都可以唯一确定一个人，都是 URI 的一种实现，而 URL 就是用定位的方式实现的 URI。</p><h2 id="http-协议">HTTP 协议</h2><p>HTTP 协议和 TCP/IP 协议族内的其他众多的协议相同，用于客户端和服务器之间的通信；请求访问文本或图像等资源的一端称为客户端，而提供资源响应的一端称为服务器端。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/request-detail.webp" width="1398" height="772" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/request-detail_hu6947579721693209447.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/request-detail_hu5844225883941731724.png 1024w" class="gallery-image" data-flex-grow="181" data-flex-basis="434px" loading="lazy" alt="" decoding="async"></p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/response-detail.webp" width="1234" height="752" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/response-detail_hu11801112506010417268.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/response-detail_hu10872324232161798714.png 1024w" class="gallery-image" data-flex-grow="164" data-flex-basis="393px" loading="lazy" alt="" decoding="async"></p><p>HTTP 是一种无状态协议，自身不对请求和响应之间的通信状态进行保存；也就是说 HTTP 对于发送过的请求或响应都不做持久化处理。cookie 技术通过在请求和响应报文中写入 cookie 信息来控制客户端的状态；cookie 会根据从服务器端发送的响应报文内的一个叫做 Set-Cookie 的首部字段信息，通知客户端保存 cookie；当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入 cookie 值后发送出去；服务器端发现客户端发送过来的 cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。</p><h2 id="http-报文">HTTP 报文</h2><p>用于 HTTP 协议交互的信息被称为 HTTP 报文；请求端的 HTTP 报文叫做请求报文，响应端的叫做响应报文；HTTP 报文本身是由多行（用 CR+LF 作换行符）数据构成的字符串文本；HTTP 报文大致可分为报文首部和报文主体两块。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/info-structure.webp" width="1476" height="530" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/info-structure_hu6512095307039987041.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/info-structure_hu15091976117863908158.png 1024w" class="gallery-image" data-flex-grow="278" data-flex-basis="668px" loading="lazy" alt="" decoding="async"></p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/re-info-1.webp" width="1502" height="788" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/re-info-1_hu15703189379492569505.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/re-info-1_hu5252623437872905592.png 1024w" class="gallery-image" data-flex-grow="190" data-flex-basis="457px" loading="lazy" alt="" decoding="async"></p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/re-info-2.webp" width="1500" height="1444" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/re-info-2_hu1488421049817534780.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/re-info-2_hu4631235119410918795.png 1024w" class="gallery-image" data-flex-grow="103" data-flex-basis="249px" loading="lazy" alt="" decoding="async"></p><h2 id="http-状态码">HTTP 状态码</h2><p>状态码的职责是当客户端向服务器端发送请求时，描述返回的请求结果。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/state-code-1.webp" width="1482" height="900" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/state-code-1_hu16213094091074086621.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/state-code-1_hu4538274450899427708.png 1024w" class="gallery-image" data-flex-grow="164" data-flex-basis="395px" loading="lazy" alt="" decoding="async"></p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/state-code-2.webp" width="1486" height="508" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/state-code-2_hu11764889963348788876.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/state-code-2_hu5380729667083946592.png 1024w" class="gallery-image" data-flex-grow="292" data-flex-basis="702px" loading="lazy" alt="" decoding="async"></p><ul><li>200 表示从客户端发来的请求在服务器端被正常处理了；</li><li>201 表示资源已创建，服务器已确认；</li><li>204 代表服务器接收的请求已成功处理，但在返回的响应报文中不含实体的主体部分；</li><li>205 与 204 的区别是“要求请求方内容重置”；</li><li>206 表示客户端进行了范围请求，而服务器成功执行了这部分请求；响应报文中包含由 Content-Range 指定范围的实体内容；</li><li>301 永久性重定向，表示请求的资源已被分配了新的 URI，以后应使用资源现在所指的 URI；默认情况下，永久重定向是会被浏览器缓存的；</li><li>302 临时性重定向，表示请求的资源已被分配了新的 URI，希望用户（本次）能使用新的 URI 访问；</li><li>303 表示由于请求对应的资源存在着另一个 URI，应<strong>使用 GET 方法</strong>定向获取请求的资源（与 302 的区别）；</li><li>304 表示服务器端资源未改变，可直接使用客户端未过期的缓存；</li><li>307 和 302 相似，唯一的区别是不允许将请求方法从 POST 改为 GET；</li><li>308 永久性重定向，和 301 相似，唯一的区别是不允许将请求方法从 POST 改为 GET；</li><li>400 表示请求报文中存在语法错误；</li><li>401 表示发送的请求需要有通过 HTTP 认证信息；</li><li>403 表明对请求资源的访问被服务器拒绝了；</li><li>404 表明服务器上无法找到请求的资源；</li><li>429 表明在一定的时间内发送了太多的请求，超出了“频次限制”；</li><li>500 表明服务器端在执行请求时发生了错误；</li><li>502 表示服务器作为网关或代理，从上游服务器收到无效响应；</li><li>503 表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求；</li><li>504 表明网关超时。</li></ul><h2 id="http-与服务器">HTTP 与服务器</h2><p>HTTP/1.1 规范允许一台 HTTP 服务器搭建多个 Web 站点，可以用一台服务器为多位客户服务，也可以以每位客户持有的域名运行各自不同的网站。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/visiual-server.webp" width="1330" height="984" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/visiual-server_hu11865609324249081725.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/visiual-server_hu15657989615794857042.png 1024w" class="gallery-image" data-flex-grow="135" data-flex-basis="324px" loading="lazy" alt="" decoding="async"></p><p>在互联网上，域名通过 DNS 服务映射到 IP 地址；当请求发送到服务器时，已经是以 IP 地址形式访问了；在相同的 IP 地址下，由于虚拟主机可以寄存多个不同主机名和域名的 Web 网站，因此在发送 HTTP 请求时，必须<strong>在 Host 首部</strong>内完整指定主机名或域名的 URI。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/host-ip.webp" width="1148" height="748" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/host-ip_hu14379628015200136465.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/host-ip_hu17293843191485586554.png 1024w" class="gallery-image" data-flex-grow="153" data-flex-basis="368px" loading="lazy" alt="" decoding="async"></p><p>HTTP 通信时，除客户端和服务器以外，还有一些用于通信数据转发的应用程序，例如代理、网关和隧道…</p><ul><li>代理：有转发功能的应用程序，位于服务器和客户端“中间人”的角色，接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端；</li><li>网关：转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理；</li><li>隧道：在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。</li></ul><p>代理服务器的基本行为就是接收客户端发送的请求后转发给其他服务器；代理不改变请求 URI，会直接发送给前方持有资源的目标服务器。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/ssr-1.webp" width="1444" height="516" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/ssr-1_hu2236362438663141655.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/ssr-1_hu5390728234964429386.png 1024w" class="gallery-image" data-flex-grow="279" data-flex-basis="671px" loading="lazy" alt="" decoding="async"></p><p>在 HTTP 通信过程中，可级联多台代理服务器；请求和响应的转发会经过数台类似锁链一样连接起来的代理服务器。转发时，需要附加 Via 首部字段以标记出经过的主机信息。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/ssr-2.webp" width="1462" height="560" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/ssr-2_hu6283945417400108809.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/ssr-2_hu11571484799965443943.png 1024w" class="gallery-image" data-flex-grow="261" data-flex-basis="626px" loading="lazy" alt="" decoding="async"></p><p>使用代理服务器的理由有：利用缓存技术减少网络带宽的流量（缓存代理）、组织内部针对特定网站的访问控制、获取访问日志、透明代理…</p><p>网关的工作机制和代理十分相似；而网关能使通信线路上的服务器提供非 HTTP 协议服务；利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保连接的安全。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/gateway.webp" width="1356" height="460" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/gateway_hu4150689369545626524.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/gateway_hu11529465670141206696.png 1024w" class="gallery-image" data-flex-grow="294" data-flex-basis="707px" loading="lazy" alt="" decoding="async"></p><p>隧道可按要求建立起一条与其他服务器的通信线路，使用 SSL 等加密手段进行通信；隧道的目的是确保客户端能与服务器进行安全的通信；隧道本身不会去解析 HTTP 请求。隧道会在通信双方断开连接时结束。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/tunnel.webp" width="1476" height="458" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/tunnel_hu16490876599303392850.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/tunnel_hu3032895337517871263.png 1024w" class="gallery-image" data-flex-grow="322" data-flex-basis="773px" loading="lazy" alt="" decoding="async"></p><h2 id="http-首部">HTTP 首部</h2><p>在请求中，HTTP 报文由方法、URI、HTTP 版本、HTTP 首部字段等部分构成。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/request-head.webp" width="1466" height="540" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/request-head_hu6824480539065545082.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/request-head_hu16578213980687508322.png 1024w" class="gallery-image" data-flex-grow="271" data-flex-basis="651px" loading="lazy" alt="" decoding="async"></p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-1.webp" width="1430" height="144" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-1_hu14378154704235537891.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-1_hu14843716915794003751.png 1024w" class="gallery-image" data-flex-grow="993" data-flex-basis="2383px" loading="lazy" alt="" decoding="async"></p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-2.webp" width="1430" height="622" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-2_hu4115080416727332962.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-2_hu467672260174007494.png 1024w" class="gallery-image" data-flex-grow="229" data-flex-basis="551px" loading="lazy" alt="" decoding="async"></p><p>在响应中，HTTP 报文由 HTTP 版本、状态码（数字和原因短语）、HTTP 首部字段 3 部分构成。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/response-head.webp" width="1470" height="544" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/response-head_hu175420653696187983.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/response-head_hu16786905080301140257.png 1024w" class="gallery-image" data-flex-grow="270" data-flex-basis="648px" loading="lazy" alt="" decoding="async"></p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-3.webp" width="1428" height="338" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-3_hu73396383781504280.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/head-3_hu11215337056385861234.png 1024w" class="gallery-image" data-flex-grow="422" data-flex-basis="1013px" loading="lazy" alt="" decoding="async"></p><p>通用首部字段：</p><ul><li>Cache-Control 用来操作缓存的工作机制；</li><li>Connection 用来控制不再转发给代理的首部字段、管理持久连接；HTTP/1.x 默认使用持久连接；</li><li>Date 表明创建 HTTP 报文的日期和时间；</li><li>Pragma 历史遗留字段，仅为向后兼容而定义；</li><li>Trailer 事先说明在报文主体后记录了哪些首部字段；</li><li>Transfer-Encoding 规定了传输报文主体时采用的编码方式；</li><li>Upgrade 用于检测 HTTP 协议及其他协议是否可使用更高的版本进行通信，其参数值可以用来指定一个完全不同的通信协议；</li><li>Via 用于追踪客户端与服务器之间的请求和响应报文的传输路径；</li><li>Warning 用于告知用户一些与缓存相关的问题的警告。</li></ul><p>请求首部字段：</p><ul><li>Accept 可通知服务器，用户代理能够处理的媒体类型及媒体类型的相对优先级；</li><li>Accept-Charset 用来通知服务器用户代理支持的字符集及字符集的相对优先顺序；</li><li>Accept-Encoding 用来告知服务器用户代理支持的内容编码及内容编码的优先级顺序；</li><li>Accept-Language 用来告知服务器用户代理能够处理的自然语言集（指中文或英文等），以及自然语言集的相对优先级；</li><li>Authorization 用来告知服务器用户代理的认证信息（证书值）；</li><li>Expect 用来告知服务器，期望出现的某种特定行为；</li><li>From 用来告知服务器，使用用户代理的用户的电子邮件地址；</li><li>Host 使用首部字段 Host 加以区分运行在同一个 IP 上的虚拟主机；</li><li>If-Match 只有当字段值跟 ETag（实体标记）值匹配一致时，服务器才会接受请求；</li><li>If-None-Match 只有当字段值与 ETag 值不一致时，服务器才会接受请求；</li><li>If-Modified-Since 字段指定的日期时间后，资源发生了更新，服务器会接受请求；</li><li>If-Unmodified-Since 字段指定的日期时间后，资源未发生更新，服务器会接受请求；</li><li>If-Range 若指定的字段值（ETag 或者时间）和请求资源的 ETag 值或时间相一致时，则作为范围请求处理；反之，则返回全体资源；</li><li>Max-Forwards 以十进制整数形式指定可经过的服务器最大数目，当服务器接收到 Max-Forwards 值为 0 的请求时，则不再进行转发，而是直接返回响应；</li><li>Proxy-Authorization 接收到从代理服务器发来的认证质询时，客户端会发送包含首部字段 Proxy-Authorization 的请求，以告知服务器认证所需要的信息；</li><li>Range 对于只需获取部分资源的范围请求，包含首部字段 Range 即可告知服务器资源的指定范围；</li><li>Referer 用来告知服务器请求的原始资源的 URI；</li><li>TE 用来告知服务器客户端能够处理响应的传输编码方式及相对优先级；它和首部字段 Accept-Encoding 的功能很相像，但是用于传输编码；</li><li>User-Agent 将创建请求的浏览器和用户代理名称等信息传达给服务器。</li></ul><p>响应首部字段：</p><ul><li>Accept-Ranges 用来告知客户端服务器是否能处理范围请求，以指定获取服务器端某个部分的资源；</li><li>Age 用来告知客户端，源服务器在多久前创建了响应；字段值的单位为秒；</li><li>ETag 可将资源以字符串形式做唯一性标识的方式；服务器会为每份资源分配对应的 ETag 值；当资源更新时，ETag 值也需要更新；生成 ETag 值时，并没有统一的算法规则，而仅仅是由服务器来分配；</li><li>Location 将响应接收方引导至某个与请求 URI 位置不同的资源；该字段会配合 3xx 的响应，提供重定向的 URI；</li><li>Proxy-Authenticate 由代理服务器所要求的认证信息发送给客户端；</li><li>Retry-After 用来告知客户端应该在多久之后再次发送请求；主要配合状态码 503/3xx 响应一起使用；</li><li>Server 用来告知客户端当前服务器上安装的 HTTP 服务器应用程序的信息；</li><li>Vary 对缓存进行控制；源服务器会向代理服务器传达关于本地缓存使用方法的命令；</li><li>WWW-Authenticate 用于 HTTP 访问认证，会告知客户端适用于访问请求 URI 所指定资源的认证方案和带参数提示的质询。</li></ul><p>实体首部字段：</p><ul><li>Allow 用于通知客户端能够支持 Request-URI 指定资源的所有 HTTP 方法；</li><li>Content-Encoding 用于告知客户端，服务器对实体的主体部分选用的内容编码方式。</li><li>Content-Language 用于告知客户端，实体主体使用的自然语言（指中文或英文等语言）；</li><li>Content-Length 表明了实体主体部分的大小；</li><li>Content-Location 给出与报文主体部分相对应的 URI；和首部字段 Location 不同，Content-Location 表示的是报文主体返回资源对应的 URI；</li><li>Content-MD5 检查报文主体在传输过程中是否保持完整，以及确认传输到达；</li><li>Content-Range 针对范围请求，返回响应时使用的首部字段 Content-Range，能告知客户端作为响应返回的实体的哪个部分符合范围请求；</li><li>Content-Type 实体主体内对象的媒体类型，和首部字段 Accept 一样，字段值用 type/subtype 形式赋值；</li><li>Expires 用于告知客户端资源失效的日期；</li><li>Last-Modified 指明资源最终修改的时间。</li></ul><p>cookie 相关首部字段：</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/cookie-1.webp" width="1478" height="284" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/cookie-1_hu10842964354536232582.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/cookie-1_hu17628936693058861729.png 1024w" class="gallery-image" data-flex-grow="520" data-flex-basis="1249px" loading="lazy" alt="" decoding="async"></p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/cookie-2.webp" width="1470" height="522" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/cookie-2_hu2205996108173098057.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/cookie-2_hu10068562243732150578.png 1024w" class="gallery-image" data-flex-grow="281" data-flex-basis="675px" loading="lazy" alt="" decoding="async"></p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/cookie-3.webp" width="1458" height="270" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/cookie-3_hu985614780195198251.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/cookie-3_hu462341594869142715.png 1024w" class="gallery-image" data-flex-grow="540" data-flex-basis="1296px" loading="lazy" alt="" decoding="async"></p><p>其他首部字段：</p><ul><li>DNT（请求首部）意为拒绝个人信息被收集，是表示拒绝被精准广告追踪的一种方法；</li><li>P3P（响应首部）可以让 Web 网站上的个人隐私变成一种仅供程序可理解的形式，以达到保护用户隐私的目的；</li><li>X-Frame-Options（响应首部）用于控制网站内容在其他 Web 网站的 Frame 标签内的显示问题，其主要目的是为了防止点击劫持攻击；</li><li>X-XSS-Protection（响应首部）针对跨站脚本攻击的一种对策，用于控制浏览器 XSS 防护机制的开关。</li></ul><h2 id="http-缓存策略">HTTP 缓存策略</h2><p>HTTP 缓存分为 2 种，一种是强缓存，另一种是协商缓存；主要作用是可以加快资源获取速度，提升用户体验，减少网络传输，降低运营成本，缓解服务端的压力。</p><p>强缓存不需要发送请求到服务端，客户端直接读取本地缓存；由 Expires、Cache-Control 和 Pragma 3 个 Header 属性共同来控制。</p><ul><li>Expires 用于告知客户端资源失效的日期；</li><li>Cache-Control 用来操作缓存的工作机制；</li><li>Pragma 历史遗留字段，值为‘no-cache’时禁用缓存（告知客户端不要对该资源进行缓存）；</li></ul><p>当强缓存失效或者被禁用的时候，客户端会到服务端去<strong>协商</strong>；如果命中了协商缓存，服务器会返回 304，告诉客户端使用协商缓存。</p><ul><li>If-Match 只有当字段值跟 ETag（实体标记）值匹配一致时，服务器才会接受请求；</li><li>If-None-Match 只有当字段值与 ETag 值不一致时，服务器才会接受请求；</li><li>If-Modified-Since 字段指定的日期时间后，资源发生了更新，服务器会接受请求；</li><li>If-Unmodified-Since 字段指定的日期时间后，资源未发生更新，服务器会接受请求；</li><li>ETag 可将资源以字符串形式做唯一性标识的方式；服务器会为每份资源分配对应的 ETag 值；当资源更新时，ETag 值也需要更新；</li><li>Last-Modified 指明资源最终修改的时间。</li></ul><h2 id="https">HTTPS</h2><p>HTTP 的缺点：</p><ul><li>通信使用明文（不加密），内容可能会被窃听；</li><li>不验证通信方的身份，因此有可能遭遇伪装；</li><li>无法证明报文的完整性，所以有可能已遭篡改。</li></ul><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/hacking.webp" width="1438" height="734" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/hacking_hu4862942591716987467.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/hacking_hu2645590012874154480.png 1024w" class="gallery-image" data-flex-grow="195" data-flex-basis="470px" loading="lazy" alt="" decoding="async"></p><p>即使已经过加密处理的通信，也会被窥视到通信内容，这点和未加密的通信是相同的；只是说如果通信经过加密，就有可能让人无法破解报文信息的含义，但加密处理后的报文信息本身还是会被看到的。</p><p>加密技术：通信加密、内容加密。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-1.webp" width="1120" height="680" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-1_hu10762277427345545254.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-1_hu17367039293577989346.png 1024w" class="gallery-image" data-flex-grow="164" data-flex-basis="395px" loading="lazy" alt="" decoding="async"></p><p>HTTP 协议中的请求和响应不会对通信方进行确认，因此会存在以下各种隐患：</p><ul><li>无法确定请求发送至目标的服务器是否是按真实意图返回响应的那台服务器；</li><li>无法确定响应返回到的客户端是否是按真实意图接收响应的那个客户端；</li><li>无法确定正在通信的对方是否具备访问权限；</li><li>无法判定请求是来自何方、出自谁手；</li><li>即使是无意义的请求也会照单全收，无法阻止海量请求下的 DoS 攻击（Denial Of Service 拒绝服务攻击）。</li></ul><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-2.webp" width="1024" height="712" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-2_hu9243186786019396986.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-2_hu16705461680840962649.png 1024w" class="gallery-image" data-flex-grow="143" data-flex-basis="345px" loading="lazy" alt="" decoding="async"></p><p>HTTP 协议无法证明通信的报文完整性；没有任何办法确认，发出的请求/响应和接收到的请求/响应是前后相同的；请求或响应在传输途中，遭攻击者拦截并篡改内容的攻击称为中间人攻击（Man-In-The-Middle Attack）。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-3.webp" width="1308" height="992" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-3_hu12608539148069994324.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-3_hu985827083971709920.png 1024w" class="gallery-image" data-flex-grow="131" data-flex-basis="316px" loading="lazy" alt="" decoding="async"></p><p>HTTPS 并非是应用层的一种新协议，只是 HTTP 通信接口部分用 SSL 和 TLS 协议代替；通常，HTTP 直接和 TCP 通信，当使用 SSL 时，则演变成先和 SSL 通信，再由 SSL 和 TCP 通信了；不光是 HTTP 协议，其他运行在应用层的 SMTP 和 Telnet 等协议均可配合 SSL 协议使用。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-4.webp" width="1180" height="564" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-4_hu17536208536607883634.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-4_hu8845884581709187144.png 1024w" class="gallery-image" data-flex-grow="209" data-flex-basis="502px" loading="lazy" alt="" decoding="async"></p><p>对称密钥加密：加密和解密同用一个密钥；非对称密钥加密：私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-5.webp" width="1424" height="1138" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-5_hu7010227162330743666.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-5_hu15180525028323860432.png 1024w" class="gallery-image" data-flex-grow="125" data-flex-basis="300px" loading="lazy" alt="" decoding="async"></p><p>HTTPS 采用“对称密钥加密”和“非对称密钥加密”两者并用的混合加密机制，“非对称密钥加密”用于交换“对称密钥加密”的密钥，“对称密钥加密”用于通信。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-6.webp" width="1280" height="1284" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-6_hu14574630850761873217.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-6_hu6384987561367034176.png 1024w" class="gallery-image" data-flex-grow="99" data-flex-basis="239px" loading="lazy" alt="" decoding="async"></p><p>如何证明公开密钥本身就是货真价实的公开密钥呢？可以使用由数字证书认证机构（CA，Certificate Authority）和其相关机关颁发的公开密钥证书。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-7.webp" width="1458" height="1138" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-7_hu5342026785760693895.png 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/https-7_hu8291569935107560077.png 1024w" class="gallery-image" data-flex-grow="128" data-flex-basis="307px" loading="lazy" alt="" decoding="async"></p><p>首先，服务器的运营人员向数字证书认证机构提出公开密钥的申请；数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书后绑定在一起。</p><p>服务器会将这份由数字证书认证机构颁发的公钥证书发送给客户端，以进行公开密钥加密方式通信；公钥证书也可叫做数字证书或直接称为证书。</p><p>接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事：一，认证服务器的公开密钥的是真实有效的数字证书认证机构；二，服务器的公开密钥是值得信赖的。</p><p>此处认证机关的公开密钥必须安全地转交给客户端；多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥。</p><h2 id="hsts">HSTS</h2><p><a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Strict-Transport-Security" target="_blank" rel="noopener">HTTP Strict Transport Security
</a>是一个安全功能，它告诉浏览器只能通过 HTTPS 访问当前资源。</p><p>当请求由 HTTP 跳转到 HTTPS 时，HSTS 可以阻止用户被中间人攻击。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">Strict</span><span class="o">-</span><span class="n">Transport</span><span class="o">-</span><span class="n">Security</span><span class="p">:</span> <span class="nb">max</span><span class="o">-</span><span class="n">age</span><span class="o">=&lt;</span><span class="n">expire</span><span class="o">-</span><span class="n">time</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Strict</span><span class="o">-</span><span class="n">Transport</span><span class="o">-</span><span class="n">Security</span><span class="p">:</span> <span class="nb">max</span><span class="o">-</span><span class="n">age</span><span class="o">=&lt;</span><span class="n">expire</span><span class="o">-</span><span class="n">time</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">includeSubDomains</span>
</span></span><span class="line"><span class="cl"><span class="n">Strict</span><span class="o">-</span><span class="n">Transport</span><span class="o">-</span><span class="n">Security</span><span class="p">:</span> <span class="nb">max</span><span class="o">-</span><span class="n">age</span><span class="o">=&lt;</span><span class="n">expire</span><span class="o">-</span><span class="n">time</span><span class="o">&gt;</span><span class="p">;</span> <span class="nb">preload</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>max-age=&lt;expire-time&gt; 表示在浏览器收到这个请求后的 &lt;expire-time&gt; 秒的时间内，凡是访问这个域名下的资源都使用 HTTPS 请求。
includeSubDomains 表示此规则也适用于该网站的所有子域名。
preload 表示浏览器将会永不使用非安全的方式连接到你的域名。</p><h2 id="web-性能优化">Web 性能优化</h2><ul><li>减少 DNS 查询：每次域名解析都需要一次网络往返，增加请求的延迟，在查询期间会阻塞请求；</li><li>减少 HTTP 请求：任何请求都不如没有请求更快，因此要去掉页面上没有必要的资源；</li><li>使用 CDN：从地理上把数据放到接近客户端的地方，可以显著减少每次 TCP 连接的网络延迟，增加吞吐量；</li><li>添加 Expires 首部并配置 ETag 标签：相关资源应该缓存，以避免重复请求每个页面中相同的资源；</li><li>使用 gzip 压缩：所有文本资源都应该使用 gzip 压缩，然后再在客户端与服务器间传输；</li><li>避免 HTTP 重定向：HTTP 重定向极其耗时，特别是把客户端定向到一个完全不同的域名的情况下，还会导致额外的 DNS 查询、TCP 连接延迟；</li><li>使用 HTTP 持久连接：避免第二次 TCP 连接时的三次握手、消除另一次 TCP 慢启动的往返，节约整整一次网络延迟。</li></ul><h2 id="cors跨域资源共享">CORS（跨域资源共享）</h2><p>CORS 请求的选择同意认证机制由底层处理，请求发出后，浏览器自动追加受保护的 Origin 首部，包含着发出请求的来源；相应地，远程服务器可以检查 Origin 首部，决定是否接受该请求，如果接受就返回 Access-Control-Allow-Origin 响应首部：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET /resource.js HTTP/1.1
</span></span><span class="line"><span class="cl">Host: thirdparty.com
</span></span><span class="line"><span class="cl">Origin: http://example.com（Origin 首部由浏览器自动设置）
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">Access-Control-Allow-Origin: http://example.com（选择同意首部由服务器设置）
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></tbody></table></div></div><p>thirdparty.com 决定同意与 example.com 跨源共享资源，因此就在响应中返回了适当的访问控制首部；假如它选择不同意接受这个请求，那么只要不在响应中包含 Access-Control-Allow-Origin 首部即可；这样，客户端的浏览器就会自动将发出的请求作废；如果第三方服务器不支持 CORS，那么客户端请求同样会作废。</p><p>CORS 还允许服务器返回一个通配值（Access-Control-Allow-Origin: *），表示它允许来自任何源的请求。</p><p>对于 CORS，浏览器还会采取一系列安全措施：</p><ul><li>CORS 请求会省略 cookie 和 HTTP 认证等用户凭据；</li><li>客户端被限制只能发送“简单的跨源请求”，包括只能使用特定的方法（GET、POST 和 HEAD）。</li></ul><p>要启用 cookie 和 HTTP 认证，客户端必须在发送请求时发送额外的属性（withCredentials），而服务器也必须以适当的首部（Access-Control-Allow-Credentials）响应，表示它允许应用发送用户的隐私数据；如果客户端需要写或者读自定义的 HTTP 首部，或者想要使用“不简单的方法”发送请求，那么它必须首先要获得第三方服务器的许可，即向第三方服务器发送一个预备（preflight）请求：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">➊ 预备请求
</span></span><span class="line"><span class="cl">OPTIONS /resource.js HTTP/1.1
</span></span><span class="line"><span class="cl">Host: thirdparty.com
</span></span><span class="line"><span class="cl">Origin: http://example.com
</span></span><span class="line"><span class="cl">Access-Control-Request-Method: POST
</span></span><span class="line"><span class="cl">Access-Control-Request-Headers: My-Custom-Header
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">➋ 预备响应
</span></span><span class="line"><span class="cl">HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">Access-Control-Allow-Origin: http://example.com
</span></span><span class="line"><span class="cl">Access-Control-Allow-Methods: GET, POST, PUT
</span></span><span class="line"><span class="cl">Access-Control-Allow-Headers: My-Custom-Header
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">➌ 正式的 HTTP 请求
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="csrf跨站请求伪造">CSRF（跨站请求伪造）</h2><p>原理是攻击者构造网站后台某个功能接口的请求地址，诱导用户去点击或者用特殊方法让该请求地址自动加载；用户在登录状态下这个请求被服务端接收后会被误以为是用户合法的操作。</p><p>最简单的 CSRF 攻击：</p><ol><li>用户 Alice 登录和访问某银行网站 A，保留 cookie；</li><li>Alice 被某些信息诱导访问危险网站 B；</li><li>危险网站 B 上有一个标签 &lt;img src=“<a class="link" href="http://www.bank.com?name=Alice&amp;money=1000&amp;for=Badman%22" target="_blank" rel="noopener">
http://www.bank.com?name=Alice&amp;money=1000&amp;for=Badman"
</a>/&gt;</li><li>这个标签的 src 不指向一张图片，而是一个 HTTP 请求，由于 Alice 的浏览器上有银行网站的 cookie，这样浏览器发出的这个请求就能得到响应执行；这样 Alice 的钱就被偷了。</li></ol><p>进阶 CSRF 攻击：</p><p>危险网站可以伪造一个表单并隐藏，并在自己网站的 onload 事件中，触发这个表单的提交事件，就可以改 GET 攻击为 POST 攻击。</p><p>CSRF 防范思路：</p><ol><li>仅仅靠发起 CSRF 攻击的话，黑客只能借助受害者的 cookie 骗取服务器的信任，但是黑客并不能拿到 cookie，也看不到 cookie 的内容；另外，对于服务器返回的结果，由于浏览器同源策略的限制，黑客也无法进行解析；</li><li>我们要保护的对象是那些可以直接产生数据改变的服务，而对于读取数据的服务，则不需要进行 CSRF 的保护；</li><li>而保护的关键，是在请求中放入黑客所不能伪造的信息。</li></ol><p>CSRF 防范手段：</p><ol><li>涉及敏感操作的请求改为 POST 请求；</li><li>用户操作限制，加入验证码机制；</li><li>验证 HTTP 头部 Origin/Referer 字段，它记录了请求的来源地址，服务器需要做的是验证这个来源地址是否合法，非法则拒绝响应；</li><li>添加隐藏字段，在请求时服务端对前端提交的隐藏字段进行验证。</li></ol><h2 id="xss跨站脚本攻击">XSS（跨站脚本攻击）</h2><p>向页面里插入恶意 Script 代码（代码注入型攻击）；当用户浏览该页时，嵌入其中 Script 代码会被执行，从而达到恶意攻击用户的目的；归根结底，XSS 就是想办法让用户的浏览器去执行一些这个网页中原本不存在的前端代码。</p><p>XSS 的危害：</p><ul><li>窃取网页浏览中的 cookie；</li><li>劫持流量实现恶意跳转。</li></ul><p>如何利用 XSS：</p><ul><li>大小写绕过：因为网站仅仅只过滤了 &lt;script/&gt; 标签，而没有考虑标签中的大小写并不影响浏览器的解释；</li><li>不是只有 script 标签才可以插入代码：&lt;img src=‘w.123’ onerror=‘alert(“hey!”)’ /&gt;；</li><li>编码脚本代码绕过关键字过滤：eval(\u0061\u006c\u0065\u0072\u0074(1))；</li><li>主动闭合标签实现注入代码：var a = “";alert(1);”";。</li></ul><p>XSS 防范手段：</p><ul><li>对用户输入信息进行过滤，不允许用户插入 HTML 标签，对用户输入信息长度进行限制；</li><li>严格的 <a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener">CSP
</a>（Content Security Policy）策略；</li><li>开启 <a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Subresource_Integrity" target="_blank" rel="noopener">SRI
</a>（Subresource Integrity）策略。</li></ul><h2 id="http2">HTTP/2</h2><p>HTTP/2 的出现，相比于 HTTP/1.x，大幅度的提升了性能；在与 HTTP/1.1 完全语义兼容的基础上，进一步减少了网络延迟。</p><img style="display:inline-block;margin:0 auto;width:47%" src="http-1.x.webp" alt="" loading="lazy" decoding="async" width="1480" height="1288" jampack-sized="true" srcset="http-1.x.webp 1480w, http-1.x@880w.webp 880w" sizes="100vw">
<img style="display:inline-block;margin:0 auto;width:51.5%" src="http-2.0.webp" alt="" loading="lazy" decoding="async" width="1614" height="1288" jampack-sized="true" srcset="http-2.0.webp 1614w, http-2.0@1014w.webp 1014w" sizes="100vw"><p>多路复用允许同时通过单一的 HTTP/2 连接发起多重的请求 - 响应消息；众所周知，在 HTTP/1.1 协议中「浏览器客户端在同一时间，针对同一域名下的请求有一定数量限制；超过限制数目的请求会被阻塞」；这也是为何一些站点会有多个静态资源 CDN 域名的原因之一。而 HTTP/2 的多路复用则允许同时通过单一的 HTTP/2 连接发起多重的请求 - 响应消息。</p><p><img src="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/multiplexing.webp" width="1602" height="1588" srcset="/p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/multiplexing_hu16284014670261275760.jpg 480w, /p/%E5%9B%BE%E8%A7%A3-http%E7%AC%94%E8%AE%B0/multiplexing_hu8792200879870886093.jpg 1024w" class="gallery-image" data-flex-grow="100" data-flex-basis="242px" loading="lazy" alt="" decoding="async"></p><p>因此 HTTP/2 可以很容易的去实现多流并行而不用依赖建立多个 TCP 连接，HTTP/2 把 HTTP 协议通信的基本单位缩小为一个一个的帧，这些帧对应着逻辑流中的消息并行地在同一个 TCP 连接上双向交换消息。</p><p>在不改动 HTTP/1.x 的语义、方法、状态码、URI 以及首部字段的情况下，HTTP/2 是如何做到「突破 HTTP/1.x 的性能限制，改进传输性能，实现低延迟和高吞吐量」的？关键之一就是在应用层（HTTP）和传输层（TCP or UDP）之间增加一个二进制分帧层。</p><img style="display:block;margin:0 auto;width:80%" src="binary.webp" alt="" loading="lazy" decoding="async" width="625" height="324" jampack-sized="true"><p>HTTP/1.x 以换行符作为纯文本的分隔符，而 HTTP/2 将所有传输的信息分割为更小的消息和帧，并采用二进制格式对它们编码。</p><p>在二进制分帧层中，HTTP/2 会将所有传输的信息分割为更小的消息和帧（frame），并对它们采用二进制格式的编码，其中 HTTP/1.x 的首部信息会被封装到 HEADER frame，而相应的 Request Body 则封装到 DATA frame 里面；HTTP/2 通信都在一个连接上完成，这个连接可以承载任意数量的双向数据流。</p><p>在过去，HTTP 性能优化的关键并不在于高带宽，而是低延迟；TCP 连接会随着时间进行自我「调谐」，起初会限制连接的最大速度，如果数据成功传输，会随着时间的推移提高传输的速度；这种调谐则被称为 TCP 慢启动。由于这种原因，让原本就具有突发性和短时性的 HTTP 连接变的十分低效。</p><img style="display:block;margin:0 auto;width:80%" src="frame.webp" alt="" loading="lazy" decoding="async" width="772" height="555" jampack-sized="true"><p>HTTP/2 通过让所有数据流共用同一个连接，可以更有效地使用 TCP 连接，让高带宽也能真正的服务于 HTTP 的性能提升；单连接多资源的方式，减少服务端的链接压力，内存占用更少，连接吞吐量更大；由于 TCP 连接的减少而使网络拥塞状况得以改善，同时慢启动时间的减少；使拥塞和丢包恢复速度更快。</p><p>HTTP/1.x 并不支持 HTTP 首部压缩，为此 SPDY 和 HTTP/2 应运而生，SPDY 使用的是通用的<a class="link" href="https://en.wikipedia.org/wiki/DEFLATE" target="_blank" rel="noopener">
DEFLATE
</a>算法，而 HTTP/2 则使用了专门为首部压缩而设计的<a class="link" href="https://http2.github.io/http2-spec/compression.html" target="_blank" rel="noopener">
HPACK
</a>算法。</p><img style="display:block;margin:0 auto;width:80%" src="server-push.webp" alt="" loading="lazy" decoding="async" width="492" height="211" jampack-sized="true"><p><a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events/Using_server-sent_events" target="_blank" rel="noopener">服务端推送/SSE
</a>是一种在客户端请求之前发送数据的机制。在 HTTP/2 中，服务器可以对客户端的一个请求发送多个响应；Server Push 让 HTTP/1.x 时代使用内嵌资源的优化手段变得没有意义。</p><p>如果一个请求是由你的主页发起的，服务器很可能会响应主页内容、Logo 以及样式表，因为它知道客户端会用到这些东西；这相当于在一个 HTML 文档内集合了所有的资源，不过与之相比，服务器推送还有一个很大的优势：可以缓存！也让在遵循同源的情况下，不同页面之间可以共享缓存资源成为可能。</p><h2 id="http3">HTTP/3</h2><p>HTTP/3 相比于之前版本的一个重要区别：是它在一种新的传输协议 QUIC 上运行；QUIC 专为移动密集型互联网使用而设计。QUIC 的使用意味着 HTTP/3 依赖于用户数据报协议（UDP），而不是传输控制协议（TCP）；切换到 UDP 将使在线浏览时的连接速度和用户体验更快。</p><p>QUIC 将帮助修复 HTTP/2 的一些重大缺点：</p><ul><li>解决当智能手机从 Wi-Fi 切换到蜂窝数据时性能缓慢的问题；</li><li>减少丢包的影响，当一个信息包没有到达目的地时，它不会再阻塞所有的信息流（称为“队头阻塞”的问题）；</li><li>更快的连接建立：QUIC 允许 TLS 版本协商与加密和传输握手同时发生；</li><li>零往返时间（0-RTT）：对于它们已经连接的服务器，客户端可以跳过握手要求；</li><li>更全面的加密：QUIC 的新握手方式将默认提供加密，有助于减轻攻击的风险。</li></ul><p>为什么选择 QUIC？你会发现 HTTP/3 在 UDP 上“实现了一个”TCP 2.0：</p><ul><li>原先的 TCP 是通过一个个数据包传输信息的，QUIC 将二进制分帧从 HTTP/2 拿到了 QUIC；</li><li>数据帧会被进一步封装成带有 ConnectID 的 QUIC 数据包，减少网络切换波动；</li><li>将 HTTP/2 的 HPACK 头部压缩整合到了 QUIC，现在叫做 QPACK；</li><li>将 TLS 握手和 TCP 握手整合到了一起，现在为 QUIC 握手；</li><li>为了兼容现有设备，实现广泛部署，只能做在 UDP 上。</li></ul><h3 id="默认加密">默认加密</h3><p>在传输层而不是在应用层进行加密，意味着连接将始终被加密。以前，在 HTTPS 中，加密和传输层连接是分开发生的。TCP 连接可以携带加密或未加密的数据，TCP 握手和 TLS 握手是不同的事件。但是，QUIC 默认在传输层设置加密连接——应用层数据将始终被加密。</p><p>QUIC 通过将两次握手合并为一个动作来实现这一点，从而减少延迟，因为应用程序在发送数据之前只需等待一次握手完成。它还加密有关每个连接的元数据，包括数据包编号和标头的其他一些部分，以帮助防止攻击者掌握有关用户行为的信息。HTTP/2 中不包含此功能。加密这些数据有助于防止攻击者掌握有关用户行为的可操作信息。</p><h2 id="浏览器缓存">浏览器缓存</h2><p>缓存位置：</p><ul><li>ServiceWorker：传输协议必须为 HTTPS，开发者控制缓存哪些文件、如何匹配缓存、如何读取缓存；</li><li>MemoryCache：读取高效，缓存时间短；不受 Cache-Control 限制；Tab 关闭，缓存失效；prefetch 缓存存在于此；</li><li>DiskCache：读取稍慢，缓存时间长；受到 HTTP 请求/响应头缓存字段的控制；一般存放使用频率不那么高、体积较大的文件；</li><li>PushCache：只在会话（Session）中存在；并且仅适用于 HTTP/2 的连接。</li></ul><p>用户行为：</p><ul><li>地址栏输入：查找 DiskCache 中是否有匹配；如有则使用，如没有则发送网络请求；</li><li>普通刷新：因为 Tab 并没有关闭，因此优先使用 MemoryCache，其次才是 DiskCache；</li><li>强制刷新：不使用缓存，因此发送的请求头部均带有 cache-control: no-cache，服务器直接返回 200 和最新内容。</li></ul><h2 id="cookiesession-和-token">Cookie、Session 和 Token</h2><p>HTTP 是一种无状态协议，每个请求都是独立存在的，服务端无法区分当前在给谁提供服务，所以才有了 cookie、session 和 token；它们是一种客户端身份凭证，用来告诉服务端‘我’是谁。</p><ul><li>cookie：服务端保存在客户端的数据，每次请求会自动发送给服务端；不能跨域，仅在相同域名下共享；仅能保存有限数据；</li><li>session：服务端保存 session、客户端保存 sessionId（服务器提供并保存），重要信息保存在服务端；可以存无限多的数据；</li><li>token：服务端提供 token，客户端保存并在每次请求时放入请求头，服务端解析 token 验证客户端。</li></ul><h2 id="参考">参考</h2><ul><li><a class="link" href="https://zhuanlan.zhihu.com/p/46592479" target="_blank" rel="noopener">前端安全系列之二：如何防止 CSRF 攻击？</a></li><li><a class="link" href="https://www.bilibili.com/video/BV1vv4y1U77y" target="_blank" rel="noopener">HTTP/1.1，HTTP/2 和 HTTP/3 的区别</a></li><li><a class="link" href="https://www.zhihu.com/question/34074946/answer/75364178" target="_blank" rel="noopener">HTTP 2.0 相比 1.x 有哪些重大改进？</a></li><li><a class="link" href="https://zhuanlan.zhihu.com/p/37293032" target="_blank" rel="noopener">对于跨站伪造请求的理解和总结</a></li><li><a class="link" href="https://github.com/pro648/tips/blob/master/sources/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E3%80%81%E4%B8%83%E6%AC%A1%E6%8F%A1%E6%89%8B%E3%80%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.md" target="_blank" rel="noopener">三次握手、七次握手、四次挥手</a></li><li><a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Strict-Transport-Security" target="_blank" rel="noopener">HTTP Strict Transport Security</a></li><li><a class="link" href="https://www.infoq.cn/article/8vu-vcrhoxducafprnol" target="_blank" rel="noopener">深入理解浏览器的缓存机制</a></li><li><a class="link" href="https://zhuanlan.zhihu.com/p/26177815" target="_blank" rel="noopener">浅谈 XSS 攻击的那些事</a></li><li><a class="link" href="https://www.cloudflare.com/zh-cn/learning/performance/what-is-http3" target="_blank" rel="noopener">什么是 HTTP/3？</a></li><li><a class="link" href="https://zhuanlan.zhihu.com/p/22521378" target="_blank" rel="noopener">CSRF 是什么？</a></li></ul></section><footer class="article-footer"><section class="article-not-by-ai-badge"><a href="https://notbyai.fyi/cn/" target="_blank" title="Not By AI"><svg width="131" height="42" viewBox="0 0 131 42" fill="none"><path d="M.5.5H116c8.008.0 14.5 6.49187 14.5 14.5V41.5H15C6.99187 41.5.5 35.0081.5 27V.5z" fill="#fff" stroke="#000"></path><path d="M17.9605 24.1575c3.4661 2.8068 8.4231 2.8068 11.8892.0l-1.3402-1.6549c-2.6847 2.174-6.5241 2.174-9.2088.0l-1.3402 1.6549z" fill="#000"></path><path d="M19.404 20.5134V17.6365h2.1296v2.8769H19.404z" fill="#000"></path><path d="M26.012 17.6365v2.8769h2.1295V17.6365H26.012z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M35 21.5C35 27.8513 29.8513 33 23.5 33S12 27.8513 12 21.5C12 15.1487 17.1487 10 23.5 10S35 15.1487 35 21.5zm-2.1295.0c0 5.1752-4.1953 9.3705-9.3705 9.3705S14.1295 26.6752 14.1295 21.5s4.1953-9.3705 9.3705-9.3705 9.3705 4.1953 9.3705 9.3705z" fill="#000"></path><path d="M61.844 12.1721l.1995.711L62.2294 12.8197C62.5169 12.7216 62.8276 12.6155 63.1503 12.5052v2.55C63.1503 15.1818 63.1005 15.2208 62.9709 15.2208 62.8612 15.2208 62.4922 15.2208 62.0634 15.211 62.1631 15.4156 62.2628 15.7273 62.2928 15.9123 62.901 15.9123 63.28 15.8929 63.5293 15.776 63.7686 15.6591 63.8583 15.4545 63.8583 15.0455V12.2629C64.2106 12.1421 64.5673 12.0195 64.9154 11.8994L64.8057 11.2273C64.4898 11.3348 64.1706 11.4415 63.8583 11.5441V9.63961H64.8057V8.95779H63.8583V7H63.1503V8.95779H61.9936v.68182h1.1567V11.7732C62.6577 11.9301 62.2064 12.0683 61.844 12.1721z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M66.0322 10.7695C65.3142 10.7695 65.1347 10.5162 65.1347 9.8052V7.39935h2.6127V9.32792H65.763V9.81494C65.763 10.1169 65.8128 10.2045 66.0322 10.2045H67.2986C67.4781 10.2045 67.7474 10.1948 67.9069 10.1656 67.9134 10.2165 67.92 10.2777 67.9268 10.3422 67.941 10.4754 67.9566 10.6224 67.9767 10.7208 67.8371 10.7597 67.5779 10.7695 67.3086 10.7695H66.0322zM65.763 7.90584H67.1391V8.82143H65.763V7.90584z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M69.0736 10.7208C68.3656 10.7208 68.1861 10.4773 68.1861 9.76623V7.39935H70.8087V9.2987H68.8144V9.77597C68.8144 10.0682 68.8642 10.1656 69.0936 10.1656h1.3262C70.5993 10.1656 70.8985 10.1461 71.058 10.1071 71.068 10.2825 71.0979 10.5357 71.1179 10.6721 70.9783 10.7208 70.709 10.7208 70.4298 10.7208H69.0736zM68.8144 7.90584h1.396v.88637h-1.396V7.90584z" fill="#000"></path><path d="M66.83 14.1299C66.2715 14.6753 65.3142 15.1818 64.4567 15.5032 64.6262 15.6201 64.9054 15.8539 65.035 15.9805 65.8727 15.6104 66.8898 14.9968 67.5081 14.3831L66.83 14.1299z" fill="#000"></path><path d="M68.4554 14.4513C69.2132 14.9091 70.1905 15.5812 70.6791 16L71.2974 15.6104C70.7788 15.1818 69.7916 14.539 69.0437 14.1007L68.4554 14.4513z" fill="#000"></path><path d="M50.4761 15.9318C49.798 15.5617 48.6612 15.0942 47.5344 14.7338L48.0031 14.2468C49.1299 14.5974 50.3564 15.0552 51.0844 15.4253L50.4761 15.9318z" fill="#000"></path><path d="M42 15.4156C43.067 15.1623 44.4032 14.6656 45.0713 14.2468L45.7594 14.6753C44.9218 15.1721 43.5855 15.6786 42.5185 15.9513 42.4088 15.8052 42.1596 15.5519 42 15.4156z" fill="#000"></path><path d="M56.1556 7.21693C56.1571 7.15007 56.1585 7.0868 56.1601 7.02922H56.9877L56.9868 7.0714C56.9788 7.4194 56.968 7.88942 56.9233 8.43665 57.0639 9.58208 57.6711 13.7136 61.2258 15.2597 61.0064 15.4253 60.787 15.6786 60.6773 15.8831c-2.5071-1.144-3.5872-3.5484-4.0775-5.3684C56.13 12.4644 55.0681 14.6445 52.63 15.9221 52.5004 15.7273 52.2511 15.5032 52.0217 15.3474c3.9976-1.9757 4.0968-6.45452 4.1339-8.13047z" fill="#000"></path><path d="M75.0586 9.43506C75.1376 9.06022 75.2116 8.69288 75.2761 8.3539L74.5283 8.27597C74.3089 9.50325 73.9299 11.1688 73.6408 12.1623L74.3986 12.2305C74.4264 12.1301 74.4552 12.0226 74.4848 11.9091H78.3699C78.3296 12.3408 78.2883 12.7224 78.2455 13.0584H72.0851V13.7403h6.0611C78.0034 14.5883 77.8408 15.0239 77.6395 15.1916 77.5198 15.289 77.4002 15.2987 77.1708 15.2987 76.9215 15.2987 76.2334 15.2987 75.5454 15.2305 75.675 15.4253 75.7747 15.7175 75.7947 15.9221 76.4429 15.961 77.091 15.9708 77.4201 15.9513 77.799 15.9318 78.0284 15.8636 78.2677 15.6396 78.532 15.3814 78.7263 14.8409 78.8969 13.7403H81V13.0584H78.991C79.0434 12.6344 79.0943 12.1472 79.1452 11.5877 79.1552 11.4805 79.1751 11.2565 79.1751 11.2565H74.6483C74.7379 10.8862 74.8303 10.4846 74.92 10.0779H79.2948V9.43506H75.0586z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M65.1746 11.6266V12.25H66.5109v1.1299H64.7558v.6233H71.1079v-.6233H69.5523V12.25h1.3262v-.6234H69.5523v-.6623H68.8642v.6623H67.189V10.9838H66.5109V11.6266H65.1746zm2.0144 1.7533V12.25h1.6752v1.1299H67.189z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M42.1895 14.0909v-.6234h1.4359V9.06494h2.5129V8.4513H42.4687V7.81818h3.6696V7.00974H46.8762v.80844H50.7852V8.4513H46.8762v.61364h2.7623V13.4675h1.406v.6234h-8.855zm2.1539-.6234h4.5472V12.7857H44.3434V13.4675zm0-1.1493h4.5472V11.7338H44.3434V12.3182zm0-1.0617h4.5472v-.5747H44.3434v.5747zm0-1.0325h4.5472V9.58117H44.3434V10.224z" fill="#000"></path><path d="M72.3245 9.65909V7.52597h8.4362V9.65909H79.9829V8.20779H73.0624v1.4513H72.3245z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M105.32 26.2505C105.32 25.9898 105.336 25.4196 105.336 25.4196H101.424V23.8717H105.573C105.764 26.2238 106.11 28.471 106.651 30.2984c-.875.9892-1.892 1.8173-3.039 2.4531C104.107 33.2077 104.953 34.2016 105.288 34.7067 106.138 34.1597 106.93 33.5082 107.658 32.7639 108.338 33.9391 109.193 34.6415 110.254 34.6415 111.898 34.6415 112.649 33.9572 113 30.78 112.377 30.5356 111.563 29.9817 111.036 29.4277 110.956 31.4155 110.765 32.2301 110.445 32.2301 110.06 32.2301 109.67 31.686 109.312 30.7655 110.465 29.1244 111.389 27.1985 112.058 25.0611L109.711 24.4908C109.396 25.6095 108.983 26.659 108.478 27.6243 108.264 26.4884 108.09 25.2105 107.974 23.8717h4.866V21.5418H111.142L111.946 20.6945C111.387 20.1568 110.27 19.4399 109.455 19l-1.405 1.4175C108.553 20.7329 109.148 21.1437 109.647 21.5418H107.835C107.811 20.7923 107.808 20.0385 107.827 19.2933h-2.443C105.387 20.0364 105.403 20.7892 105.433 21.5418H98.9812v4.8879C98.9812 28.5642 98.9014 31.4481 97.7199 33.3707 98.2468 33.6477 99.3006 34.5275 99.6997 35 100.514 33.7498 100.957 32.0088 101.189 30.2753 101.506 30.8638 101.745 31.7506 101.775 32.4257 102.51 32.4257 103.18 32.4094 103.612 32.3279 104.091 32.2301 104.458 32.0672 104.809 31.5947 105.192 31.0733 105.272 29.5743 105.32 26.2505zM101.197 30.2141C101.316 29.3052 101.378 28.4 101.406 27.5703h1.652C103.023 29.1922 102.963 29.8644 102.829 30.0631 102.701 30.2261 102.558 30.2749 102.35 30.2749 102.102 30.2749 101.674 30.2596 101.197 30.2141z" fill="#000"></path><path d="M86.8673 22.112C87.1314 21.4187 87.3672 20.705 87.565 19.9939L85.1541 19.4399C84.6112 21.6395 83.5893 23.8717 82.3599 25.2077 82.9507 25.5336 83.9885 26.2342 84.4515 26.6415 84.9297 26.0332 85.4007 25.2744 85.839 24.4257h3.0672v2.4928H84.7709v2.2811h4.1353V32.002H82.8708v2.3137H97.4005V32.002H91.3332V29.1996H95.9156V26.9185H91.3332V24.4257H96.5543V22.112H91.3332V19.277H88.9062v2.835H86.8673z" fill="#000"></path><path d="M47.3436 28.4645C47.4377 28.0285 47.4856 27.6141 47.4988 27.2444H43.8462V25.11h3.6564V23.4807h-3.816V21.2811h3.816V19.3585h2.2992V27c0 2.8513-.862200000000001 6.0611-4.774 7.9837C44.6446 34.4134 43.9261 33.6802 43.3672 33.224 44.7784 32.6761 45.7414 31.786 46.3804 30.8057 45.6568 30.9237 44.9507 31.0375 44.2921 31.1436L43.4151 31.2851 43 28.9226C44.1273 28.8236 45.7056 28.6496 47.3436 28.4645z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M72.6755 34.3305 67.632 19.7976H64.2697L59.1875 34.3305h3.1111L63.2841 31.3431H68.5306l.9178 2.9874H72.6755zM65.9218 23.1202l1.7778 5.7186H64.0861l1.8357-5.7186z" fill="#000"></path><path d="M53.7456 19.3585v1.9226h4.1833v2.1996H53.7456V25.11H57.5457v2.1344H53.7456v1.6619H58.2163v2.1996H53.7456v3.6497H51.4144V19.3585h2.3312z" fill="#000"></path><path d="M75.2125 22.2696v9.5922H73.4582v2.4721H79.719V31.8618h-1.55V22.2696h1.55v-2.472H73.4582v2.472h1.7543z" fill="#000"></path></svg></a></section></footer></article><aside class="related-content--wrapper"><h2 class="section-title">相关文章</h2><div class="related-content"><div class="flex article-list--tile"><article class="has-image"><a href="/p/%E8%BD%AChttps-%E5%8E%9F%E7%90%86%E4%B8%80%E6%AC%A1%E5%AE%89%E5%85%A8%E5%8F%AF%E9%9D%A0%E7%9A%84%E9%80%9A%E4%BF%A1/"><div class="article-image"><img src="/img/cover/http.webp" loading="lazy" data-key="" data-hash="/img/cover/http.png" alt="" decoding="async" width="1200" height="720" jampack-sized="true"></div><div class="article-details"><h2 class="article-title">「转」HTTPS 原理，一次安全可靠的通信</h2></div></a></article></div></div></aside><footer class="site-footer"><section class="copyright" style="display:flex;justify-content:flex-start;align-items:center">©
2017 -
2025
<a href="https://github.com/ElementRef" target="_blank">馬腊咯稽
</a><a href="https://ipw.cn/ipv6webcheck/?site=elementref.github.io" target="_blank" title="本站支持 IPv6 访问"><img style="display:inline-block;vertical-align:middle" src="https://static.ipw.cn/icon/ipv6-certified-lite-s1.svg" alt="本站支持 IPv6 访问" loading="lazy" decoding="async"></a></section><section class="powerby">Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>, Deploy by Actions<br>主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.13.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计</section></footer><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="关闭"></button>
<button class="pswp__button pswp__button--fs" title="全屏"></button>
<button class="pswp__button pswp__button--zoom" title="缩放"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="上一张"></button>
<button class="pswp__button pswp__button--arrow--right" title="下一张"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js" integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin="anonymous" defer=""></script><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin="anonymous" defer=""></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css" crossorigin="anonymous"></main><aside class="sidebar sticky right-sidebar"><section class="archives widget"><div class="widget-icon"><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><line x1="5" y1="9" x2="19" y2="9"></line><line x1="5" y1="15" x2="19" y2="15"></line><line x1="11" y1="4" x2="7" y2="20"></line><line x1="17" y1="4" x2="13" y2="20"></line></svg></div><h2 class="section-title widget-title">目录</h2><div class="widget--toc"><nav id="TableOfContents"><ol><li><a href="#http-与-tcpip">HTTP 与 TCP/IP</a></li><li><a href="#iptcp-与-dns">IP、TCP 与 DNS</a></li><li><a href="#uri-与-url">URI 与 URL</a></li><li><a href="#http-协议">HTTP 协议</a></li><li><a href="#http-报文">HTTP 报文</a></li><li><a href="#http-状态码">HTTP 状态码</a></li><li><a href="#http-与服务器">HTTP 与服务器</a></li><li><a href="#http-首部">HTTP 首部</a></li><li><a href="#http-缓存策略">HTTP 缓存策略</a></li><li><a href="#https">HTTPS</a></li><li><a href="#hsts">HSTS</a></li><li><a href="#web-性能优化">Web 性能优化</a></li><li><a href="#cors跨域资源共享">CORS（跨域资源共享）</a></li><li><a href="#csrf跨站请求伪造">CSRF（跨站请求伪造）</a></li><li><a href="#xss跨站脚本攻击">XSS（跨站脚本攻击）</a></li><li><a href="#http2">HTTP/2</a></li><li><a href="#http3">HTTP/3</a><ol><li><a href="#默认加密">默认加密</a></li></ol></li><li><a href="#浏览器缓存">浏览器缓存</a></li><li><a href="#cookiesession-和-token">Cookie、Session 和 Token</a></li><li><a href="#参考">参考</a></li></ol></nav></div></section></aside></div><script src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js" integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin="anonymous"></script><script type="text/javascript" src="/ts/main.js" defer=""></script><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><script>NProgress.configure({showSpinner:!1}),NProgress.start(),document.addEventListener("readystatechange",()=>{document.readyState==="interactive"&&NProgress.inc(.8),document.readyState==="complete"&&NProgress.done()})</script></body></html>