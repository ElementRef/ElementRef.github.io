<!DOCTYPE html><html lang="zh-cn" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="为什么性能很重要：
好的性能可以更好地吸引并留住用户； 留住用户等于高的业务转化率； 性能关乎用户体验。 核心指标 Web Vitals 针对网站性能，提出了三个关键指标，LCP、INP、CLS：
"><title>前端性能优化 · I AM BEA, I DRINK TEA</title>
<link rel="canonical" href="https://ElementRef.github.io/p/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><link rel="stylesheet" href="/scss/style.min.768fd56bd119bc327d9867a1f97414c00c0681df9a38395cd89a4fa46f5c7157.css"><meta property="og:title" content="前端性能优化"><meta property="og:description" content="为什么性能很重要：
好的性能可以更好地吸引并留住用户； 留住用户等于高的业务转化率； 性能关乎用户体验。 核心指标 Web Vitals 针对网站性能，提出了三个关键指标，LCP、INP、CLS：
"><meta property="og:url" content="https://ElementRef.github.io/p/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><meta property="og:site_name" content="馬腊咯稽"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2024-11-05T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-05T00:00:00+00:00"><meta property="og:image" content="https://ElementRef.github.io/img/cover/javascript.png"><meta property="og:logo" content="https://ElementRef.github.io/img/cover/javascript.png"><meta name="twitter:title" content="前端性能优化"><meta name="twitter:description" content="为什么性能很重要：
好的性能可以更好地吸引并留住用户； 留住用户等于高的业务转化率； 性能关乎用户体验。 核心指标 Web Vitals 针对网站性能，提出了三个关键指标，LCP、INP、CLS：
"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://ElementRef.github.io/img/cover/javascript.png"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><meta name="robots" content="noarchive, noindex, nofollow"><meta name="theme-color" content="#ffffff"><script defer="" src="https://umami.pavilion0321907.workers.dev/elementref.js" data-website-id="87868be0-a9cf-4f8c-8fee-e3cbb99e6cf2"></script></head><body class="article-page"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
<span class="hamburger-box"><span class="hamburger-inner"></span></span></button><header><figure class="site-avatar"><a href="/"><img src="/img/avatar_hu7590466716559688570.webp" width="300" height="404" class="site-logo" alt="Avatar" fetchpriority="high" decoding="async"></a></figure><div class="site-meta"><h1 class="site-name"><a href="/">馬腊咯稽</a></h1><h2 class="site-description">I AM BEA, I DRINK TEA</h2></div></header><ol class="social-menu"><li><a href="https://space.bilibili.com/593541941" target="_blank" title="Bilibili"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M3 10a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7a4 4 0 01-4-4v-6z"></path><path d="M8 3l2 3"></path><path d="M16 3l-2 3"></path><path d="M9 13v-2"></path><path d="M15 11v2"></path></svg></a></li><li><a href="https://x.com/SpiciComic" target="_blank" title="Twitter"><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"></path></svg></a></li><li><a href="https://github.com/ElementRef" target="_blank" title="GitHub"><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"></path></svg></a></li><li><a href="https://m.weibo.cn/u/6447635754" target="_blank" title="Weibo"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-weibo"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M19 14.127C19 17.2 15.498 20 11 20c-4.126.0-8-2.224-8-5.565.0-1.78.984-3.737 2.7-5.567 2.362-2.51 5.193-3.687 6.551-2.238.415.44.752 1.39.749 2.062 2-1.615 4.308.387 3.5 2.693 1.26.557 2.5.538 2.5 2.742z"></path><path d="M15 4h1a5 5 0 015 5v1"></path></svg></a></li><li><a href="https://last.fm/zh/user/SpiciComic/listening-report" target="_blank" title="Last.fm"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-lastfm"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M20 8c-.83-1-1.388-1-2-1-.612.0-2 .271-2 2s1.384 2.233 3 3 2.125 1.812 2 3-1 2-3 2-3-1-3.5-2-1.585-4.78-2.497-6a5 5 0 10-1 7"></path></svg></a></li></ol><ol class="menu" id="main-menu"><li><a href="/"><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><polyline points="5 12 3 12 12 3 21 12 19 12"></polyline><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"></path></svg>
<span>首页</span></a></li><li><a href="/archives/"><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><rect x="3" y="4" width="18" height="4" rx="2"></rect><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"></path><line x1="10" y1="12" x2="14" y2="12"></line></svg>
<span>归档</span></a></li><li><a href="/search/"><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="10" cy="10" r="7"></circle><line x1="21" y1="21" x2="15" y2="15"></line></svg>
<span>搜索</span></a></li><li><a href="/%E5%90%AF%E5%8F%91/"><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"></path><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"></path></svg>
<span>启发</span></a></li><li><a href="/%E5%91%BD%E4%BB%A4/"><svg class="icon icon-tabler icon-tabler-terminal" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 7l5 5-5 5"></path><line x1="12" y1="19" x2="19" y2="19"></line></svg>
<span>命令</span></a></li><li><a href="/index.xml" target="_blank"><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="5" cy="19" r="1"></circle><path d="M4 4a16 16 0 0116 16"></path><path d="M4 11a9 9 0 019 9"></path></svg>
<span>订阅</span></a></li><li><a href="/%E5%85%B3%E4%BA%8E/"><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"></path></svg>
<span>关于</span></a></li><div class="menu-bottom-section"><li id="dark-mode-toggle"><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="8" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="16" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<span>深色</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class="article-header"><div class="article-image"><a href="/p/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><img src="/img/cover/javascript.webp" alt="前端性能优化" fetchpriority="high" decoding="async" width="1998" height="1200" srcset="/img/cover/javascript.webp 1998w, /img/cover/javascript@798w.webp 798w" sizes="100vw"></a></div><div class="article-details"><header class="article-category"><a href="/categories/js/">JS</a></header><div class="article-title-wrapper"><h2 class="article-title"><a href="/p/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">前端性能优化</a></h2></div><footer class="article-time"><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"></path><circle cx="18" cy="18" r="4"></circle><path d="M15 3v4"></path><path d="M7 3v4"></path><path d="M3 11h16"></path><path d="M18 16.496V18l1 1"></path></svg>
<time class="article-time--published">Nov 05, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
<time class="article-time--reading">阅读时长：9 分钟</time></div></footer></div></header><section class="article-content"><p>为什么性能很重要：</p><ul><li>好的性能可以更好地吸引并留住用户；</li><li>留住用户等于高的业务转化率；</li><li>性能关乎用户体验。</li></ul><h2 id="核心指标">核心指标</h2><p><a class="link" href="https://web.dev/articles/vitals?hl=zh-cn" target="_blank" rel="noopener">Web Vitals
</a>针对网站性能，提出了三个关键指标，LCP、INP、CLS：</p><ul><li>LCP(Largest Contentful Paint)，最大内容绘制，衡量<strong>加载</strong>性能；应在开始加载后的 2.5 秒内完成：<ul><li>衡量从网页开始加载到屏幕上呈现最大的文本块或图片元素（主要内容）所用的时间；</li><li>如果元素超出视口范围或者被剪裁，则这些部分不会计入元素的大小。</li></ul></li><li>INP(Interaction to Next Paint)，交互响应绘制，衡量交互性能；对用户操作的响应不应超过 200 毫秒：<ul><li>FID 仅衡量网页上首次互动的输入延迟，INP 观察网页上的<strong>所有交互</strong>；</li><li>衡量与网页进行的每个点按、点击或键盘互动的<strong>延迟时间</strong>；</li><li>不是衡量互动的最终影响，而是下一次<strong>绘制被阻塞</strong>的时间。</li></ul></li><li>CLS(Cumulative Layout Shift)，累计布局偏移，衡量视觉稳定性；加载过程中，CLS 应保持为 0.1 或更低：<ul><li>衡量网页<strong>整个生命周期内</strong>发生的所有<strong>意外布局偏移</strong>的累计得分。</li></ul></li></ul><p>开发者可以通过 <a class="link" href="https://developer.chrome.com/docs/lighthouse/overview?hl=zh-cn" target="_blank" rel="noopener">Lighthouse
</a>/<a class="link" href="https://www.webpagetest.org" target="_blank" rel="noopener">
WebPageTest
</a>对这些指标进行评估。</p><h3 id="lcp">LCP</h3><p>LCP 主要受到这四个部分的影响：</p><ul><li>加载第一个字节所需时间（TTFB），从发起网页加载到浏览器收到 HTML 文档响应的<strong>第一个字节</strong>的时间：<ul><li>加载的过程中，避免发生重定向；</li><li>将网站托管到服务提供商上；</li><li>合理使用强/协商缓存；</li><li>采用流式渲染。</li></ul></li><li>资源加载延迟，从 TTFB 到浏览器开始加载 LCP 资源所用的时间，渲染 LCP 可能不需要加载资源；</li><li>资源加载时长，加载 LCP 资源本身所用的时长，渲染 LCP 可能不需要加载资源：<ul><li>对重要资源，最好使用预加载 preload 策略；</li><li>对不重要的资源，采用延迟加载策略。</li></ul></li><li>元素渲染延迟，从 LCP 资源完成加载到完全渲染之间的时间：<ul><li>将重要样式内联到 HTML 中，减少额外的资源请求；</li><li>对 JS 进行异步加载处理，防止阻塞渲染流程；</li><li>使用预渲染/服务端渲染，尽快获得页面内容。</li></ul></li></ul><h3 id="inp">INP</h3><p>INP 不像 LCP，它存在于网页的整个生命周期；所以，需要 RUM 的参与来收集整个生命周期内的交互延迟数据：</p><ul><li>不要长时间占用主线程，确保主线程能有对交互敏感的事件的响应能力；</li><li>对于复杂动画，请将动画容器提升到新的层叠上下文；</li><li>SPA 在初始化渲染时，是同步的，会使交互延迟增加；</li><li>使用防抖/节流优化频繁触发的事件回调；</li><li>将复杂的计算任务交给 WebWorker。</li></ul><h3 id="cls">CLS</h3><p>造成 CLS 不佳的原因只有两个：</p><ul><li>内容不确定：<ul><li>延迟加载可以提升 LCP，但是也会使渲染内容不能在一开始就确定下来；</li><li>如果内容依赖异步请求，骨架屏会是一个很好的占位符。</li></ul></li><li>尺寸不确定：<ul><li>对于可替换内容元素，尽可能的给出具体的宽和高，而非依赖文档流；</li><li>也可以借助 aspect-ratio 属性，规定元素宽高比；</li><li>使用 CSS 动画，减少内容偏移造成的不适感。</li></ul></li></ul><p>良好的 bfcache 设计也能使页面在导航期间获得良好的 CLS 数据。</p><h2 id="如何操作">如何操作</h2><ul><li>升级 HTTP/2|3，利用二进制分帧、头部压缩等优势；</li><li>预渲染和服务器渲染的结合使用，提升首屏体验；</li><li>减少重定向，跳转会降低网页加载速度：<ul><li>同源重定向，可控，重定向发生在自己的域名下；</li><li>跨域重定向，不可控，重定向受到第三方影响。</li></ul></li><li>优化资源加载：<ul><li>通过 CDN 分发静态资源，使得资源离用户端更近；</li><li>合理使用强缓存和协商缓存，缓存静态资源；</li><li>启用服务器压缩 Brotli|gzip，提升传输性能；</li><li>CSS 会阻止内容渲染，否则会导致无样式内容展示给用户；</li><li>JS 会阻止 HTML 解析，建议合理使用 async|defer；</li><li>借助 PurgeCSS|TreeShaking，减少无用代码；</li><li>合理的代码分包，每次仅加载需要的代码；</li><li>将重要的 CSS 写入 HTML 内部；</li><li>借助 srcset 优化图片资源加载。</li></ul></li><li>合理使用 dns-prefetch|prefetch|preconnect|preload：<ul><li>dns-prefetch，预解析，提前对另外的一个域名进行 DNS 解析，使得后续可以更快地建立连接；</li><li>prefetch，预取，用来预加载不属于当前页面的资源；可以提升<strong>导航</strong>性能，但注意不要 prefetch 跨域资源；</li><li>preconnect，预链接，提前与另外一个域名建立连接；如果网站上有大量跨域资源，可以使用 preconnect 进行预连；</li><li>preload，预加载，提前对一些静态资源进行加载；而不是等到浏览器解析到外链时再加载，需要配合 crossorigin 属性。</li></ul></li></ul><h2 id="bfcache">bfcache</h2><p>当用户使用浏览器的前进后退按钮时，bfcache 可以延缓页面销毁，带来更及时的导航体验：</p><ul><li>bfcache 对 SPA 没有意义；因为 JS 监听了浏览器导航功能，导航前后都在同一个页面；</li><li>未启用 bfcache，返回上一个页面时，会重新加载并执行网页代码；</li><li>启用 bfcache，上一个页面将从内存中恢复。</li></ul><p>当页面被放入 bfcache 时，页面中的计时器、Promise、任务队列中的任务都会暂停执行，直到页面被恢复。</p><p>bfcache 对应了两个事件 pageshow 和 pagehide：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// pageshow 会在 load 之后触发
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'pageshow'</span><span class="p">,</span> <span class="nx">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">persisted</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 为了防止隐私信息从 bfcache 中恢复，这里可以更新网页信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'页面从 bfcache 中恢复'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span> <span class="c1">// 也可以直接刷新页面
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'页面正常加载'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'pagehide'</span><span class="p">,</span> <span class="nx">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">persisted</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 这里处理一些副作用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'页面进入 bfcache'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'页面正常卸载'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>如果要使用 bfcache，需要注意一下几点：</p><ul><li>切勿使用 unload 事件，因为 unload 表示网页被即将被销毁，而 bfcache 会尽量延迟网页销毁；浏览器为了保证 unload 的正常触发，bfcache 只好被舍弃；</li><li>bfcache 并不是 HTTP 缓存，Cache-Control:no-store 不会影响 bfcache；</li><li>不要创建 window.opener 引用，会导致 bfcache 失效；</li><li>beforeunload 事件不会影响 bfcache，但不要滥用。</li></ul><h2 id="webpack">Webpack</h2><p>Webpack 对前端性能的影响，更多体现在构建产物上：</p><ul><li>打包时，将 mode 置为 production，Webpack 内部会对打包产物做优化；</li><li>使用 MiniCssExtractPlugin 将 CSS 打包为单独的文件，提升 SEO；</li><li>将 node_modules 中的依赖放入 externals，并通过 CDN 引入；</li><li>启用 moduleIds:‘deterministic’，使 contenthash 不至于失效；</li><li>开启 optimization.sideEffects，启用 TreeShaking；</li><li>配置适合的 SplitChunks 策略，进行合理的分包；</li><li>使用 CompressionPlugin，将构建产物压缩；</li><li>加载 loader 时，尽量缩小匹配范围，使 loader 执行更高效；</li><li>启用 cache，在开发环境下会有更快的 HMR 和构建速度；</li><li>启用 thread-loader/esbuild-loader，使用多线程构建；</li><li>配置 DllPlugin，进行预打包，提升构建速度。</li></ul><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * development  会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 development
</span></span></span><span class="line"><span class="cl"><span class="cm">   * production   会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 production
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span>: <span class="kt">env.production</span> <span class="o">?</span> <span class="s1">'production'</span> <span class="o">:</span> <span class="s1">'development'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 启用持久化缓存（编译产物），提升构建速度
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 生产模式下会被禁用
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cache</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">type</span><span class="o">:</span> <span class="s1">'filesystem'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">allowCollectingMemory</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cacheDirectory</span>: <span class="kt">path.resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'node_modules/.cache'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">maxAge</span>: <span class="kt">5184000000</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devServer</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">hot</span>: <span class="kt">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span>: <span class="kt">env.production</span> <span class="o">?</span> <span class="s1">'source-map'</span> <span class="o">:</span> <span class="s1">'eval'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 尽量精确的匹配要加载的文件，提升加载性能
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">exclude</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">include</span><span class="o">:</span> <span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'src/styles'</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">loader</span>: <span class="kt">env.production</span>
</span></span><span class="line"><span class="cl">              <span class="o">?</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span>
</span></span><span class="line"><span class="cl">              <span class="o">:</span> <span class="s1">'style-loader'</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">loader</span><span class="o">:</span> <span class="s1">'css-loader'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">modules</span>: <span class="kt">true</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(png|svg|jpg|jpeg|gif)$/i</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * v5 之前，需要借助 loader 完成资源文件的加载
</span></span></span><span class="line"><span class="cl"><span class="cm">         * file-loader   将文件发送到输出目录，asset/resource
</span></span></span><span class="line"><span class="cl"><span class="cm">         * raw-loader    将文件导入为字符，asset/source
</span></span></span><span class="line"><span class="cl"><span class="cm">         * url-loader    将文件作为 dataURI 内联到 bundle 中，asset/inline
</span></span></span><span class="line"><span class="cl"><span class="cm">         * -------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">         * asset 将自动选择 dataURI 还是发送到输出目录
</span></span></span><span class="line"><span class="cl"><span class="cm">         * 就像之前使用 url-loader 并配置大小限制
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="kr">type</span><span class="o">:</span> <span class="s1">'asset/resource'</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.yaml$/i</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kr">type</span><span class="o">:</span> <span class="s1">'json'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">parser</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">parse</span>: <span class="kt">yaml.parse</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.[jt]sx?$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 使用 esbuild 处理文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">loader</span><span class="o">:</span> <span class="s1">'esbuild-loader'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">target</span><span class="o">:</span> <span class="s1">'es2015'</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.m?js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 一般不需要对第三方依赖进行处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/(node_modules|bower_components)/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 启用多线程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">loader</span><span class="o">:</span> <span class="s1">'thread-loader'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">options</span><span class="o">:</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">loader</span><span class="o">:</span> <span class="s1">'babel-loader'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1">// 启用文件缓存，node_modules/.cache/babel-loader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="nx">cacheDirectory</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">               * @babel/preset-env 提供语意转化，也提供 polyfill 能力
</span></span></span><span class="line"><span class="cl"><span class="cm">               * @babel/preset-env 提供的 polyfill 会污染全局变量
</span></span></span><span class="line"><span class="cl"><span class="cm">               * 只推荐在项目中使用，如果是开发一个库，不要使用
</span></span></span><span class="line"><span class="cl"><span class="cm">               */</span>
</span></span><span class="line"><span class="cl">              <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">'@babel/preset-env'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">                   * entry，需主动引入 polyfill，babel 根据 targets 对不兼容的 API 做 polyfill
</span></span></span><span class="line"><span class="cl"><span class="cm">                   * false，@babel/preset-env 不会引入 polyfill，需要在项目中主动引入
</span></span></span><span class="line"><span class="cl"><span class="cm">                   * usage，无需引入 polyfill，babel 根据 targets 按需引入 polyfill
</span></span></span><span class="line"><span class="cl"><span class="cm">                   */</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">useBuiltIns</span><span class="o">:</span> <span class="s1">'entry'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">corejs</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// corejs@3 支持模块化，可以按需引入，不污染全局环境
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="nx">proposals</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">version</span>: <span class="kt">3</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="p">],</span>
</span></span><span class="line"><span class="cl">              <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">               * @babel/plugin-transform-runtime 不会污染全局
</span></span></span><span class="line"><span class="cl"><span class="cm">               * 并且会复用 BabelHelper
</span></span></span><span class="line"><span class="cl"><span class="cm">               */</span>
</span></span><span class="line"><span class="cl">              <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s1">'@babel/plugin-transform-runtime'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">corejs</span>: <span class="kt">false</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">removeEmptyChunks</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 判断当前模块是否可以 TreeShaking
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 通过检测 package.json 的 sideEffects:false
</span></span></span><span class="line"><span class="cl"><span class="cm">     * sideEffects 和 usedExports 是两种 TreeShaking 方式
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sideEffects</span>: <span class="kt">true</span><span class="p">,</span> <span class="c1">// 允许跳过整个模块/文件和整个文件子树
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">usedExports</span>: <span class="kt">true</span><span class="p">,</span> <span class="c1">// 依赖于 terser 检测语句中的副作用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Webpack 打包时，存在一个 runtime，用于模块解析
</span></span></span><span class="line"><span class="cl"><span class="cm">     * single 可以为 runtime 创建一个额外的 chunk
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 防止影响构建产物的 contenthash
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">runtimeChunk</span><span class="o">:</span> <span class="s1">'single'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">minimizer</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 使用 esbuild 替代 Terser|UglifyJs 压缩文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">new</span> <span class="nx">EsbuildPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">target</span><span class="o">:</span> <span class="s1">'es2015'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">css</span>: <span class="kt">true</span> <span class="c1">// 还可以处理 CSS 文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nx">moduleIds</span><span class="o">:</span> <span class="s1">'deterministic'</span><span class="p">,</span> <span class="c1">// 防止 module.id 的变化影响构建产物的 contenthash
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 默认情况下，只影响 non-initial chunk
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 因为 initial chunk 会影响到 HTML 中 &lt;script&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 如果 chunk 被多处使用，会被拆分
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 如果 chunk 体积大于阈值，会被拆分
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 如果 chunk 来自 node_modules，会被拆分
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="s1">'all'</span><span class="p">,</span> <span class="c1">// 默认为 async；设置为 all 时，chunk 可以在 non-initial chunk 和 initial chunk 之间共享
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">cacheGroups</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * 像 lodash 或 react 这样的第三方库很少像本地源代码一样频繁修改
</span></span></span><span class="line"><span class="cl"><span class="cm">         * 通常将第三方库提取到单独的 vendor chunk 中
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="nx">vendor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">test</span><span class="o">:</span> <span class="sr">/[\\/]node_modules[\\/]/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">name</span><span class="o">:</span> <span class="s1">'vendors'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">chunks</span><span class="o">:</span> <span class="s1">'all'</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Webpack 中的 chunk 分为两种：
</span></span></span><span class="line"><span class="cl"><span class="cm">     * initial chunk      入口指定的模块及其依赖模块
</span></span></span><span class="line"><span class="cl"><span class="cm">     * non-initial chunk  异步加载的模块
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">asyncChunks</span>: <span class="kt">true</span><span class="p">,</span> <span class="c1">// 创建按需加载的异步 chunk
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">clean</span>: <span class="kt">true</span><span class="p">,</span> <span class="c1">// 在生成文件之前清空 output 目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">path</span>: <span class="kt">path.resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'dist'</span><span class="p">),</span> <span class="c1">// output 目录，绝对路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 使用 contenthash，即使文件内容没有修改，构建之后，名称还是发生了改变
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 这是因为 chunk 中还包含了一些引导模版（runtime、manifest）
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 而且每次构建过程中，module.id 会受到模块解析顺序的影响
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s1">'[name].[chunkhash].js'</span><span class="p">,</span> <span class="c1">// initial chunk 文件名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">chunkFilename</span><span class="o">:</span> <span class="s1">'[id].[contenthash].js'</span><span class="p">,</span> <span class="c1">// non-initial chunk 文件名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">assetModuleFilename</span><span class="o">:</span> <span class="s1">'images/[hash][ext][query]'</span> <span class="c1">// asset/resource 文件名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugins</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">title</span><span class="o">:</span> <span class="s1">'前端性能优化'</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 将 CSS 保存到单独的文件里
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span>: <span class="kt">env.production</span> <span class="o">?</span> <span class="s1">'[name].[contenthash].css'</span> <span class="o">:</span> <span class="s1">'[name].css'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunkFilename</span>: <span class="kt">env.production</span> <span class="o">?</span> <span class="s1">'[id].[contenthash].css'</span> <span class="o">:</span> <span class="s1">'[id].css'</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 对构建产物进行压缩
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">new</span> <span class="nx">CompressionPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">algorithm</span><span class="o">:</span> <span class="s1">'gzip'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js(\?.*)?$/i</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 打包完成之后，将额外的文件拷贝到指定的目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">new</span> <span class="nx">CopyPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="kr">from</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'robot.txt'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">to</span>: <span class="kt">path.resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'dist'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">IgnorePlugin</span><span class="p">(</span><span class="sr">/^\.\/locale$/</span><span class="p">,</span> <span class="sr">/moment$/</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * v4 版本之后，不再需要显式的配置了
</span></span></span><span class="line"><span class="cl"><span class="cm">     * mode 会自动配置 DefinePlugin
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 会在编译时，完成变量替换
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DefinePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'process.env.NODE_ENV'</span><span class="o">:</span> <span class="s1">'"production"'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">BROWSER_SUPPORTS_HTML5</span>: <span class="kt">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Webpack 预打包
</span></span></span><span class="line"><span class="cl"><span class="cm">     * DllPlugin 会生成一个 manifest.json
</span></span></span><span class="line"><span class="cl"><span class="cm">     * DllReferencePlugin 会读取 manifest.json，查找依赖的映射
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DllPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">context</span>: <span class="kt">__dirname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">format</span>: <span class="kt">false</span><span class="p">,</span> <span class="c1">// 是否格式化输出 manifest.json
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">name</span><span class="o">:</span> <span class="s1">'[name]_[fullhash]'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">path</span>: <span class="kt">path.join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'manifest.json'</span><span class="p">)</span> <span class="c1">// manifest.json 输出路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DllReferencePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">context</span>: <span class="kt">__dirname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">manifest</span>: <span class="kt">require</span><span class="p">(</span><span class="s1">'./manifest.json'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">HotModuleReplacementPlugin</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">alias</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'@'</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'src'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s1">'.js'</span><span class="p">,</span> <span class="s1">'.json'</span><span class="p">],</span> <span class="c1">// 配置适当的后缀名，避免解析时间过长
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'src'</span><span class="p">),</span> <span class="s1">'node_modules'</span><span class="p">]</span> <span class="c1">// 只解析 src 和 node_modules 下的模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 从输出的 bundle 中排除依赖，只有 UMD 格式的包支持
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 直接在 HTML 的 script 标签中，从外部引入相关依赖
</span></span></span><span class="line"><span class="cl"><span class="cm">   * ---------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 或者在开发一个库的情况下，将依赖排除
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 将依赖声明到对等依赖里
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">externals</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">react</span><span class="o">:</span> <span class="s1">'react'</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">target</span><span class="o">:</span> <span class="s1">'web'</span> <span class="c1">// 构建目标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="参考">参考</h2><ul><li><a class="link" href="https://github.com/MrErHu/blog/issues/46" target="_blank" rel="noopener">Babel Polyfill 常见问题总结</a></li><li><a class="link" href="https://web.dev/articles/vitals?hl=zh-cn" target="_blank" rel="noopener">Web Vitals</a></li><li><a class="link" href="https://web.dev/articles/bfcache?hl=zh-cn" target="_blank" rel="noopener">往返缓存</a></li></ul></section><footer class="article-footer"><section class="article-not-by-ai-badge"><a href="https://notbyai.fyi/cn/" target="_blank" title="Not By AI"><svg width="131" height="42" viewBox="0 0 131 42" fill="none"><path d="M.5.5H116c8.008.0 14.5 6.49187 14.5 14.5V41.5H15C6.99187 41.5.5 35.0081.5 27V.5z" fill="#fff" stroke="#000"></path><path d="M17.9605 24.1575c3.4661 2.8068 8.4231 2.8068 11.8892.0l-1.3402-1.6549c-2.6847 2.174-6.5241 2.174-9.2088.0l-1.3402 1.6549z" fill="#000"></path><path d="M19.404 20.5134V17.6365h2.1296v2.8769H19.404z" fill="#000"></path><path d="M26.012 17.6365v2.8769h2.1295V17.6365H26.012z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M35 21.5C35 27.8513 29.8513 33 23.5 33S12 27.8513 12 21.5C12 15.1487 17.1487 10 23.5 10S35 15.1487 35 21.5zm-2.1295.0c0 5.1752-4.1953 9.3705-9.3705 9.3705S14.1295 26.6752 14.1295 21.5s4.1953-9.3705 9.3705-9.3705 9.3705 4.1953 9.3705 9.3705z" fill="#000"></path><path d="M61.844 12.1721l.1995.711L62.2294 12.8197C62.5169 12.7216 62.8276 12.6155 63.1503 12.5052v2.55C63.1503 15.1818 63.1005 15.2208 62.9709 15.2208 62.8612 15.2208 62.4922 15.2208 62.0634 15.211 62.1631 15.4156 62.2628 15.7273 62.2928 15.9123 62.901 15.9123 63.28 15.8929 63.5293 15.776 63.7686 15.6591 63.8583 15.4545 63.8583 15.0455V12.2629C64.2106 12.1421 64.5673 12.0195 64.9154 11.8994L64.8057 11.2273C64.4898 11.3348 64.1706 11.4415 63.8583 11.5441V9.63961H64.8057V8.95779H63.8583V7H63.1503V8.95779H61.9936v.68182h1.1567V11.7732C62.6577 11.9301 62.2064 12.0683 61.844 12.1721z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M66.0322 10.7695C65.3142 10.7695 65.1347 10.5162 65.1347 9.8052V7.39935h2.6127V9.32792H65.763V9.81494C65.763 10.1169 65.8128 10.2045 66.0322 10.2045H67.2986C67.4781 10.2045 67.7474 10.1948 67.9069 10.1656 67.9134 10.2165 67.92 10.2777 67.9268 10.3422 67.941 10.4754 67.9566 10.6224 67.9767 10.7208 67.8371 10.7597 67.5779 10.7695 67.3086 10.7695H66.0322zM65.763 7.90584H67.1391V8.82143H65.763V7.90584z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M69.0736 10.7208C68.3656 10.7208 68.1861 10.4773 68.1861 9.76623V7.39935H70.8087V9.2987H68.8144V9.77597C68.8144 10.0682 68.8642 10.1656 69.0936 10.1656h1.3262C70.5993 10.1656 70.8985 10.1461 71.058 10.1071 71.068 10.2825 71.0979 10.5357 71.1179 10.6721 70.9783 10.7208 70.709 10.7208 70.4298 10.7208H69.0736zM68.8144 7.90584h1.396v.88637h-1.396V7.90584z" fill="#000"></path><path d="M66.83 14.1299C66.2715 14.6753 65.3142 15.1818 64.4567 15.5032 64.6262 15.6201 64.9054 15.8539 65.035 15.9805 65.8727 15.6104 66.8898 14.9968 67.5081 14.3831L66.83 14.1299z" fill="#000"></path><path d="M68.4554 14.4513C69.2132 14.9091 70.1905 15.5812 70.6791 16L71.2974 15.6104C70.7788 15.1818 69.7916 14.539 69.0437 14.1007L68.4554 14.4513z" fill="#000"></path><path d="M50.4761 15.9318C49.798 15.5617 48.6612 15.0942 47.5344 14.7338L48.0031 14.2468C49.1299 14.5974 50.3564 15.0552 51.0844 15.4253L50.4761 15.9318z" fill="#000"></path><path d="M42 15.4156C43.067 15.1623 44.4032 14.6656 45.0713 14.2468L45.7594 14.6753C44.9218 15.1721 43.5855 15.6786 42.5185 15.9513 42.4088 15.8052 42.1596 15.5519 42 15.4156z" fill="#000"></path><path d="M56.1556 7.21693C56.1571 7.15007 56.1585 7.0868 56.1601 7.02922H56.9877L56.9868 7.0714C56.9788 7.4194 56.968 7.88942 56.9233 8.43665 57.0639 9.58208 57.6711 13.7136 61.2258 15.2597 61.0064 15.4253 60.787 15.6786 60.6773 15.8831c-2.5071-1.144-3.5872-3.5484-4.0775-5.3684C56.13 12.4644 55.0681 14.6445 52.63 15.9221 52.5004 15.7273 52.2511 15.5032 52.0217 15.3474c3.9976-1.9757 4.0968-6.45452 4.1339-8.13047z" fill="#000"></path><path d="M75.0586 9.43506C75.1376 9.06022 75.2116 8.69288 75.2761 8.3539L74.5283 8.27597C74.3089 9.50325 73.9299 11.1688 73.6408 12.1623L74.3986 12.2305C74.4264 12.1301 74.4552 12.0226 74.4848 11.9091H78.3699C78.3296 12.3408 78.2883 12.7224 78.2455 13.0584H72.0851V13.7403h6.0611C78.0034 14.5883 77.8408 15.0239 77.6395 15.1916 77.5198 15.289 77.4002 15.2987 77.1708 15.2987 76.9215 15.2987 76.2334 15.2987 75.5454 15.2305 75.675 15.4253 75.7747 15.7175 75.7947 15.9221 76.4429 15.961 77.091 15.9708 77.4201 15.9513 77.799 15.9318 78.0284 15.8636 78.2677 15.6396 78.532 15.3814 78.7263 14.8409 78.8969 13.7403H81V13.0584H78.991C79.0434 12.6344 79.0943 12.1472 79.1452 11.5877 79.1552 11.4805 79.1751 11.2565 79.1751 11.2565H74.6483C74.7379 10.8862 74.8303 10.4846 74.92 10.0779H79.2948V9.43506H75.0586z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M65.1746 11.6266V12.25H66.5109v1.1299H64.7558v.6233H71.1079v-.6233H69.5523V12.25h1.3262v-.6234H69.5523v-.6623H68.8642v.6623H67.189V10.9838H66.5109V11.6266H65.1746zm2.0144 1.7533V12.25h1.6752v1.1299H67.189z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M42.1895 14.0909v-.6234h1.4359V9.06494h2.5129V8.4513H42.4687V7.81818h3.6696V7.00974H46.8762v.80844H50.7852V8.4513H46.8762v.61364h2.7623V13.4675h1.406v.6234h-8.855zm2.1539-.6234h4.5472V12.7857H44.3434V13.4675zm0-1.1493h4.5472V11.7338H44.3434V12.3182zm0-1.0617h4.5472v-.5747H44.3434v.5747zm0-1.0325h4.5472V9.58117H44.3434V10.224z" fill="#000"></path><path d="M72.3245 9.65909V7.52597h8.4362V9.65909H79.9829V8.20779H73.0624v1.4513H72.3245z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M105.32 26.2505C105.32 25.9898 105.336 25.4196 105.336 25.4196H101.424V23.8717H105.573C105.764 26.2238 106.11 28.471 106.651 30.2984c-.875.9892-1.892 1.8173-3.039 2.4531C104.107 33.2077 104.953 34.2016 105.288 34.7067 106.138 34.1597 106.93 33.5082 107.658 32.7639 108.338 33.9391 109.193 34.6415 110.254 34.6415 111.898 34.6415 112.649 33.9572 113 30.78 112.377 30.5356 111.563 29.9817 111.036 29.4277 110.956 31.4155 110.765 32.2301 110.445 32.2301 110.06 32.2301 109.67 31.686 109.312 30.7655 110.465 29.1244 111.389 27.1985 112.058 25.0611L109.711 24.4908C109.396 25.6095 108.983 26.659 108.478 27.6243 108.264 26.4884 108.09 25.2105 107.974 23.8717h4.866V21.5418H111.142L111.946 20.6945C111.387 20.1568 110.27 19.4399 109.455 19l-1.405 1.4175C108.553 20.7329 109.148 21.1437 109.647 21.5418H107.835C107.811 20.7923 107.808 20.0385 107.827 19.2933h-2.443C105.387 20.0364 105.403 20.7892 105.433 21.5418H98.9812v4.8879C98.9812 28.5642 98.9014 31.4481 97.7199 33.3707 98.2468 33.6477 99.3006 34.5275 99.6997 35 100.514 33.7498 100.957 32.0088 101.189 30.2753 101.506 30.8638 101.745 31.7506 101.775 32.4257 102.51 32.4257 103.18 32.4094 103.612 32.3279 104.091 32.2301 104.458 32.0672 104.809 31.5947 105.192 31.0733 105.272 29.5743 105.32 26.2505zM101.197 30.2141C101.316 29.3052 101.378 28.4 101.406 27.5703h1.652C103.023 29.1922 102.963 29.8644 102.829 30.0631 102.701 30.2261 102.558 30.2749 102.35 30.2749 102.102 30.2749 101.674 30.2596 101.197 30.2141z" fill="#000"></path><path d="M86.8673 22.112C87.1314 21.4187 87.3672 20.705 87.565 19.9939L85.1541 19.4399C84.6112 21.6395 83.5893 23.8717 82.3599 25.2077 82.9507 25.5336 83.9885 26.2342 84.4515 26.6415 84.9297 26.0332 85.4007 25.2744 85.839 24.4257h3.0672v2.4928H84.7709v2.2811h4.1353V32.002H82.8708v2.3137H97.4005V32.002H91.3332V29.1996H95.9156V26.9185H91.3332V24.4257H96.5543V22.112H91.3332V19.277H88.9062v2.835H86.8673z" fill="#000"></path><path d="M47.3436 28.4645C47.4377 28.0285 47.4856 27.6141 47.4988 27.2444H43.8462V25.11h3.6564V23.4807h-3.816V21.2811h3.816V19.3585h2.2992V27c0 2.8513-.862200000000001 6.0611-4.774 7.9837C44.6446 34.4134 43.9261 33.6802 43.3672 33.224 44.7784 32.6761 45.7414 31.786 46.3804 30.8057 45.6568 30.9237 44.9507 31.0375 44.2921 31.1436L43.4151 31.2851 43 28.9226C44.1273 28.8236 45.7056 28.6496 47.3436 28.4645z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M72.6755 34.3305 67.632 19.7976H64.2697L59.1875 34.3305h3.1111L63.2841 31.3431H68.5306l.9178 2.9874H72.6755zM65.9218 23.1202l1.7778 5.7186H64.0861l1.8357-5.7186z" fill="#000"></path><path d="M53.7456 19.3585v1.9226h4.1833v2.1996H53.7456V25.11H57.5457v2.1344H53.7456v1.6619H58.2163v2.1996H53.7456v3.6497H51.4144V19.3585h2.3312z" fill="#000"></path><path d="M75.2125 22.2696v9.5922H73.4582v2.4721H79.719V31.8618h-1.55V22.2696h1.55v-2.472H73.4582v2.472h1.7543z" fill="#000"></path></svg></a></section></footer></article><aside class="related-content--wrapper"><h2 class="section-title">相关文章</h2><div class="related-content"><div class="flex article-list--tile"><article class="has-image"><a href="/p/%E9%9D%A2%E5%90%91%E9%9D%A2%E8%AF%95%E7%BC%96%E7%A8%8B/"><div class="article-image"><img src="/img/cover/javascript.webp" loading="lazy" data-key="" data-hash="/img/cover/javascript.png" alt="" decoding="async" width="1998" height="1200" srcset="/img/cover/javascript.webp 1998w, /img/cover/javascript@798w.webp 798w" sizes="100vw"></div><div class="article-details"><h2 class="article-title">面向面试编程</h2></div></a></article><article class="has-image"><a href="/p/%E5%86%8D%E8%AF%BB%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84-javascript/"><div class="article-image"><img src="/img/cover/javascript.webp" loading="lazy" data-key="" data-hash="/img/cover/javascript.png" alt="" decoding="async" width="1998" height="1200" srcset="/img/cover/javascript.webp 1998w, /img/cover/javascript@798w.webp 798w" sizes="100vw"></div><div class="article-details"><h2 class="article-title">再读《你不知道的 JavaScript》</h2></div></a></article><article class="has-image"><a href="/p/%E8%BD%AC%E8%B0%88%E8%B0%88%E9%80%92%E5%BD%92/"><div class="article-image"><img src="/img/cover/javascript.webp" loading="lazy" data-key="" data-hash="/img/cover/javascript.png" alt="" decoding="async" width="1998" height="1200" srcset="/img/cover/javascript.webp 1998w, /img/cover/javascript@798w.webp 798w" sizes="100vw"></div><div class="article-details"><h2 class="article-title">「转」谈谈递归</h2></div></a></article><article class="has-image"><a href="/p/attribute-%E4%B8%8E-property/"><div class="article-image"><img src="/img/cover/javascript.webp" loading="lazy" data-key="" data-hash="/img/cover/javascript.png" alt="" decoding="async" width="1998" height="1200" srcset="/img/cover/javascript.webp 1998w, /img/cover/javascript@798w.webp 798w" sizes="100vw"></div><div class="article-details"><h2 class="article-title">attribute 与 property</h2></div></a></article><article class="has-image"><a href="/p/%E8%BD%ACvirtualdom-%E7%9C%9F%E7%9A%84%E6%AF%94%E6%93%8D%E4%BD%9C%E5%8E%9F%E7%94%9F-dom-%E5%BF%AB%E5%90%97/"><div class="article-image"><img src="/img/cover/javascript.webp" loading="lazy" data-key="" data-hash="/img/cover/javascript.png" alt="" decoding="async" width="1998" height="1200" srcset="/img/cover/javascript.webp 1998w, /img/cover/javascript@798w.webp 798w" sizes="100vw"></div><div class="article-details"><h2 class="article-title">「转」VirtualDOM 真的比操作原生 DOM 快吗？</h2></div></a></article></div></div></aside><footer class="site-footer"><section class="copyright" style="display:flex;justify-content:flex-start;align-items:center">©
2017 -
2025
<a href="https://github.com/ElementRef" target="_blank">馬腊咯稽
</a><a href="https://ipw.cn/ipv6webcheck/?site=elementref.github.io" target="_blank" title="本站支持 IPv6 访问"><img style="display:inline-block;vertical-align:middle" src="https://static.ipw.cn/icon/ipv6-certified-lite-s1.svg" alt="本站支持 IPv6 访问" loading="lazy" decoding="async"></a></section><section class="powerby">Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>, Deploy by Actions<br>主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.13.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计</section></footer><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title="Share"></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js" integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin="anonymous" defer=""></script><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin="anonymous" defer=""></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css" crossorigin="anonymous"></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class="widget-icon"><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><line x1="5" y1="9" x2="19" y2="9"></line><line x1="5" y1="15" x2="19" y2="15"></line><line x1="11" y1="4" x2="7" y2="20"></line><line x1="17" y1="4" x2="13" y2="20"></line></svg></div><h2 class="widget-title section-title">目录</h2><div class="widget--toc"><nav id="TableOfContents"><ol><li><a href="#核心指标">核心指标</a><ol><li><a href="#lcp">LCP</a></li><li><a href="#inp">INP</a></li><li><a href="#cls">CLS</a></li></ol></li><li><a href="#如何操作">如何操作</a></li><li><a href="#bfcache">bfcache</a></li><li><a href="#webpack">Webpack</a></li><li><a href="#参考">参考</a></li></ol></nav></div></section></aside></div><script src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js" integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin="anonymous"></script><script type="text/javascript" src="/ts/main.js" defer=""></script><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><script>NProgress.configure({showSpinner:!1}),NProgress.start(),document.addEventListener("readystatechange",()=>{document.readyState==="interactive"&&NProgress.inc(.8),document.readyState==="complete"&&NProgress.done()})</script></body></html>