<!DOCTYPE html><html lang="zh-cn" dir="ltr"><head><meta charset="utf-8"><style>:where(img[jampack-sized]){max-width:100%;height:auto}</style><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="RxJS 是 ReactiveX 在 JS 中的实现，相似的还有 RxJava、RxSwift…；ReactiveX 是 FRP（函数响应式编程）的践行者。
操作符 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 // 创建器，用来创建“流（数据序列）”，返回值是一个 Observable 对象 import { def, from, fromEvent, interval, of, range, timer } from 'rxjs'; import { fromPromise } from 'rxjs/internal/observable/fromPromise'; // 操作符，用来处理“流” import { buffer, bufferCount, bufferTime, catchError, combineLatest, concat, distinct, distinctUntilChanged, filter, finalize, first, forkJoin, last, map, merge, race, zip } from 'rxjs/operators'; new Observable<any>((observer: Observer<any>) => { setTimeout(() => { // 任何时间，都可以通过 next 将值传入“流”中 observer.next(1000); }, 1000); }); /** * of 可以将“单一值”创建为“流” * “单一值”可以为任何数据类型 */ of(1, 2, 3, 4, 5) .pipe( filter(item => item % 2 === 1), map(item => item * 3) ) /** * 冷 Observable 必须被 subscribe 之后才会“产生”数据 * 如果没有 subscribe，之前的 pipe 就不会执行 * 所以，对同一接口多次 subscribe 会导致发起多次请求 * subscribe 表示“可观察对象”与“观察者”之间“建立了联系” */ .subscribe(item => console.log(item)); // 3 9 15 // from 可以将数组的每一项放入“流”中 from([1, 2, 3, 4, 5]) .pipe( filter(item => item % 2 === 1), map(item => item * 3) ) .subscribe(item => console.log(item)); // 3 9 15 /** * fromEvent 可以替代 addEventListener，它是「温」的： * 1. 当第一个订阅者出现时，它才会调用 addEventListener 去监听事件 * 2. 当最后一个订阅者取消订阅时，它会调用 removeEventListener 移除监听 * 3. 尽管有「热」的特性（多订阅者共享），但它依然需要至少一个订阅者来启动 */ const fromEvent$ = fromEvent(document.querySelector('#title'), 'click'); fromEvent$.subscribe(v => console.log(v)); // PointerEvent // range 可以从“范围”产生“流” range(1, 5) .pipe( filter(item => item % 2 === 1), map(item => item * 3) ) .subscribe(item => console.log(item)); // 3 9 15 const p = new Promise((resolve, reject) => { console.log('Promise Begin...'); setTimeout(() => resolve('Promise Resolved...'), 1000); }); /** * fromPromise 接受一个 Promise 实例 * 当这个 Promise 状态确定之后，将输出值放入“流”中 * 即使没有 subscribe，这个 Promise 也会执行 * 从 6.0 开始，可以使用 from 替代 fromPromise * from/fromPromise 的这个特性可能让你觉得它是「热」的 * 但是 Promise 立即执行，是 Promise 的特性，而非 from 触发的 */ fromPromise(p).subscribe(item => console.log(item)); /** * defer 用来“惰性地”创建“流” * 他接受一个“产生流”的“工厂函数” * 当调用 defer 时，“流”还不存在，“流”会被“按需”创建 * 当“流”被“需要”的时候，才会调用“工厂函数”，产生“流” * 只要没有 subscribe，“工厂函数”就不会执行，Promise 也就不会执行 */ defer(() => from(p)).subscribe(item => console.log(item)); /** * timer(首次等待时间，重复间隔时间) 用来创建“定时器流” * 他创建的是一种“无尽流”（务必要在适当的时候取消订阅） * 数据会不断重复的被放入“流”中 * 有点像 setInterval */ timer(3000, 1000).subscribe(item => console.log(item)); // 等待 3 秒：0 1 2 3... // interval（重复间隔时间），是 timer 的语法糖 interval(1000).subscribe(item => console.log(item)); // 0 1 2 3... // first 操作符 from([0, 1, 2, 3]) .pipe(first(v => v !== 0)) .subscribe({ next(v) { console.log(v); // 1 }, complete() { console.log('complete'); } }); // last 操作符 from([0, 1, 2, 3]) .pipe(last(v => v !== 0)) .subscribe({ next(v) { console.log(v); // 3 }, complete() { console.log('complete'); } }); // distinct 操作符（过滤之前出现过的数据，去重作用） from([1, 2, 2, 3, 3, 3]) .pipe(distinct()) .subscribe({ next(v) { console.log(v); // 1, 2, 3 }, complete() { console.log('complete'); } }); // distinctUntilChanged 操作符（过滤“上次”出现过的数据） from([2, 1, 2, 1, 3, 3, 3]) .pipe(distinctUntilChanged()) .subscribe({ next(v) { console.log(v); // 2, 1, 2, 1, 3 }, complete() { console.log('complete'); } }); // combineLatest 操作符 const cl1 = new Subject(); const cl2 = new Subject(); // 一秒钟后，cl2 接收到值之后，打印 ['cl1', 'cl2'] combineLatest([cl1, cl2]).subscribe(v => console.log(v)); cl1.next('cl1'); setTimeout(() => { cl2.next('cl2'); }, 1000); // merge 操作符 const m1 = new Subject(); const m2 = new Subject(); const m3 = new Subject(); merge(m1, m2, m3).subscribe(v => console.log(v)); // m3, m1 一秒钟后 m2 m3.next('m3'); setTimeout(() => { m2.next('m2'); }, 1000); m1.next('m1'); // zip 操作符，强调值的数量相同 const z1 = new Subject(); const z2 = new Subject(); zip(z1, z2).subscribe(v => console.log(v)); z1.next(1); // 不打印 z1.next(2); // 不打印 z2.next(3); // [1, 3]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第一个值 z2.next(4); // [2, 4]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第二个值 // concat 操作符 const c1 = new Subject(); const c2 = new Subject(); concat(c1, c2).subscribe(v => console.log(v)); c1.next(1); // 1 c2.next(2); // 不打印 c1.complete(); c2.next(3); // 3，c1 被 complete 之前，c2 的值被忽略 // forkJoin 操作符 const fj1 = new Subject(); const fj2 = new Subject(); forkJoin(fj1, fj2).subscribe(v => console.log(v)); fj1.next(1); // 不打印 fj2.next(2); // 不打印 fj1.complete(); // 不打印 fj2.complete(); // [1, 2] // race 操作符 const r1 = new Subject(); const r2 = new Subject(); race(r1, r2).subscribe(v => console.log(v)); r2.next(1); // 1 r1.next(2); // 不打印，r1 没有竞争过 r2 r2.next(3); // 3 r1.next(4); // 不打印 // catchError 操作符 new Observable(sub => { sub.next('normal'); // 会走到 subscribe sub.error('error'); }) .pipe( catchError(error => { console.log(error); // 只会打印 error return of('catched'); // 会走到 subscribe }) ) .subscribe(v => { console.log(v); // 先打印 normal 再打印 catched }); // buffer 操作符，收集输出值（缓冲区） interval(1000) .pipe(buffer(fromEvent(document, 'click'))) .subscribe(v => { /** * [0, 1, 2, 3] * [4, 5, 6, 7, 8, 9, 10] * ... */ console.log(v); }); // bufferCount 操作符，收集输出值 interval(1000) .pipe(bufferCount(3)) // 三个三个走 .subscribe(v => { /** * [0, 1, 2] * [3, 4, 5] * ... */ console.log(v); }); // bufferTime 操作符，收集输出值 interval(1000) .pipe(bufferTime(3000, 1000)) .subscribe(v => { /** * 等 3 秒 [0, 1] * 等 1 秒 [0, 1, 2, 3] * 等 1 秒 [2, 3, 4, 5] * ... */ console.log(v); }); // finalize 操作符 const f = new Subject(); f.pipe(finalize(() => console.log('finalize'))).subscribe(v => console.log(v)); f.next('next'); // next f.error('error'); // finalize f.complete(); // finalize Observable 不同于创建器（调用后返回 Observable 对象），Subject 是一个实现了 Observable 接口的“类”；需要先进行 new 调用，然后将数据“手动”放入“流”中（subject.next(value)）。
"><title>RxJS 快速上手 · I AM BEA, I DRINK TEA</title>
<link rel="canonical" href="https://ElementRef.github.io/p/rxjs-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"><link rel="stylesheet" href="/scss/style.min.63103ec82fcfbadf1f99d0955360216dccfad06c732bb7830ae72bbd6f5d2a4d.css"><meta property="og:title" content="RxJS 快速上手"><meta property="og:description" content="RxJS 是 ReactiveX 在 JS 中的实现，相似的还有 RxJava、RxSwift…；ReactiveX 是 FRP（函数响应式编程）的践行者。
操作符 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 // 创建器，用来创建“流（数据序列）”，返回值是一个 Observable 对象 import { def, from, fromEvent, interval, of, range, timer } from 'rxjs'; import { fromPromise } from 'rxjs/internal/observable/fromPromise'; // 操作符，用来处理“流” import { buffer, bufferCount, bufferTime, catchError, combineLatest, concat, distinct, distinctUntilChanged, filter, finalize, first, forkJoin, last, map, merge, race, zip } from 'rxjs/operators'; new Observable<any>((observer: Observer<any>) => { setTimeout(() => { // 任何时间，都可以通过 next 将值传入“流”中 observer.next(1000); }, 1000); }); /** * of 可以将“单一值”创建为“流” * “单一值”可以为任何数据类型 */ of(1, 2, 3, 4, 5) .pipe( filter(item => item % 2 === 1), map(item => item * 3) ) /** * 冷 Observable 必须被 subscribe 之后才会“产生”数据 * 如果没有 subscribe，之前的 pipe 就不会执行 * 所以，对同一接口多次 subscribe 会导致发起多次请求 * subscribe 表示“可观察对象”与“观察者”之间“建立了联系” */ .subscribe(item => console.log(item)); // 3 9 15 // from 可以将数组的每一项放入“流”中 from([1, 2, 3, 4, 5]) .pipe( filter(item => item % 2 === 1), map(item => item * 3) ) .subscribe(item => console.log(item)); // 3 9 15 /** * fromEvent 可以替代 addEventListener，它是「温」的： * 1. 当第一个订阅者出现时，它才会调用 addEventListener 去监听事件 * 2. 当最后一个订阅者取消订阅时，它会调用 removeEventListener 移除监听 * 3. 尽管有「热」的特性（多订阅者共享），但它依然需要至少一个订阅者来启动 */ const fromEvent$ = fromEvent(document.querySelector('#title'), 'click'); fromEvent$.subscribe(v => console.log(v)); // PointerEvent // range 可以从“范围”产生“流” range(1, 5) .pipe( filter(item => item % 2 === 1), map(item => item * 3) ) .subscribe(item => console.log(item)); // 3 9 15 const p = new Promise((resolve, reject) => { console.log('Promise Begin...'); setTimeout(() => resolve('Promise Resolved...'), 1000); }); /** * fromPromise 接受一个 Promise 实例 * 当这个 Promise 状态确定之后，将输出值放入“流”中 * 即使没有 subscribe，这个 Promise 也会执行 * 从 6.0 开始，可以使用 from 替代 fromPromise * from/fromPromise 的这个特性可能让你觉得它是「热」的 * 但是 Promise 立即执行，是 Promise 的特性，而非 from 触发的 */ fromPromise(p).subscribe(item => console.log(item)); /** * defer 用来“惰性地”创建“流” * 他接受一个“产生流”的“工厂函数” * 当调用 defer 时，“流”还不存在，“流”会被“按需”创建 * 当“流”被“需要”的时候，才会调用“工厂函数”，产生“流” * 只要没有 subscribe，“工厂函数”就不会执行，Promise 也就不会执行 */ defer(() => from(p)).subscribe(item => console.log(item)); /** * timer(首次等待时间，重复间隔时间) 用来创建“定时器流” * 他创建的是一种“无尽流”（务必要在适当的时候取消订阅） * 数据会不断重复的被放入“流”中 * 有点像 setInterval */ timer(3000, 1000).subscribe(item => console.log(item)); // 等待 3 秒：0 1 2 3... // interval（重复间隔时间），是 timer 的语法糖 interval(1000).subscribe(item => console.log(item)); // 0 1 2 3... // first 操作符 from([0, 1, 2, 3]) .pipe(first(v => v !== 0)) .subscribe({ next(v) { console.log(v); // 1 }, complete() { console.log('complete'); } }); // last 操作符 from([0, 1, 2, 3]) .pipe(last(v => v !== 0)) .subscribe({ next(v) { console.log(v); // 3 }, complete() { console.log('complete'); } }); // distinct 操作符（过滤之前出现过的数据，去重作用） from([1, 2, 2, 3, 3, 3]) .pipe(distinct()) .subscribe({ next(v) { console.log(v); // 1, 2, 3 }, complete() { console.log('complete'); } }); // distinctUntilChanged 操作符（过滤“上次”出现过的数据） from([2, 1, 2, 1, 3, 3, 3]) .pipe(distinctUntilChanged()) .subscribe({ next(v) { console.log(v); // 2, 1, 2, 1, 3 }, complete() { console.log('complete'); } }); // combineLatest 操作符 const cl1 = new Subject(); const cl2 = new Subject(); // 一秒钟后，cl2 接收到值之后，打印 ['cl1', 'cl2'] combineLatest([cl1, cl2]).subscribe(v => console.log(v)); cl1.next('cl1'); setTimeout(() => { cl2.next('cl2'); }, 1000); // merge 操作符 const m1 = new Subject(); const m2 = new Subject(); const m3 = new Subject(); merge(m1, m2, m3).subscribe(v => console.log(v)); // m3, m1 一秒钟后 m2 m3.next('m3'); setTimeout(() => { m2.next('m2'); }, 1000); m1.next('m1'); // zip 操作符，强调值的数量相同 const z1 = new Subject(); const z2 = new Subject(); zip(z1, z2).subscribe(v => console.log(v)); z1.next(1); // 不打印 z1.next(2); // 不打印 z2.next(3); // [1, 3]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第一个值 z2.next(4); // [2, 4]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第二个值 // concat 操作符 const c1 = new Subject(); const c2 = new Subject(); concat(c1, c2).subscribe(v => console.log(v)); c1.next(1); // 1 c2.next(2); // 不打印 c1.complete(); c2.next(3); // 3，c1 被 complete 之前，c2 的值被忽略 // forkJoin 操作符 const fj1 = new Subject(); const fj2 = new Subject(); forkJoin(fj1, fj2).subscribe(v => console.log(v)); fj1.next(1); // 不打印 fj2.next(2); // 不打印 fj1.complete(); // 不打印 fj2.complete(); // [1, 2] // race 操作符 const r1 = new Subject(); const r2 = new Subject(); race(r1, r2).subscribe(v => console.log(v)); r2.next(1); // 1 r1.next(2); // 不打印，r1 没有竞争过 r2 r2.next(3); // 3 r1.next(4); // 不打印 // catchError 操作符 new Observable(sub => { sub.next('normal'); // 会走到 subscribe sub.error('error'); }) .pipe( catchError(error => { console.log(error); // 只会打印 error return of('catched'); // 会走到 subscribe }) ) .subscribe(v => { console.log(v); // 先打印 normal 再打印 catched }); // buffer 操作符，收集输出值（缓冲区） interval(1000) .pipe(buffer(fromEvent(document, 'click'))) .subscribe(v => { /** * [0, 1, 2, 3] * [4, 5, 6, 7, 8, 9, 10] * ... */ console.log(v); }); // bufferCount 操作符，收集输出值 interval(1000) .pipe(bufferCount(3)) // 三个三个走 .subscribe(v => { /** * [0, 1, 2] * [3, 4, 5] * ... */ console.log(v); }); // bufferTime 操作符，收集输出值 interval(1000) .pipe(bufferTime(3000, 1000)) .subscribe(v => { /** * 等 3 秒 [0, 1] * 等 1 秒 [0, 1, 2, 3] * 等 1 秒 [2, 3, 4, 5] * ... */ console.log(v); }); // finalize 操作符 const f = new Subject(); f.pipe(finalize(() => console.log('finalize'))).subscribe(v => console.log(v)); f.next('next'); // next f.error('error'); // finalize f.complete(); // finalize Observable 不同于创建器（调用后返回 Observable 对象），Subject 是一个实现了 Observable 接口的“类”；需要先进行 new 调用，然后将数据“手动”放入“流”中（subject.next(value)）。
"><meta property="og:url" content="https://ElementRef.github.io/p/rxjs-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"><meta property="og:site_name" content="馬腊咯稽"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2022-03-18T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-18T00:00:00+00:00"><meta property="og:image" content="https://ElementRef.github.io/img/cover/rxjs.png"><meta property="og:logo" content="/og-logo.png"><meta name="twitter:title" content="RxJS 快速上手"><meta name="twitter:description" content="RxJS 是 ReactiveX 在 JS 中的实现，相似的还有 RxJava、RxSwift…；ReactiveX 是 FRP（函数响应式编程）的践行者。
操作符 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 // 创建器，用来创建“流（数据序列）”，返回值是一个 Observable 对象 import { def, from, fromEvent, interval, of, range, timer } from 'rxjs'; import { fromPromise } from 'rxjs/internal/observable/fromPromise'; // 操作符，用来处理“流” import { buffer, bufferCount, bufferTime, catchError, combineLatest, concat, distinct, distinctUntilChanged, filter, finalize, first, forkJoin, last, map, merge, race, zip } from 'rxjs/operators'; new Observable<any>((observer: Observer<any>) => { setTimeout(() => { // 任何时间，都可以通过 next 将值传入“流”中 observer.next(1000); }, 1000); }); /** * of 可以将“单一值”创建为“流” * “单一值”可以为任何数据类型 */ of(1, 2, 3, 4, 5) .pipe( filter(item => item % 2 === 1), map(item => item * 3) ) /** * 冷 Observable 必须被 subscribe 之后才会“产生”数据 * 如果没有 subscribe，之前的 pipe 就不会执行 * 所以，对同一接口多次 subscribe 会导致发起多次请求 * subscribe 表示“可观察对象”与“观察者”之间“建立了联系” */ .subscribe(item => console.log(item)); // 3 9 15 // from 可以将数组的每一项放入“流”中 from([1, 2, 3, 4, 5]) .pipe( filter(item => item % 2 === 1), map(item => item * 3) ) .subscribe(item => console.log(item)); // 3 9 15 /** * fromEvent 可以替代 addEventListener，它是「温」的： * 1. 当第一个订阅者出现时，它才会调用 addEventListener 去监听事件 * 2. 当最后一个订阅者取消订阅时，它会调用 removeEventListener 移除监听 * 3. 尽管有「热」的特性（多订阅者共享），但它依然需要至少一个订阅者来启动 */ const fromEvent$ = fromEvent(document.querySelector('#title'), 'click'); fromEvent$.subscribe(v => console.log(v)); // PointerEvent // range 可以从“范围”产生“流” range(1, 5) .pipe( filter(item => item % 2 === 1), map(item => item * 3) ) .subscribe(item => console.log(item)); // 3 9 15 const p = new Promise((resolve, reject) => { console.log('Promise Begin...'); setTimeout(() => resolve('Promise Resolved...'), 1000); }); /** * fromPromise 接受一个 Promise 实例 * 当这个 Promise 状态确定之后，将输出值放入“流”中 * 即使没有 subscribe，这个 Promise 也会执行 * 从 6.0 开始，可以使用 from 替代 fromPromise * from/fromPromise 的这个特性可能让你觉得它是「热」的 * 但是 Promise 立即执行，是 Promise 的特性，而非 from 触发的 */ fromPromise(p).subscribe(item => console.log(item)); /** * defer 用来“惰性地”创建“流” * 他接受一个“产生流”的“工厂函数” * 当调用 defer 时，“流”还不存在，“流”会被“按需”创建 * 当“流”被“需要”的时候，才会调用“工厂函数”，产生“流” * 只要没有 subscribe，“工厂函数”就不会执行，Promise 也就不会执行 */ defer(() => from(p)).subscribe(item => console.log(item)); /** * timer(首次等待时间，重复间隔时间) 用来创建“定时器流” * 他创建的是一种“无尽流”（务必要在适当的时候取消订阅） * 数据会不断重复的被放入“流”中 * 有点像 setInterval */ timer(3000, 1000).subscribe(item => console.log(item)); // 等待 3 秒：0 1 2 3... // interval（重复间隔时间），是 timer 的语法糖 interval(1000).subscribe(item => console.log(item)); // 0 1 2 3... // first 操作符 from([0, 1, 2, 3]) .pipe(first(v => v !== 0)) .subscribe({ next(v) { console.log(v); // 1 }, complete() { console.log('complete'); } }); // last 操作符 from([0, 1, 2, 3]) .pipe(last(v => v !== 0)) .subscribe({ next(v) { console.log(v); // 3 }, complete() { console.log('complete'); } }); // distinct 操作符（过滤之前出现过的数据，去重作用） from([1, 2, 2, 3, 3, 3]) .pipe(distinct()) .subscribe({ next(v) { console.log(v); // 1, 2, 3 }, complete() { console.log('complete'); } }); // distinctUntilChanged 操作符（过滤“上次”出现过的数据） from([2, 1, 2, 1, 3, 3, 3]) .pipe(distinctUntilChanged()) .subscribe({ next(v) { console.log(v); // 2, 1, 2, 1, 3 }, complete() { console.log('complete'); } }); // combineLatest 操作符 const cl1 = new Subject(); const cl2 = new Subject(); // 一秒钟后，cl2 接收到值之后，打印 ['cl1', 'cl2'] combineLatest([cl1, cl2]).subscribe(v => console.log(v)); cl1.next('cl1'); setTimeout(() => { cl2.next('cl2'); }, 1000); // merge 操作符 const m1 = new Subject(); const m2 = new Subject(); const m3 = new Subject(); merge(m1, m2, m3).subscribe(v => console.log(v)); // m3, m1 一秒钟后 m2 m3.next('m3'); setTimeout(() => { m2.next('m2'); }, 1000); m1.next('m1'); // zip 操作符，强调值的数量相同 const z1 = new Subject(); const z2 = new Subject(); zip(z1, z2).subscribe(v => console.log(v)); z1.next(1); // 不打印 z1.next(2); // 不打印 z2.next(3); // [1, 3]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第一个值 z2.next(4); // [2, 4]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第二个值 // concat 操作符 const c1 = new Subject(); const c2 = new Subject(); concat(c1, c2).subscribe(v => console.log(v)); c1.next(1); // 1 c2.next(2); // 不打印 c1.complete(); c2.next(3); // 3，c1 被 complete 之前，c2 的值被忽略 // forkJoin 操作符 const fj1 = new Subject(); const fj2 = new Subject(); forkJoin(fj1, fj2).subscribe(v => console.log(v)); fj1.next(1); // 不打印 fj2.next(2); // 不打印 fj1.complete(); // 不打印 fj2.complete(); // [1, 2] // race 操作符 const r1 = new Subject(); const r2 = new Subject(); race(r1, r2).subscribe(v => console.log(v)); r2.next(1); // 1 r1.next(2); // 不打印，r1 没有竞争过 r2 r2.next(3); // 3 r1.next(4); // 不打印 // catchError 操作符 new Observable(sub => { sub.next('normal'); // 会走到 subscribe sub.error('error'); }) .pipe( catchError(error => { console.log(error); // 只会打印 error return of('catched'); // 会走到 subscribe }) ) .subscribe(v => { console.log(v); // 先打印 normal 再打印 catched }); // buffer 操作符，收集输出值（缓冲区） interval(1000) .pipe(buffer(fromEvent(document, 'click'))) .subscribe(v => { /** * [0, 1, 2, 3] * [4, 5, 6, 7, 8, 9, 10] * ... */ console.log(v); }); // bufferCount 操作符，收集输出值 interval(1000) .pipe(bufferCount(3)) // 三个三个走 .subscribe(v => { /** * [0, 1, 2] * [3, 4, 5] * ... */ console.log(v); }); // bufferTime 操作符，收集输出值 interval(1000) .pipe(bufferTime(3000, 1000)) .subscribe(v => { /** * 等 3 秒 [0, 1] * 等 1 秒 [0, 1, 2, 3] * 等 1 秒 [2, 3, 4, 5] * ... */ console.log(v); }); // finalize 操作符 const f = new Subject(); f.pipe(finalize(() => console.log('finalize'))).subscribe(v => console.log(v)); f.next('next'); // next f.error('error'); // finalize f.complete(); // finalize Observable 不同于创建器（调用后返回 Observable 对象），Subject 是一个实现了 Observable 接口的“类”；需要先进行 new 调用，然后将数据“手动”放入“流”中（subject.next(value)）。
"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://ElementRef.github.io/img/cover/rxjs.png"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><meta name="robots" content="noarchive, noindex, nofollow"><meta name="theme-color" content="#ffffff"><script defer="" src="https://umami.pavilion0321907.workers.dev/elementref.js" data-website-id="87868be0-a9cf-4f8c-8fee-e3cbb99e6cf2"></script></head><body class="article-page"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container extended flex main-container on-phone--column"><aside class="sidebar sticky left-sidebar"><button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
<span class="hamburger-box"><span class="hamburger-inner"></span></span></button><header><figure class="site-avatar"><a href="/"><img src="/img/avatar_hu15751654176150258532.webp" width="300" height="404" class="site-logo" alt="Avatar" fetchpriority="high" decoding="async"></a></figure><div class="site-meta"><h1 class="site-name"><a href="/">馬腊咯稽</a></h1><h2 class="site-description">I AM BEA, I DRINK TEA</h2></div></header><ol class="social-menu"><li><a href="https://github.com/ElementRef" target="_blank" title="GitHub"><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"></path></svg></a></li><li><a href="https://m.weibo.cn/u/6447635754" target="_blank" title="Weibo"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-weibo"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M19 14.127C19 17.2 15.498 20 11 20c-4.126.0-8-2.224-8-5.565.0-1.78.984-3.737 2.7-5.567 2.362-2.51 5.193-3.687 6.551-2.238.415.44.752 1.39.749 2.062 2-1.615 4.308.387 3.5 2.693 1.26.557 2.5.538 2.5 2.742z"></path><path d="M15 4h1a5 5 0 015 5v1"></path></svg></a></li><li><a href="https://douban.com/people/nicknoonan" target="_blank" title="DouBan"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-douban"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M4 20h16"></path><path d="M5 4h14"></path><path d="M8 8h8a2 2 0 012 2v2a2 2 0 01-2 2H8a2 2 0 01-2-2v-2a2 2 0 012-2z"></path><path d="M16 14l-2 6"></path><path d="M8 17l1 3"></path></svg></a></li><li><a href="https://x.com/SpiciComic" target="_blank" title="Twitter"><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"></path></svg></a></li><li><a href="https://last.fm/zh/user/SpiciComic/listening-report" target="_blank" title="Last.fm"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-lastfm"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M20 8c-.83-1-1.388-1-2-1-.612.0-2 .271-2 2s1.384 2.233 3 3 2.125 1.812 2 3-1 2-3 2-3-1-3.5-2-1.585-4.78-2.497-6a5 5 0 10-1 7"></path></svg></a></li></ol><ol class="menu" id="main-menu"><li><a href="/"><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><polyline points="5 12 3 12 12 3 21 12 19 12"></polyline><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"></path></svg>
<span>首页</span></a></li><li><a href="/archives/"><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><rect x="3" y="4" width="18" height="4" rx="2"></rect><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"></path><line x1="10" y1="12" x2="14" y2="12"></line></svg>
<span>归档</span></a></li><li><a href="/search/"><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="10" cy="10" r="7"></circle><line x1="21" y1="21" x2="15" y2="15"></line></svg>
<span>搜索</span></a></li><li><a href="/%E5%90%AF%E5%8F%91/"><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"></path><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"></path></svg>
<span>启发</span></a></li><li><a href="/%E5%91%BD%E4%BB%A4/"><svg class="icon icon-tabler icon-tabler-terminal" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 7l5 5-5 5"></path><line x1="12" y1="19" x2="19" y2="19"></line></svg>
<span>命令</span></a></li><li><a href="/%E5%85%B3%E4%BA%8E/"><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"></path></svg>
<span>关于</span></a></li><div class="menu-bottom-section"><li id="dark-mode-toggle"><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="8" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="16" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<span>深色</span></li></div></ol></aside><main class="full-width main"><article class="has-image main-article"><header class="article-header"><div class="article-image"><a href="/p/rxjs-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"><img src="/img/cover/rxjs.webp" alt="RxJS 快速上手" fetchpriority="high" decoding="async" width="1200" height="675" jampack-sized="true"></a></div><div class="article-details"><header class="article-category"><a href="/categories/rxjs/">RxJS</a></header><div class="article-title-wrapper"><h2 class="article-title"><a href="/p/rxjs-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/">RxJS 快速上手</a></h2></div><footer class="article-time"><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"></path><circle cx="18" cy="18" r="4"></circle><path d="M15 3v4"></path><path d="M7 3v4"></path><path d="M3 11h16"></path><path d="M18 16.496V18l1 1"></path></svg>
<time class="article-time--published">Mar 18, 2022</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
<time class="article-time--reading">阅读时长：10 分钟</time></div></footer></div></header><section class="article-content"><p>RxJS 是 ReactiveX 在 JS 中的实现，相似的还有 RxJava、RxSwift…；ReactiveX 是 FRP（函数响应式编程）的践行者。</p><h2 id="操作符">操作符</h2><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// 创建器，用来创建“流（数据序列）”，返回值是一个 Observable 对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">def</span><span class="p">,</span> <span class="kr">from</span><span class="p">,</span> <span class="nx">fromEvent</span><span class="p">,</span> <span class="nx">interval</span><span class="p">,</span> <span class="k">of</span><span class="p">,</span> <span class="nx">range</span><span class="p">,</span> <span class="nx">timer</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">fromPromise</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs/internal/observable/fromPromise'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 操作符，用来处理“流”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">buffer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">bufferCount</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">bufferTime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">catchError</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">combineLatest</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">concat</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">distinct</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">distinctUntilChanged</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">filter</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">finalize</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">first</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">forkJoin</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">last</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">map</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">merge</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">race</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">zip</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs/operators'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">Observable</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;((</span><span class="nx">observer</span>: <span class="kt">Observer</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 任何时间，都可以通过 next 将值传入“流”中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * of 可以将“单一值”创建为“流”
</span></span></span><span class="line"><span class="cl"><span class="cm"> * “单一值”可以为任何数据类型
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filter</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 冷 Observable 必须被 subscribe 之后才会“产生”数据
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 如果没有 subscribe，之前的 pipe 就不会执行
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 所以，对同一接口多次 subscribe 会导致发起多次请求
</span></span></span><span class="line"><span class="cl"><span class="cm">   * subscribe 表示“可观察对象”与“观察者”之间“建立了联系”
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span> <span class="c1">// 3 9 15
</span></span></span><span class="line"><span class="cl"><span class="c1">// from 可以将数组的每一项放入“流”中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filter</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span> <span class="c1">// 3 9 15
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * fromEvent 可以替代 addEventListener，它是「温」的：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 1. 当第一个订阅者出现时，它才会调用 addEventListener 去监听事件
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2. 当最后一个订阅者取消订阅时，它会调用 removeEventListener 移除监听
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 3. 尽管有「热」的特性（多订阅者共享），但它依然需要至少一个订阅者来启动
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fromEvent$</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#title'</span><span class="p">),</span> <span class="s1">'click'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">fromEvent$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span> <span class="c1">// PointerEvent
</span></span></span><span class="line"><span class="cl"><span class="c1">// range 可以从“范围”产生“流”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filter</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span> <span class="c1">// 3 9 15
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Promise Begin...'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">resolve</span><span class="p">(</span><span class="s1">'Promise Resolved...'</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * fromPromise 接受一个 Promise 实例
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 当这个 Promise 状态确定之后，将输出值放入“流”中
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 即使没有 subscribe，这个 Promise 也会执行
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 从 6.0 开始，可以使用 from 替代 fromPromise
</span></span></span><span class="line"><span class="cl"><span class="cm"> * from/fromPromise 的这个特性可能让你觉得它是「热」的
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 但是 Promise 立即执行，是 Promise 的特性，而非 from 触发的
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">fromPromise</span><span class="p">(</span><span class="nx">p</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * defer 用来“惰性地”创建“流”
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 他接受一个“产生流”的“工厂函数”
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 当调用 defer 时，“流”还不存在，“流”会被“按需”创建
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 当“流”被“需要”的时候，才会调用“工厂函数”，产生“流”
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 只要没有 subscribe，“工厂函数”就不会执行，Promise 也就不会执行
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">defer</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="kr">from</span><span class="p">(</span><span class="nx">p</span><span class="p">)).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * timer(首次等待时间，重复间隔时间) 用来创建“定时器流”
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 他创建的是一种“无尽流”（务必要在适当的时候取消订阅）
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 数据会不断重复的被放入“流”中
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 有点像 setInterval
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">timer</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span> <span class="c1">// 等待 3 秒：0 1 2 3...
</span></span></span><span class="line"><span class="cl"><span class="c1">// interval（重复间隔时间），是 timer 的语法糖
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">));</span> <span class="c1">// 0 1 2 3...
</span></span></span><span class="line"><span class="cl"><span class="c1">// first 操作符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">from</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">first</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">v</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span> <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">complete() {</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// last 操作符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">from</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">last</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">v</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span> <span class="c1">// 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">complete() {</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// distinct 操作符（过滤之前出现过的数据，去重作用）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">distinct</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span> <span class="c1">// 1, 2, 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">complete() {</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// distinctUntilChanged 操作符（过滤“上次”出现过的数据）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">from</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">distinctUntilChanged</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span> <span class="c1">// 2, 1, 2, 1, 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">complete() {</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// combineLatest 操作符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">cl1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cl2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 一秒钟后，cl2 接收到值之后，打印 ['cl1', 'cl2']
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">combineLatest</span><span class="p">([</span><span class="nx">cl1</span><span class="p">,</span> <span class="nx">cl2</span><span class="p">]).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">cl1</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">'cl1'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cl2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">'cl2'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// merge 操作符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">m1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">m2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">m3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">merge</span><span class="p">(</span><span class="nx">m1</span><span class="p">,</span> <span class="nx">m2</span><span class="p">,</span> <span class="nx">m3</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span> <span class="c1">// m3, m1 一秒钟后 m2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">m3</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">'m3'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">m2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">'m2'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">m1</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">'m1'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// zip 操作符，强调值的数量相同
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">z1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">z2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">zip</span><span class="p">(</span><span class="nx">z1</span><span class="p">,</span> <span class="nx">z2</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">z1</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 不打印
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">z1</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 不打印
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">z2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// [1, 3]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第一个值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">z2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// [2, 4]，z1 和 z2 里值的数量相同，打印出 z1 和 z2 里的第二个值
</span></span></span><span class="line"><span class="cl"><span class="c1">// concat 操作符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">c1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">c2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">concat</span><span class="p">(</span><span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">c1</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">c2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 不打印
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">c1</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">c2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// 3，c1 被 complete 之前，c2 的值被忽略
</span></span></span><span class="line"><span class="cl"><span class="c1">// forkJoin 操作符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">fj1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fj2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">forkJoin</span><span class="p">(</span><span class="nx">fj1</span><span class="p">,</span> <span class="nx">fj2</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">fj1</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 不打印
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fj2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 不打印
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fj1</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span> <span class="c1">// 不打印
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fj2</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span> <span class="c1">// [1, 2]
</span></span></span><span class="line"><span class="cl"><span class="c1">// race 操作符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">r1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">r2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">race</span><span class="p">(</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">r2</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">r2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r1</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 不打印，r1 没有竞争过 r2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r1</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// 不打印
</span></span></span><span class="line"><span class="cl"><span class="c1">// catchError 操作符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">new</span> <span class="nx">Observable</span><span class="p">(</span><span class="nx">sub</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sub</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">'normal'</span><span class="p">);</span> <span class="c1">// 会走到 subscribe
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">sub</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'error'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">catchError</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span> <span class="c1">// 只会打印 error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="k">of</span><span class="p">(</span><span class="s1">'catched'</span><span class="p">);</span> <span class="c1">// 会走到 subscribe
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span> <span class="c1">// 先打印 normal 再打印 catched
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// buffer 操作符，收集输出值（缓冲区）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">buffer</span><span class="p">(</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">'click'</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * [0, 1, 2, 3]
</span></span></span><span class="line"><span class="cl"><span class="cm">     * [4, 5, 6, 7, 8, 9, 10]
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ...
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// bufferCount 操作符，收集输出值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">bufferCount</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="c1">// 三个三个走
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * [0, 1, 2]
</span></span></span><span class="line"><span class="cl"><span class="cm">     * [3, 4, 5]
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ...
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// bufferTime 操作符，收集输出值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">bufferTime</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 等 3 秒 [0, 1]
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 等 1 秒 [0, 1, 2, 3]
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 等 1 秒 [2, 3, 4, 5]
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ...
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// finalize 操作符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">f</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">finalize</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'finalize'</span><span class="p">))).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">f</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">'next'</span><span class="p">);</span> <span class="c1">// next
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">f</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'error'</span><span class="p">);</span> <span class="c1">// finalize
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">f</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span> <span class="c1">// finalize
</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="observable">Observable</h2><p>不同于创建器（调用后返回 Observable 对象），Subject 是一个实现了 Observable 接口的“类”；需要先进行 new 调用，然后将数据“手动”放入“流”中（subject.next(value)）。</p><p>有别于普通的 Observable 对象（单播），Subject 返回的是一个“多播”，可以被多次 subscribe，可以将值传递给多个观察者；所以常常被用来存放应用状态。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Subject</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">&lt;</span><span class="nt">unknown</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">res</span>: <span class="kt">unknown</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'one'</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">res</span>: <span class="kt">unknown</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'two'</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 每个 subscribe 都收到新值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// one 1, two 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// one 2, two 2
</span></span></span><span class="line"><span class="cl"><span class="c1">// 通过 subject 将 observable 转换为“多播”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="kr">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">subject</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// one 1, two: 1
</span></span></span><span class="line"><span class="cl"><span class="c1">// one 2, two: 2
</span></span></span><span class="line"><span class="cl"><span class="c1">// one 3, two: 3
</span></span></span></code></pre></td></tr></tbody></table></div></div><p>当 subscribe 被调用时，会返回一个“订阅凭证”；“订阅凭证”包含了一个 unsubscribe 方法，用来取消“订阅”（调用即可）。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Observable</span><span class="p">,</span> <span class="nx">Subscription</span><span class="p">,</span> <span class="nx">interval</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">temp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">(</span><span class="nx">o</span> <span class="o">=&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 每次调用 subscribe 后生成了新的值，next 被调用了两次（数据产生于每次订阅后）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">temp</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span> <span class="c1">// 4491799.400000002
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">temp</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span> <span class="c1">// 4491799.699999999
</span></span></span><span class="line"><span class="cl"><span class="c1">// 执行顺序：2 -&gt; 0 -&gt; 3 -&gt; 1 -&gt; 4 -&gt; 0 -&gt; 5 -&gt; 1 -&gt; 6
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">park</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">(</span><span class="nx">subscriber</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 每次调用 subscribe 后，这个函数会重新执行
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 不会被放到微任务列表/下个事件循环
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'0'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'1'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'2'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">park</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'3'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'4'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">park</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'5'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'6'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * subCollection.add
</span></span></span><span class="line"><span class="cl"><span class="cm"> * subCollection.remove
</span></span></span><span class="line"><span class="cl"><span class="cm"> * subCollection.unsubscribe
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subCollection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subscription</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">observable1</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">observable2</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subscription1</span> <span class="o">=</span> <span class="nx">observable1</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subscription2</span> <span class="o">=</span> <span class="nx">observable2</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">subCollection</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">subscription1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subCollection</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">subscription2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 可以存起来，一起被取消
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">subCollection</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="冷与热">“冷”与“热”</h2><p>“可观察对象”的分类：</p><ul><li>“冷”可观察对象，在 <strong>subscribe</strong> 之后，才将“值”添加到“流”中；有多少个订阅就会生成多少个订阅实例（单播，订阅接收到的值是相同的）；</li><li>“热”可观察对象，在<strong>创建</strong>之后，<strong>立即</strong>产生了“值”；多个订阅共享同一个实例（多播，订阅接收到的值取决于什么时间开始订阅的）。</li></ul><p>特殊的“可观察对象”：</p><ul><li>AsyncSubject，多播；需要初始值；只有当 complete 时，才会将“最后一个值”发送给订阅者；</li><li>BehaviorSubject，多播；需要初始值；保存了发送出去的“最后一个值”，“新的”订阅者会接收到这个值；</li><li>ReplaySubject，多播；需要初始值；保存了发送出去的“所有值”，“新的”订阅者会接收到所有“旧”值；</li><li>Subject，多播；不需要初始值；不会保存之前的任何值。</li></ul><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">AsyncSubject</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">EMPTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">never</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Observable</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Subject</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">throwError</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">mySubject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">&lt;</span><span class="nt">number</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="nx">mySubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">mySubject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 因为 20 是 subscribe 后放入流的
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 而 10 是 subscribe 前放入流的
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 只会打印 20，没有接收到 10
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">mySubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">outter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cold</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">(</span><span class="nx">sub</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">outter</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">inner</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sub</span><span class="p">.</span><span class="nx">next</span><span class="p">({</span> <span class="nx">inner</span><span class="p">,</span> <span class="nx">outter</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">cold</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span> <span class="c1">// { inner: 0, outter: 1 }
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">cold</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span> <span class="c1">// { inner: 0, outter: 2 }
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">hot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AsyncSubject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">hot</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * hot.complete 调用之后
</span></span></span><span class="line"><span class="cl"><span class="cm">   * hot.error 和 hot.next 的调用将被忽略
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">hot</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * hot.error 调用之后
</span></span></span><span class="line"><span class="cl"><span class="cm">   * subscribe 拿不到最后一个值
</span></span></span><span class="line"><span class="cl"><span class="cm">   * hot.complete 和 hot.next 的调用将被忽略
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">hot</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">hot</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">complete() {</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 只有 hot.complete 被调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * subscribe.next 才能拿到最后一个值
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'next'</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">EMPTY</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'next'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">complete</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'只会触发 complete'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="kt">never</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'不会触发 next'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">complete</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'不会触发 complete'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">throwError</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="s1">'ERROR'</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'next'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'只会触发 error'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">complete</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="switchmapmergemapexhaustmapconcatmap">switchMap、mergeMap、exhaustMap、concatMap</h2><ol><li>switchMap：会自动帮我们处理“竞态”；在第一个请求没有完成的情况下，发起第二个请求；第一个请求将被忽略；</li><li>mergeMap：不会帮我们处理“竞态”；最终会使用哪个请求返回的结果，不一定；有可能新的请求使用旧的结果；</li><li>exhaustMap：第一个请求没处理完成，就会忽略新的请求；只有第一个求请完成的情况下，才能处理新的请求；</li><li>concatMap：开启队列，按<strong>顺序</strong>处理所有的请求及其副作用；不会丢弃老的/新的请求。</li></ol><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Subject</span><span class="p">,</span> <span class="nx">timer</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mapTo</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">switchMap</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mergeMap</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">concatMap</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">exhaustMap</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs/operators'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">anyLongRunningOp</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">timer</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mapTo</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">triggerEvents</span><span class="p">(</span><span class="nx">operator</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sub</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">asObservable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">operator</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">anyLongRunningOp</span><span class="p">(</span><span class="nx">value</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Got:'</span><span class="p">,</span> <span class="nx">value</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sub</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">'First'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sub</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">'Second'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * concatMap 会开启一个队列，保存每一个传入的值以及对应的操作
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 当第一个值 First 走完所有流程之后，才会开始处理 Second
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 所以结果是：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 若干秒之后，打印 Got: First
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 又若干秒之后，打印 Got: Second
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">triggerEvents</span><span class="p">(</span><span class="nx">concatMap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * exhaustMap 只关心传入的第一个值 First，并忽略后续传入的所有值
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 除非第一个值的流程已经走完，第二个值才传入
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 所以结果是：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 若干秒之后，打印 Got: First，Second 这个值被丢弃
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 如果 Second 是在若干秒之后才传入的，此时 First 流程已经走完
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 那么，会打印 Got: Second
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">triggerEvents</span><span class="p">(</span><span class="nx">exhaustMap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * mergeMap 不会等待上次流程的结束
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 他会同时处理传入的所有值
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 并且不保证顺序与传入顺序
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 所以结果是：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 若干秒之后，同时打印出 Got: First、Got: Second
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 至于哪个在前，哪个在后，不确定
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">triggerEvents</span><span class="p">(</span><span class="nx">mergeMap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 如果第二个值 Second 在两秒之内传给 switchMap
</span></span></span><span class="line"><span class="cl"><span class="cm"> * switchMap 会丢弃对第一个值 First 的处理
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 所以结果是：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 若干秒之后，只会打印 Got: Second
</span></span></span><span class="line"><span class="cl"><span class="cm"> * First 这个值被丢弃
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">triggerEvents</span><span class="p">(</span><span class="nx">switchMap</span><span class="p">);</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>mergeMap 可以传入第二个参数，用来控制请求并发数：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">mergeMap</span><span class="p">,</span> <span class="nx">reduce</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">requestArr</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">({</span> <span class="nx">length</span><span class="o">:</span> <span class="mi">30</span> <span class="p">},</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">requestFn</span> <span class="o">=</span> <span class="kr">async</span> <span class="nx">randomKey</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sb">`https://randomuser.me/api/?key=</span><span class="si">${</span><span class="nx">randomKey</span><span class="si">}</span><span class="sb">&amp;ref=</span><span class="si">${</span><span class="nx">randomKey</span><span class="si">}</span><span class="sb">&amp;speed=</span><span class="si">${</span><span class="nx">randomKey</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">cache</span><span class="o">:</span> <span class="s1">'no-store'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'application/json'</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">results</span><span class="o">:</span> <span class="p">[{</span> <span class="nx">email</span> <span class="p">}]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">email</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">resPool</span> <span class="o">=</span> <span class="nx">from</span><span class="p">(</span><span class="nx">requestArr</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mergeMap</span><span class="p">(</span><span class="nx">id</span> <span class="p">=&gt;</span> <span class="nx">from</span><span class="p">(</span><span class="nx">requestFn</span><span class="p">(</span><span class="nx">id</span><span class="p">)).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">({</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">res</span> <span class="p">}))),</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">result</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="nx">acc</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">result</span><span class="p">),</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">map</span><span class="p">(</span><span class="nx">resMap</span> <span class="p">=&gt;</span> <span class="nx">requestArr</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">id</span> <span class="p">=&gt;</span> <span class="nx">resMap</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">resPool</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">());</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="forkjoin-与-combinelatest">forkJoin 与 combineLatest</h2><p><a class="link" href="https://www.learnrxjs.io/learn-rxjs/operators/combination/forkjoin" target="_blank" rel="noopener">forkJoin
</a>，当传入的所有 observer 对象都 complete 时，将这些 observer 对象的最后一个值抛出；有点像 <a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" target="_blank" rel="noopener">Promise.all
</a>。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">delay</span><span class="p">,</span> <span class="nx">forkJoin</span><span class="p">,</span> <span class="nx">from</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">requestFn</span> <span class="o">=</span> <span class="kr">async</span> <span class="nx">randomKey</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="sb">`https://randomuser.me/api/?key=</span><span class="si">${</span><span class="nx">randomKey</span><span class="si">}</span><span class="sb">&amp;ref=</span><span class="si">${</span><span class="nx">randomKey</span><span class="si">}</span><span class="sb">&amp;speed=</span><span class="si">${</span><span class="nx">randomKey</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">cache</span><span class="o">:</span> <span class="s1">'no-store'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'application/json'</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">results</span><span class="o">:</span> <span class="p">[{</span> <span class="nx">email</span> <span class="p">}]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">email</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">forkJoin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">people1</span><span class="o">:</span> <span class="nx">from</span><span class="p">(</span><span class="nx">requestFn</span><span class="p">(</span><span class="s1">'53C4BD59AB229086'</span><span class="p">)).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">people2</span><span class="o">:</span> <span class="nx">from</span><span class="p">(</span><span class="nx">requestFn</span><span class="p">(</span><span class="s1">'FEA12EE8FCC453B4'</span><span class="p">)).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">people3</span><span class="o">:</span> <span class="nx">from</span><span class="p">(</span><span class="nx">requestFn</span><span class="p">(</span><span class="s1">'219C6D9AE6169200'</span><span class="p">)).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">delay</span><span class="p">(</span><span class="mi">3000</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 过了三秒多，当三个请求都返回结果时：只会打印一次，而不是三次
</span></span></span><span class="line"><span class="cl"><span class="cm">   * {
</span></span></span><span class="line"><span class="cl"><span class="cm">   *    people1: "sarita.saniel@example.com"
</span></span></span><span class="line"><span class="cl"><span class="cm">   *    people2: "lucas.candelaria@example.com"
</span></span></span><span class="line"><span class="cl"><span class="cm">   *    people3: "ross.brown@example.com"
</span></span></span><span class="line"><span class="cl"><span class="cm">   * }
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p><a class="link" href="https://www.learnrxjs.io/learn-rxjs/operators/combination/combinelatest" target="_blank" rel="noopener">combineLatest
</a>每当传入的任何一个 observer 抛出一个值的时候，将这些 observer 对象的最后一个值抛出；传入几个值就会抛出多少次，直到所有的 observer 都 complete。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">combineLatest</span><span class="p">,</span> <span class="nx">timer</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">combineLatest</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">people1</span><span class="o">:</span> <span class="nx">timer</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">people2</span><span class="o">:</span> <span class="nx">timer</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">people3</span><span class="o">:</span> <span class="nx">timer</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 可以看到，无论哪个 observer 接收到了值，都会触发这个回调
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 为什么不在 forkJoin 中使用 timer 呢？
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 因为 timer 不会自动 complete
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 第一秒：{people1: 1, people2: 0, people3: 0}
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 第二秒：{people1: 2, people2: 0, people3: 0}
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 第三秒：{people1: 3, people2: 0, people3: 0}
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 第四秒：{people1: 3, people2: 1, people3: 0}
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 第五秒：{people1: 4, people2: 1, people3: 0}
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 第六秒：{people1: 5, people2: 1, people3: 0}
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 第七秒：{people1: 5, people2: 2, people3: 0}
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 第八秒：{people1: 5, people2: 2, people3: 1}
</span></span></span><span class="line"><span class="cl"><span class="cm">   * ...
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="filter-与-takewhile">filter 与 takeWhile</h2><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="k">of</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">takeWhile</span><span class="p">,</span> <span class="nx">filter</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs/operators'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="k">of</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// takeWhile 遇到不满足条件的数据，就 complete
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">source</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">takeWhile</span><span class="p">(</span><span class="nx">it</span> <span class="o">=&gt;</span> <span class="nx">it</span> <span class="o">===</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'takeWhile'</span><span class="p">,</span> <span class="nx">val</span><span class="p">));</span> <span class="c1">// 3 3 3
</span></span></span><span class="line"><span class="cl"><span class="c1">// filter 遇到不满足条件的数据，过滤掉，没有 complete
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">source</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nx">it</span> <span class="o">=&gt;</span> <span class="nx">it</span> <span class="o">===</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'filter'</span><span class="p">,</span> <span class="nx">val</span><span class="p">));</span> <span class="c1">// 3 3 3 3 3 3 3
</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="first-与-take1">first 与 take(1)</h2><ol><li>当 first <strong>可以</strong>从数据流中取得一个值的时候，等同于 take(1)；</li><li>当 first <strong>不能</strong>从数据流中取得一个值的时候，会直接抛错误，而 take(1) 不会。</li></ol><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">EMPTY</span><span class="p">,</span> <span class="nx">range</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">first</span><span class="p">,</span> <span class="nx">take</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs/operators'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// first 遇上 EMPTY 打印 error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">EMPTY</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">first</span><span class="p">()).</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'next'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">complete</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 打印 next complete
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">first</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'next'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">error</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">complete</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 不满足条件，打印 error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">first</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">val</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'next'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">error</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">complete</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// take(1) 遇上 EMPTY 打印 complete
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">EMPTY</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'next'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">error</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">complete</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 打印 next complete
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'next'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">error</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">complete</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="参考">参考</h2><ul><li><a class="link" href="https://medium.com/@rk-tech/simplified-explanation-of-switchmap-concatmap-mergemap-and-exhaustmap-bceb98081714" target="_blank" rel="noopener">Simplified Explanation of switchMap, concatMap, mergeMap, and exhaustMap</a></li><li><a class="link" href="https://blog.thoughtram.io/angular/2016/06/16/cold-vs-hot-observables.html" target="_blank" rel="noopener">Cold vs Hot Observables</a></li><li><a class="link" href="https://ralph.wang/articles/rxjs-quick-start" target="_blank" rel="noopener">RxJS 快速入门</a></li></ul></section><footer class="article-footer"><section class="article-not-by-ai-badge"><a href="https://notbyai.fyi/cn/" target="_blank" title="Not By AI"><svg width="131" height="42" viewBox="0 0 131 42" fill="none"><path d="M.5.5H116c8.008.0 14.5 6.49187 14.5 14.5V41.5H15C6.99187 41.5.5 35.0081.5 27V.5z" fill="#fff" stroke="#000"></path><path d="M17.9605 24.1575c3.4661 2.8068 8.4231 2.8068 11.8892.0l-1.3402-1.6549c-2.6847 2.174-6.5241 2.174-9.2088.0l-1.3402 1.6549z" fill="#000"></path><path d="M19.404 20.5134V17.6365h2.1296v2.8769H19.404z" fill="#000"></path><path d="M26.012 17.6365v2.8769h2.1295V17.6365H26.012z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M35 21.5C35 27.8513 29.8513 33 23.5 33S12 27.8513 12 21.5C12 15.1487 17.1487 10 23.5 10S35 15.1487 35 21.5zm-2.1295.0c0 5.1752-4.1953 9.3705-9.3705 9.3705S14.1295 26.6752 14.1295 21.5s4.1953-9.3705 9.3705-9.3705 9.3705 4.1953 9.3705 9.3705z" fill="#000"></path><path d="M61.844 12.1721l.1995.711L62.2294 12.8197C62.5169 12.7216 62.8276 12.6155 63.1503 12.5052v2.55C63.1503 15.1818 63.1005 15.2208 62.9709 15.2208 62.8612 15.2208 62.4922 15.2208 62.0634 15.211 62.1631 15.4156 62.2628 15.7273 62.2928 15.9123 62.901 15.9123 63.28 15.8929 63.5293 15.776 63.7686 15.6591 63.8583 15.4545 63.8583 15.0455V12.2629C64.2106 12.1421 64.5673 12.0195 64.9154 11.8994L64.8057 11.2273C64.4898 11.3348 64.1706 11.4415 63.8583 11.5441V9.63961H64.8057V8.95779H63.8583V7H63.1503V8.95779H61.9936v.68182h1.1567V11.7732C62.6577 11.9301 62.2064 12.0683 61.844 12.1721z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M66.0322 10.7695C65.3142 10.7695 65.1347 10.5162 65.1347 9.8052V7.39935h2.6127V9.32792H65.763V9.81494C65.763 10.1169 65.8128 10.2045 66.0322 10.2045H67.2986C67.4781 10.2045 67.7474 10.1948 67.9069 10.1656 67.9134 10.2165 67.92 10.2777 67.9268 10.3422 67.941 10.4754 67.9566 10.6224 67.9767 10.7208 67.8371 10.7597 67.5779 10.7695 67.3086 10.7695H66.0322zM65.763 7.90584H67.1391V8.82143H65.763V7.90584z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M69.0736 10.7208C68.3656 10.7208 68.1861 10.4773 68.1861 9.76623V7.39935H70.8087V9.2987H68.8144V9.77597C68.8144 10.0682 68.8642 10.1656 69.0936 10.1656h1.3262C70.5993 10.1656 70.8985 10.1461 71.058 10.1071 71.068 10.2825 71.0979 10.5357 71.1179 10.6721 70.9783 10.7208 70.709 10.7208 70.4298 10.7208H69.0736zM68.8144 7.90584h1.396v.88637h-1.396V7.90584z" fill="#000"></path><path d="M66.83 14.1299C66.2715 14.6753 65.3142 15.1818 64.4567 15.5032 64.6262 15.6201 64.9054 15.8539 65.035 15.9805 65.8727 15.6104 66.8898 14.9968 67.5081 14.3831L66.83 14.1299z" fill="#000"></path><path d="M68.4554 14.4513C69.2132 14.9091 70.1905 15.5812 70.6791 16L71.2974 15.6104C70.7788 15.1818 69.7916 14.539 69.0437 14.1007L68.4554 14.4513z" fill="#000"></path><path d="M50.4761 15.9318C49.798 15.5617 48.6612 15.0942 47.5344 14.7338L48.0031 14.2468C49.1299 14.5974 50.3564 15.0552 51.0844 15.4253L50.4761 15.9318z" fill="#000"></path><path d="M42 15.4156C43.067 15.1623 44.4032 14.6656 45.0713 14.2468L45.7594 14.6753C44.9218 15.1721 43.5855 15.6786 42.5185 15.9513 42.4088 15.8052 42.1596 15.5519 42 15.4156z" fill="#000"></path><path d="M56.1556 7.21693C56.1571 7.15007 56.1585 7.0868 56.1601 7.02922H56.9877L56.9868 7.0714C56.9788 7.4194 56.968 7.88942 56.9233 8.43665 57.0639 9.58208 57.6711 13.7136 61.2258 15.2597 61.0064 15.4253 60.787 15.6786 60.6773 15.8831c-2.5071-1.144-3.5872-3.5484-4.0775-5.3684C56.13 12.4644 55.0681 14.6445 52.63 15.9221 52.5004 15.7273 52.2511 15.5032 52.0217 15.3474c3.9976-1.9757 4.0968-6.45452 4.1339-8.13047z" fill="#000"></path><path d="M75.0586 9.43506C75.1376 9.06022 75.2116 8.69288 75.2761 8.3539L74.5283 8.27597C74.3089 9.50325 73.9299 11.1688 73.6408 12.1623L74.3986 12.2305C74.4264 12.1301 74.4552 12.0226 74.4848 11.9091H78.3699C78.3296 12.3408 78.2883 12.7224 78.2455 13.0584H72.0851V13.7403h6.0611C78.0034 14.5883 77.8408 15.0239 77.6395 15.1916 77.5198 15.289 77.4002 15.2987 77.1708 15.2987 76.9215 15.2987 76.2334 15.2987 75.5454 15.2305 75.675 15.4253 75.7747 15.7175 75.7947 15.9221 76.4429 15.961 77.091 15.9708 77.4201 15.9513 77.799 15.9318 78.0284 15.8636 78.2677 15.6396 78.532 15.3814 78.7263 14.8409 78.8969 13.7403H81V13.0584H78.991C79.0434 12.6344 79.0943 12.1472 79.1452 11.5877 79.1552 11.4805 79.1751 11.2565 79.1751 11.2565H74.6483C74.7379 10.8862 74.8303 10.4846 74.92 10.0779H79.2948V9.43506H75.0586z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M65.1746 11.6266V12.25H66.5109v1.1299H64.7558v.6233H71.1079v-.6233H69.5523V12.25h1.3262v-.6234H69.5523v-.6623H68.8642v.6623H67.189V10.9838H66.5109V11.6266H65.1746zm2.0144 1.7533V12.25h1.6752v1.1299H67.189z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M42.1895 14.0909v-.6234h1.4359V9.06494h2.5129V8.4513H42.4687V7.81818h3.6696V7.00974H46.8762v.80844H50.7852V8.4513H46.8762v.61364h2.7623V13.4675h1.406v.6234h-8.855zm2.1539-.6234h4.5472V12.7857H44.3434V13.4675zm0-1.1493h4.5472V11.7338H44.3434V12.3182zm0-1.0617h4.5472v-.5747H44.3434v.5747zm0-1.0325h4.5472V9.58117H44.3434V10.224z" fill="#000"></path><path d="M72.3245 9.65909V7.52597h8.4362V9.65909H79.9829V8.20779H73.0624v1.4513H72.3245z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M105.32 26.2505C105.32 25.9898 105.336 25.4196 105.336 25.4196H101.424V23.8717H105.573C105.764 26.2238 106.11 28.471 106.651 30.2984c-.875.9892-1.892 1.8173-3.039 2.4531C104.107 33.2077 104.953 34.2016 105.288 34.7067 106.138 34.1597 106.93 33.5082 107.658 32.7639 108.338 33.9391 109.193 34.6415 110.254 34.6415 111.898 34.6415 112.649 33.9572 113 30.78 112.377 30.5356 111.563 29.9817 111.036 29.4277 110.956 31.4155 110.765 32.2301 110.445 32.2301 110.06 32.2301 109.67 31.686 109.312 30.7655 110.465 29.1244 111.389 27.1985 112.058 25.0611L109.711 24.4908C109.396 25.6095 108.983 26.659 108.478 27.6243 108.264 26.4884 108.09 25.2105 107.974 23.8717h4.866V21.5418H111.142L111.946 20.6945C111.387 20.1568 110.27 19.4399 109.455 19l-1.405 1.4175C108.553 20.7329 109.148 21.1437 109.647 21.5418H107.835C107.811 20.7923 107.808 20.0385 107.827 19.2933h-2.443C105.387 20.0364 105.403 20.7892 105.433 21.5418H98.9812v4.8879C98.9812 28.5642 98.9014 31.4481 97.7199 33.3707 98.2468 33.6477 99.3006 34.5275 99.6997 35 100.514 33.7498 100.957 32.0088 101.189 30.2753 101.506 30.8638 101.745 31.7506 101.775 32.4257 102.51 32.4257 103.18 32.4094 103.612 32.3279 104.091 32.2301 104.458 32.0672 104.809 31.5947 105.192 31.0733 105.272 29.5743 105.32 26.2505zM101.197 30.2141C101.316 29.3052 101.378 28.4 101.406 27.5703h1.652C103.023 29.1922 102.963 29.8644 102.829 30.0631 102.701 30.2261 102.558 30.2749 102.35 30.2749 102.102 30.2749 101.674 30.2596 101.197 30.2141z" fill="#000"></path><path d="M86.8673 22.112C87.1314 21.4187 87.3672 20.705 87.565 19.9939L85.1541 19.4399C84.6112 21.6395 83.5893 23.8717 82.3599 25.2077 82.9507 25.5336 83.9885 26.2342 84.4515 26.6415 84.9297 26.0332 85.4007 25.2744 85.839 24.4257h3.0672v2.4928H84.7709v2.2811h4.1353V32.002H82.8708v2.3137H97.4005V32.002H91.3332V29.1996H95.9156V26.9185H91.3332V24.4257H96.5543V22.112H91.3332V19.277H88.9062v2.835H86.8673z" fill="#000"></path><path d="M47.3436 28.4645C47.4377 28.0285 47.4856 27.6141 47.4988 27.2444H43.8462V25.11h3.6564V23.4807h-3.816V21.2811h3.816V19.3585h2.2992V27c0 2.8513-.862200000000001 6.0611-4.774 7.9837C44.6446 34.4134 43.9261 33.6802 43.3672 33.224 44.7784 32.6761 45.7414 31.786 46.3804 30.8057 45.6568 30.9237 44.9507 31.0375 44.2921 31.1436L43.4151 31.2851 43 28.9226C44.1273 28.8236 45.7056 28.6496 47.3436 28.4645z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M72.6755 34.3305 67.632 19.7976H64.2697L59.1875 34.3305h3.1111L63.2841 31.3431H68.5306l.9178 2.9874H72.6755zM65.9218 23.1202l1.7778 5.7186H64.0861l1.8357-5.7186z" fill="#000"></path><path d="M53.7456 19.3585v1.9226h4.1833v2.1996H53.7456V25.11H57.5457v2.1344H53.7456v1.6619H58.2163v2.1996H53.7456v3.6497H51.4144V19.3585h2.3312z" fill="#000"></path><path d="M75.2125 22.2696v9.5922H73.4582v2.4721H79.719V31.8618h-1.55V22.2696h1.55v-2.472H73.4582v2.472h1.7543z" fill="#000"></path></svg></a></section></footer></article><footer class="site-footer"><section class="copyright" style="display:flex;justify-content:flex-start;align-items:center">©
2017 -
2025
<a href="https://github.com/ElementRef" target="_blank">馬腊咯稽
</a><a href="https://ipw.cn/ipv6webcheck/?site=elementref.github.io" target="_blank" title="本站支持 IPv6 访问"><img style="display:inline-block;vertical-align:middle" src="https://static.ipw.cn/icon/ipv6-certified-lite-s1.svg" alt="本站支持 IPv6 访问" loading="lazy" decoding="async"></a></section><section class="powerby">Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>, Deploy by Actions<br>主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.13.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计</section></footer><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="关闭"></button>
<button class="pswp__button pswp__button--fs" title="全屏"></button>
<button class="pswp__button pswp__button--zoom" title="缩放"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="上一张"></button>
<button class="pswp__button pswp__button--arrow--right" title="下一张"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js" integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin="anonymous" defer=""></script><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin="anonymous" defer=""></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css" crossorigin="anonymous"></main><aside class="sidebar sticky right-sidebar"><section class="archives widget"><div class="widget-icon"><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><line x1="5" y1="9" x2="19" y2="9"></line><line x1="5" y1="15" x2="19" y2="15"></line><line x1="11" y1="4" x2="7" y2="20"></line><line x1="17" y1="4" x2="13" y2="20"></line></svg></div><h2 class="section-title widget-title">目录</h2><div class="widget--toc"><nav id="TableOfContents"><ol><li><a href="#操作符">操作符</a></li><li><a href="#observable">Observable</a></li><li><a href="#冷与热">“冷”与“热”</a></li><li><a href="#switchmapmergemapexhaustmapconcatmap">switchMap、mergeMap、exhaustMap、concatMap</a></li><li><a href="#forkjoin-与-combinelatest">forkJoin 与 combineLatest</a></li><li><a href="#filter-与-takewhile">filter 与 takeWhile</a></li><li><a href="#first-与-take1">first 与 take(1)</a></li><li><a href="#参考">参考</a></li></ol></nav></div></section></aside></div><script src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js" integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin="anonymous"></script><script type="text/javascript" src="/ts/main.js" defer=""></script><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><script>NProgress.configure({showSpinner:!1}),NProgress.start(),document.addEventListener("readystatechange",()=>{document.readyState==="interactive"&&NProgress.inc(.8),document.readyState==="complete"&&NProgress.done()})</script></body></html>