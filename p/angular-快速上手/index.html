<!DOCTYPE html><html lang="zh-cn" dir="ltr"><head><meta charset="utf-8"><style>:where(img[jampack-sized]){max-width:100%;height:auto}</style><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="组件 在 Angular 中，组件是用来定义视图的，一个应用至少有一个根组件（属于根模块的一部分）；组件由三部分组成：组件类（控制组件模板渲染）、组件模板、组件样式（默认仅对当前组件生效，不会污染全局）；可以使用 ng generate 命令或 编辑器扩展 快速新建组件（服务、管道…）：
"><title>Angular 快速上手 · I AM BEA, I DRINK TEA</title>
<link rel="canonical" href="https://ElementRef.github.io/p/angular-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"><link rel="stylesheet" href="/scss/style.min.49a542c0449d2ab7de17e0bb72f035d22a011f1361d304a0ff6dc68951166f07.css"><meta property="og:title" content="Angular 快速上手"><meta property="og:description" content="组件 在 Angular 中，组件是用来定义视图的，一个应用至少有一个根组件（属于根模块的一部分）；组件由三部分组成：组件类（控制组件模板渲染）、组件模板、组件样式（默认仅对当前组件生效，不会污染全局）；可以使用 ng generate 命令或 编辑器扩展 快速新建组件（服务、管道…）：
"><meta property="og:url" content="https://ElementRef.github.io/p/angular-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"><meta property="og:site_name" content="馬腊咯稽"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2022-03-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-16T00:00:00+00:00"><meta property="og:image" content="https://ElementRef.github.io/img/cover/angular.png"><meta property="og:logo" content="/og-logo.png"><meta name="twitter:title" content="Angular 快速上手"><meta name="twitter:description" content="组件 在 Angular 中，组件是用来定义视图的，一个应用至少有一个根组件（属于根模块的一部分）；组件由三部分组成：组件类（控制组件模板渲染）、组件模板、组件样式（默认仅对当前组件生效，不会污染全局）；可以使用 ng generate 命令或 编辑器扩展 快速新建组件（服务、管道…）：
"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://ElementRef.github.io/img/cover/angular.png"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><meta name="robots" content="noarchive, noindex, nofollow"><meta name="theme-color" content="#ffffff"><script defer="" src="https://umami.pavilion0321907.workers.dev/elementref.js" data-website-id="87868be0-a9cf-4f8c-8fee-e3cbb99e6cf2"></script></head><body class="article-page"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="flex container extended main-container on-phone--column"><aside class="sidebar sticky left-sidebar"><button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
<span class="hamburger-box"><span class="hamburger-inner"></span></span></button><header><figure class="site-avatar"><a href="/"><img src="/img/avatar_hu15751654176150258532.webp" width="300" height="404" class="site-logo" alt="Avatar" fetchpriority="high" decoding="async"></a></figure><div class="site-meta"><h1 class="site-name"><a href="/">馬腊咯稽</a></h1><h2 class="site-description">I AM BEA, I DRINK TEA</h2></div></header><ol class="social-menu"><li><a href="https://douban.com/people/nicknoonan" target="_blank" title="DouBan"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-douban"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M4 20h16"></path><path d="M5 4h14"></path><path d="M8 8h8a2 2 0 012 2v2a2 2 0 01-2 2H8a2 2 0 01-2-2v-2a2 2 0 012-2z"></path><path d="M16 14l-2 6"></path><path d="M8 17l1 3"></path></svg></a></li><li><a href="https://x.com/SpiciComic" target="_blank" title="Twitter"><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"></path></svg></a></li><li><a href="https://github.com/ElementRef" target="_blank" title="GitHub"><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"></path></svg></a></li><li><a href="https://m.weibo.cn/u/6447635754" target="_blank" title="Weibo"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-weibo"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M19 14.127C19 17.2 15.498 20 11 20c-4.126.0-8-2.224-8-5.565.0-1.78.984-3.737 2.7-5.567 2.362-2.51 5.193-3.687 6.551-2.238.415.44.752 1.39.749 2.062 2-1.615 4.308.387 3.5 2.693 1.26.557 2.5.538 2.5 2.742z"></path><path d="M15 4h1a5 5 0 015 5v1"></path></svg></a></li><li><a href="https://last.fm/zh/user/SpiciComic/listening-report" target="_blank" title="Last.fm"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-lastfm"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M20 8c-.83-1-1.388-1-2-1-.612.0-2 .271-2 2s1.384 2.233 3 3 2.125 1.812 2 3-1 2-3 2-3-1-3.5-2-1.585-4.78-2.497-6a5 5 0 10-1 7"></path></svg></a></li></ol><ol class="menu" id="main-menu"><li><a href="/"><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><polyline points="5 12 3 12 12 3 21 12 19 12"></polyline><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"></path></svg>
<span>首页</span></a></li><li><a href="/archives/"><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><rect x="3" y="4" width="18" height="4" rx="2"></rect><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"></path><line x1="10" y1="12" x2="14" y2="12"></line></svg>
<span>归档</span></a></li><li><a href="/search/"><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="10" cy="10" r="7"></circle><line x1="21" y1="21" x2="15" y2="15"></line></svg>
<span>搜索</span></a></li><li><a href="/%E5%90%AF%E5%8F%91/"><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"></path><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"></path></svg>
<span>启发</span></a></li><li><a href="/%E5%91%BD%E4%BB%A4/"><svg class="icon icon-tabler icon-tabler-terminal" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 7l5 5-5 5"></path><line x1="12" y1="19" x2="19" y2="19"></line></svg>
<span>命令</span></a></li><li><a href="/%E5%85%B3%E4%BA%8E/"><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"></path></svg>
<span>关于</span></a></li><div class="menu-bottom-section"><li id="dark-mode-toggle"><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="8" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="16" cy="12" r="2"></circle><rect x="2" y="6" width="20" height="12" rx="6"></rect></svg>
<span>深色</span></li></div></ol></aside><main class="full-width main"><article class="has-image main-article"><header class="article-header"><div class="article-image"><a href="/p/angular-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"><img src="/img/cover/angular.png" alt="Angular 快速上手" fetchpriority="high" decoding="async" width="1200" height="720" jampack-sized="true"></a></div><div class="article-details"><header class="article-category"><a href="/categories/angular/">Angular</a></header><div class="article-title-wrapper"><h2 class="article-title"><a href="/p/angular-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/">Angular 快速上手</a></h2></div><footer class="article-time"><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"></path><circle cx="18" cy="18" r="4"></circle><path d="M15 3v4"></path><path d="M7 3v4"></path><path d="M3 11h16"></path><path d="M18 16.496V18l1 1"></path></svg>
<time class="article-time--published">Mar 16, 2022</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
<time class="article-time--reading">阅读时长：31 分钟</time></div></footer></div></header><section class="article-content"><h2 id="组件">组件</h2><p>在 Angular 中，组件是用来定义视图的，一个应用至少有一个根组件（属于根模块的一部分）；组件由三部分组成：组件类（控制组件模板渲染）、组件模板、组件样式（默认仅对当前组件生效，不会污染全局）；可以使用 ng generate 命令或<a class="link" href="https://marketplace.visualstudio.com/items?itemName=alexiv.vscode-angular2-files" target="_blank" rel="noopener">
编辑器扩展
</a>快速新建组件（服务、管道…）：</p><ol><li>组件模板，语法和 HTML 几乎相同，多了一些 Angular 独有的指令和标签；</li><li>组件样式，作用域仅限于当前组件（可以通过“样式封装策略 encapsulation”进行更改）；</li><li>组件类，就是普通的 class；组件类中声明的属性和方法会自动注入组件模板中。</li></ol><p>组件的父子关系是通过“组件的视图对象”间接建立的；每个组件都有一个宿主视图和一些内建视图。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">slideMotion</span> <span class="o">=</span> <span class="nx">trigger</span><span class="p">(</span><span class="s1">'slideMotion'</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 创建一组有名字的 CSS 样式，它会在成功转换到指定的状态时应用到元素上
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">state</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'void'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 定义一个或多个要用于动画中的 CSS 样式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">style</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">opacity</span>: <span class="kt">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">transform</span><span class="o">:</span> <span class="s1">'scaleY(0.8)'</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">state</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'enter'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">style</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">opacity</span>: <span class="kt">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">transform</span><span class="o">:</span> <span class="s1">'scaleY(1)'</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 定义两个命名状态之间的动画序列
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">transition</span><span class="p">(</span><span class="s1">'void =&gt; *'</span><span class="p">,</span> <span class="p">[</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'0.2s cubic-bezier(0.7, 0.3, 0.1, 1)'</span><span class="p">)]),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">transition</span><span class="p">(</span><span class="s1">'* =&gt; void'</span><span class="p">,</span> <span class="p">[</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'0.2s cubic-bezier(0.86, 0, 0.07, 1)'</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 组件类需要由 @Component 装饰器进行修饰
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 装饰器就是一个函数，类会被作为参数传入
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 可以方便的对类内部的属性/方法进行修改
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 动画相关元数据，用来放置“定义动画的触发器”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">animations</span><span class="o">:</span> <span class="p">[</span><span class="nx">slideMotion</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 变更检测策略：
</span></span></span><span class="line"><span class="cl"><span class="cm">   *  1. ChangeDetectionStrategy.Default：异步逻辑结束（事件、请求等等），NgZone 会自上而下对整个组件树做变更检测
</span></span></span><span class="line"><span class="cl"><span class="cm">   *  2. ChangeDetectionStrategy.OnPush：用来跳过某些变更检测（因为不是每个操作都需要进行变更检测）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 在 OnPush 策略下，有四种情况仍旧可以触发变更检测：
</span></span></span><span class="line"><span class="cl"><span class="cm">   *  1. 组件 @Input 引用变化（这种情况下，搭配 Immutable.js 使用更佳）
</span></span></span><span class="line"><span class="cl"><span class="cm">   *  2. 组件及其子组件的 DOM 事件触发（计时器、异步请求、Promise 均不会触发检测）
</span></span></span><span class="line"><span class="cl"><span class="cm">   *  3. 组件内 Observable 订阅事件，同时设置 AsyncPipe
</span></span></span><span class="line"><span class="cl"><span class="cm">   *  4. 手动调用：
</span></span></span><span class="line"><span class="cl"><span class="cm">   *       ChangeDetectorRef.detectChanges()，立即触发组件的变更检测
</span></span></span><span class="line"><span class="cl"><span class="cm">   *       ChangeDetectorRef.markForCheck()，等待应用的下一轮变更检测
</span></span></span><span class="line"><span class="cl"><span class="cm">   *       ApplicationRef.tick()，触发整个应用的变更检测
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">changeDetection</span>: <span class="kt">ChangeDetectionStrategy.Default</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 样式封装策略：
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 1. ViewEncapsulation.ShadowDom，样式仅添加到 ShadowDOM 宿主中，基于 ShadowDOM 实现组件样式的封装与隔离；
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 2. ViewEncapsulation.Emulated，默认策略，样式会被添加到 &lt;head&gt; 中，基于 CSS 属性选择器来实现组件样式的封装与隔离；
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 3. ViewEncapsulation.None，样式会被添加到 &lt;head&gt; 中，不对样式进行封装与隔离，样式作用于全局（document）。
</span></span></span><span class="line"><span class="cl"><span class="cm">   * ViewEncapsulation.ShadowDom 不是默认策略的原因是“并不是每个浏览器都支持 ShadowDOM”
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">encapsulation</span>: <span class="kt">ViewEncapsulation.Emulated</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 放置一些「被动态调用」的组件，这些组件没有“直接”在模板中使用，Ng 是不知道是否应该对这些组件进行编译的
</span></span></span><span class="line"><span class="cl"><span class="cm">   * entryComponents 引入的组件会通过 ViewContainerRef.createComponent 方法被动态调用
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 编译器会将这些组件编译并为他们创建“工厂函数”
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 比如，一些在 Modal 中展示的组件
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entryComponents</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 改写默认的插值表达式起止分界符，在和第三方库冲突的时候才会修改
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">interpolation</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 仅在 CommonJS 规范下有意义，用于解析组件模板和样式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">moduleId</span><span class="o">:</span> <span class="s1">''</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 是否从编译后的模板中移除多余的空白字符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">preserveWhitespaces</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 组件“在模版中”只能以 &lt;app-example&gt;&lt;/app-example&gt; 的方式进行调用
</span></span></span><span class="line"><span class="cl"><span class="cm">   * selector 决定了组件在模版中的调用方式
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 当 Angular 在模版中找到相应的标签时
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 就把该组件实例化在那里
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'app-example'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 组件“在模版中”只能以 &lt;xxx [app-example]&gt;&lt;/xxx&gt; 的方式进行调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'[app-example]'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 内部样式字符串
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">styles</span><span class="o">:</span> <span class="s1">'div{...} div&gt;p{...}'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 外部样式路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">'./app.component.scss'</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 内部模板字符串
</span></span></span><span class="line"><span class="cl"><span class="cm">   * template 和 templateUrl 不能同时存在
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="s1">'&lt;div&gt;&lt;p&gt;...&lt;/p&gt;&lt;/div&gt;'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 外部模板路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">'./app.component.html'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// viewProviders 注册的 provider 只对 viewChildren 可见，对 contentChildren 不可见
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">viewProviders</span><span class="o">:</span> <span class="p">[</span><span class="nx">BbService</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * providers 注册的 provider 对 contentChildren 和 viewChildren 均可见
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 如果你愿意的话，可以总是使用 providers 而忽略 viewProviders
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">providers</span><span class="o">:</span> <span class="p">[</span><span class="nx">AaService</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">ExampleComponent</span>
</span></span><span class="line"><span class="cl">  <span class="kr">implements</span>
</span></span><span class="line"><span class="cl">    <span class="nx">OnChanges</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">DoCheck</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">OnDestroy</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">OnInit</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">AfterContentInit</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">AfterContentChecked</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">AfterViewInit</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">AfterViewChecked</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 使用 @Input 修饰组件要从外部接受的属性
</span></span></span><span class="line"><span class="cl"><span class="cm">   * &lt;app-example [propOne]="someValue"&gt;&lt;/app-example&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Input</span><span class="p">()</span> <span class="nx">propOne</span> <span class="o">=</span> <span class="s1">'defaultPropOneValue'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 可以给 propTwo 起一个别名（风格指南并不推荐）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * &lt;app-example [prop-two]="someValue"&gt;&lt;/app-example&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 在组件内部，仍可以用 this.propTwo 访问接受到的属性值
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Input</span><span class="p">(</span><span class="s1">'prop-two'</span><span class="p">)</span> <span class="nx">propTwo</span> <span class="o">=</span> <span class="s1">'defaultPropTwoValue'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 可以把 propThree 写成 getter/setter
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 来“监听”外部的值的变化
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Input</span><span class="p">(</span><span class="s1">'prop-three'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">get</span> <span class="nx">propThree() {</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">set</span> <span class="nx">propThree</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 可以执行一些别的逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">temp</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 使用 @Output 修饰组件上绑定的自定义事件
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 通过 this.updatePropOne.emit(newValue) 向外传值（$event 会接收到 newValue）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * &lt;app-example (updatePropOneAlias)="handleXXX($event)"&gt;&lt;/app-example&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">   * EventEmitter 继承了 RxJS 中的 Subject
</span></span></span><span class="line"><span class="cl"><span class="cm">   * export declare interface EventEmitter&lt;T&gt; extends Subject&lt;T&gt; {...}
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 在“Service”中不能使用 EventEmitter，可以使用 Subject 代替
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Output</span><span class="p">(</span><span class="s1">'updatePropOneAlias'</span><span class="p">)</span> <span class="nx">updatePropOne</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * Angular 不会接管构造函数
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 在构建组件树的时候会被调用
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 此时，还不能访问组件 DOM（ngOnInit 可以访问 DOM）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 组件初始化需要在生命周期函数中进行
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 这里仅仅用来注入一些组件需要依赖的服务
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 「依赖注入」机制会分析构造函数的「形参」
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 调用时，已经处理好根/父级 injectors 了
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 在 class 实例化的过程中，会向上查找 providers
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 并将查找的结果传递回构造函数，在构造完成之后才会设置指令的数据绑定输入属性
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * constructor 是在 injector 上下文中调用的唯一方法
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Angular 的 DI 系统会自动帮我们实例化注入的 Service
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 并将服务实例绑定到当前实例上（也就是 this）
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 方便我们以 this.xxService 的方式调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">aaService</span>: <span class="kt">AaService</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">bbService</span>: <span class="kt">BbService</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">ccService</span>: <span class="kt">CcService</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * Angular 的运行机制分为两部分：
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 1. 构建组件树；（调用 contructor）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 2. 执行脏检查。（调用生命周期函数）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 生命周期钩子（属于变更检测的一部分，起始于组件实例化，结束于组件实例的销毁）的执行顺序：
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 1. ngOnChanges（可能执行多次，需注意逻辑精简，仅在有 @Input 属性的情况下才执行）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 2. ngOnInit
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 3. ngDoCheck（可能执行多次，需注意逻辑精简）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 4. ngAfterContentInit
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 5. ngAfterContentChecked（可能执行多次，需注意逻辑精简）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 6. ngAfterViewInit（仅存在组件，不能用于指令）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 7. ngAfterViewChecked（可能执行多次，需注意逻辑精简；仅存在组件，不能用于指令）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 8. ngOnDestroy
</span></span></span><span class="line"><span class="cl"><span class="cm">   * Compiler 会检查组件的钩子函数，给组件赋予不同的 NodeFlags
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 在“脏检查”阶段，Angular 会根据组件的 NodeFlags 来调用对应的“钩子”
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnChanges</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// changes 仅包含了每个「发生变化」的属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">changes</span>: <span class="kt">SimpleChanges</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 1. 如果组件绑定过输入属性，所绑定的一个或多个输入属性的值发生变化时都会调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 2. 如果绑定的是一个对象，如果对象的引用没变，ngOnChanges 就不会执行
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 3. 如果你的组件「没有输入属性」，框架就「不会调用该方法」
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 4. 在 ngOnInit 之前调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">propName</span> <span class="k">in</span> <span class="nx">changes</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="p">{</span> <span class="nx">currentValue</span><span class="p">,</span> <span class="nx">previousValue</span><span class="p">,</span> <span class="nx">firstChange</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">changes</span><span class="p">[</span><span class="nx">propName</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="sb">`current: </span><span class="si">${</span><span class="nx">currentValue</span><span class="si">}</span><span class="sb">, previous: </span><span class="si">${</span><span class="nx">previousValue</span><span class="si">}</span><span class="sb">, isFirstChange: </span><span class="si">${</span><span class="nx">firstChange</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="s1">'propThree'</span> <span class="k">in</span> <span class="nx">changes</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 除了 getter/setter，也可以酱紫“监听”变化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 在 ngOnChanges 第一次完成调用之后执行（即使没有绑定任何输入属性）
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 用来执行复杂的在构造函数之外的组件初始化逻辑
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 获取初始数据的好地方
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">queryParams</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">params</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 每当路由的查询参数变化，都重新获取数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">fetchData</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngDoCheck</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 用于检测 Angular 无法捕获的变更
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 紧跟在每次执行变更检测时的 ngOnChanges 和首次执行变更检测时的 ngOnInit 后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngAfterContentInit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 当 Angular 把外部内容投影进组件视图或指令所在的视图之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ngDoCheck 首次调用之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 仅仅调用一次
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngAfterContentChecked</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 每当 Angular 把外部内容投影进组件视图或指令所在的视图之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ngAfterContentInit 每次调用之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ngDoCheck 每次调用之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngAfterViewInit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 当 Angular 初始化完组件视图及其子视图或包含该指令的视图之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ngAfterContentChecked 首次调用之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 仅仅调用一次
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngAfterViewChecked</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 每当 Angular 做完组件视图和子视图或包含该指令的视图的变更检测之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ngAfterContentChecked 每次调用之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ngAfterViewInit 每次调用之后调用
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnDestroy</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 每当指令/组件销毁之前立即调用，用于释放不会被垃圾回收的资源：
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 1. 反注册在应用服务中注册的回调
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 2. 取消订阅可观察对象
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 3. 移除事件绑定
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 4. 清除计时器
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="指令没有模版的特殊组件">指令（没有“模版”的特殊组件）</h2><p>指令用来将自定义行为附加到 DOM 中：</p><ol><li>结构性指令：通过添加、移除、替换 DOM 来修改布局，例如：*ngIf、*ngFor、*ngSwitch、*ngSwitchDefault、*ngComponentOutlet、*ngTemplateOutlet；</li><li>属性型指令：改变已有元素的外观或行为，例如：ngClass、ngStyle、ngModel、ngNonBindable、ngPreserveWhitespaces；</li><li>Angular 没有提供 AngularJS 中的 ng-show 指令。</li></ol><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Directive</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * &lt;div [app-example] #exampleRef="example"&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 可以通过 exampleRef 获取到“当前指令的引用”
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">exportAs</span><span class="o">:</span> <span class="s1">'example'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 将类的属性映射到宿主元素的绑定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">host</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 当宿主元素（绑定的元素）上的 click 事件被触发时
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 调用当前指令内的 onClick 方法
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'(click)'</span><span class="o">:</span> <span class="s1">'onClick()'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 宿主元素的 class 被设置为 class-name-example（this.innerClass 的值）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">'[class]'</span><span class="o">:</span> <span class="s1">'innerClass'</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 可以替代 @Input 装饰器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">inputs</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 可以替代 @Output 装饰器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">outputs</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 指令代码会被 AOT（ahead-of-time）编译器忽略
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 也就是说相关代码不会被预编译（打包的时候编译）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 而是保留到运行时进行动态编译
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">jit</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 依赖注入，详见“组件”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">providers</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 用来标记在哪些元素/组件上使用指令
</span></span></span><span class="line"><span class="cl"><span class="cm">   * &lt;div [app-example]&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'[app-example]'</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">ExampleDirective</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 也可以通过 @HostBinding 向宿主元素“绑定属性”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">@HostBinding</span><span class="p">(</span><span class="s1">'class'</span><span class="p">)</span> <span class="kr">class</span> <span class="o">=</span> <span class="s1">'class-name'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 也可以通过 @HostListener 向宿主元素“绑定事件”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">@HostListener</span><span class="p">(</span><span class="s1">'input'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$event'</span><span class="p">])</span> <span class="nx">onInput</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="nx">el</span>: <span class="kt">ElementRef</span><span class="p">,</span> <span class="nx">render2</span>: <span class="kt">Renderer2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 通过 ElementRef 可以拿到“宿主元素”的引用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">el</span><span class="p">.</span><span class="nx">nativeElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">'red'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">innerClass</span>: <span class="kt">string</span> <span class="o">=</span> <span class="s1">'class-name-example'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">onClick() {</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'宿主元素上触发了 click 事件'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 借助于 Renderer2 可以修改 Angular 的默认渲染行为
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">render2</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">nativeElement</span><span class="p">,</span> <span class="s1">'color'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>结构型指令的实现需要借助辅助类 TemplateRef 和 ViewContainerRef：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// 一个“延迟渲染”的例子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">@Directive</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'[delayRender]'</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">DelayRender</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">viewContainerRef</span>: <span class="kt">ViewContainerRef</span><span class="p">,</span> <span class="c1">// 对容器 View 的引用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">private</span> <span class="nx">templateRef</span>: <span class="kt">TemplateRef</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;</span> <span class="c1">// 对 ng-template 的引用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Input</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="kr">set</span> <span class="nx">delayRender</span><span class="p">(</span><span class="nx">timer</span>: <span class="kt">number</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">viewContainerRef</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">viewContainerRef</span><span class="p">.</span><span class="nx">createEmbeddedView</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">templateRef</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="nx">timer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="管道">管道</h2><p>Angular 内置了 async（从 Promise/Observable 中取值）、date、currency、json（JSON2String）、uppercase、lowercase、titlecase、precent 等管道。</p><p>无论是用法还是效果都和 Vue 3.0 中已经删除的 filter 很像，用于数据转换。</p><p>有一点需要注意：管道操作符的优先级<strong>高于</strong>逻辑运算符。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">DomSanitizerType</span> <span class="o">=</span> <span class="s1">'html'</span> <span class="o">|</span> <span class="s1">'style'</span> <span class="o">|</span> <span class="s1">'js'</span> <span class="o">|</span> <span class="s1">'url'</span> <span class="o">|</span> <span class="s1">'resourceUrl'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">NzSafeAny</span> <span class="o">=</span> <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Pipe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">'sanitizer'</span><span class="p">,</span> <span class="c1">// 管道名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 是否为“纯”管道：
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 1. “纯”管道只有在原始数据/对象的"引用变更"时才会执行；
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 2. “纯”管道会"忽略引用类型内部属性"的变化（引用没变）；
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 3. “纯”管道内部的的 transform 方法必须为“纯”函数；
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 4. “非纯”管道性能较差（任何交互行为都会触发执行）。
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">pure</span>: <span class="kt">true</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">SanitizerPipe</span> <span class="kr">implements</span> <span class="nx">PipeTransform</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 实现一个“管道”，需要 implements PipeTransform 并实现 transform 方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">constructor</span><span class="p">(</span><span class="kr">protected</span> <span class="nx">sanitizer</span>: <span class="kt">DomSanitizer</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">transform</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">NzSafeAny</span><span class="p">,</span> <span class="kr">type</span><span class="o">:</span> <span class="s1">'html'</span><span class="p">)</span><span class="o">:</span> <span class="nx">SafeHtml</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">transform</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">NzSafeAny</span><span class="p">,</span> <span class="kr">type</span><span class="o">:</span> <span class="s1">'style'</span><span class="p">)</span><span class="o">:</span> <span class="nx">SafeStyle</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">transform</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">NzSafeAny</span><span class="p">,</span> <span class="kr">type</span><span class="o">:</span> <span class="s1">'js'</span><span class="p">)</span><span class="o">:</span> <span class="nx">SafeScript</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">transform</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">NzSafeAny</span><span class="p">,</span> <span class="kr">type</span><span class="o">:</span> <span class="s1">'url'</span><span class="p">)</span><span class="o">:</span> <span class="nx">SafeUrl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">transform</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">NzSafeAny</span><span class="p">,</span> <span class="kr">type</span><span class="o">:</span> <span class="s1">'resourceUrl'</span><span class="p">)</span><span class="o">:</span> <span class="nx">SafeResourceUrl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">transform</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span>: <span class="kt">NzSafeAny</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kr">type</span><span class="o">:</span> <span class="nx">DomSanitizerType</span> <span class="o">=</span> <span class="s1">'html'</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span><span class="o">:</span> <span class="nx">SafeHtml</span> <span class="o">|</span> <span class="nx">SafeStyle</span> <span class="o">|</span> <span class="nx">SafeScript</span> <span class="o">|</span> <span class="nx">SafeUrl</span> <span class="o">|</span> <span class="nx">SafeResourceUrl</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="p">(</span><span class="kr">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">'html'</span><span class="o">:</span> <span class="c1">// 绕过安全检查，并信任给定的值是一个安全的 HTML
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sanitizer</span><span class="p">.</span><span class="nx">bypassSecurityTrustHtml</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">'style'</span><span class="o">:</span> <span class="c1">// 绕过安全检查，并信任给定的值是一个安全的 CSS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sanitizer</span><span class="p">.</span><span class="nx">bypassSecurityTrustStyle</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">'js'</span><span class="o">:</span> <span class="c1">// 绕过安全检查，并信任给定的值是一个安全的 JS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sanitizer</span><span class="p">.</span><span class="nx">bypassSecurityTrustScript</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">'url'</span><span class="o">:</span> <span class="c1">// 绕过安全检查，并信任给定的值是一个安全的样式 URL（可以安全的用在 &lt;img src&gt; 中）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sanitizer</span><span class="p">.</span><span class="nx">bypassSecurityTrustUrl</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">'resourceUrl'</span><span class="o">:</span> <span class="c1">// 绕过安全检查，并信任给定的值是一个安全的资源 URL（可以安全的用在 &lt;script src&gt;、&lt;iframe src&gt; 中）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sanitizer</span><span class="p">.</span><span class="nx">bypassSecurityTrustResourceUrl</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`指定的安全类型无效`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>通常我们会在 ngOnInit 中的进行数据请求：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">TicketListComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span>: <span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">id</span>: <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">title</span>: <span class="kt">srting</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">route</span>: <span class="kt">ActivatedRoute</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">apiService</span>: <span class="kt">ApiService</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">apiService</span><span class="p">.</span><span class="nx">fetchTickets1</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">list</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">list</span> <span class="o">||</span> <span class="p">[]));</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 或者
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">queryParams</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">params</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">apiService</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">fetchTickets2</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">list</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">list</span> <span class="o">||</span> <span class="p">[]));</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>AsyncPipe 可以替代 ngOnInit 完成这部分逻辑：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">Seller</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span>: <span class="kt">srting</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">Ticket</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">title</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;p&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;span&gt;{{ (firstSeller$ | async).name }}&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    // 借助 as 将其重命名为 list
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;ul *ngIf="tickets$ | async as list"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;li *ngFor="let item of list"&gt;{{ item.title | emptyValue }}&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">SellerComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 借助 pipe + map 对数据进行处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">readonly</span> <span class="nx">firstSeller$</span>: <span class="kt">Seller</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">apiService</span><span class="p">.</span><span class="nx">fetchSellers</span><span class="p">().</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">map</span><span class="p">(</span><span class="nx">list</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 借助 switchMap 切换数据流
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">readonly</span> <span class="nx">tickets$</span>: <span class="kt">Ticket</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">queryParams</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">switchMap</span><span class="p">(</span><span class="nx">params</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">apiService</span><span class="p">.</span><span class="nx">fetchTickets</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">route</span>: <span class="kt">ActivatedRoute</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">apiService</span>: <span class="kt">ApiService</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>如果不喜欢模版中出现太多 async，可以借助 combineLatest 将多个 Observable 合并：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;ng-container *ngIf="vm$ | async as vm"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;li *ngFor="let item of vm.boys"&gt;{{ item.name }}&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;li *ngFor="let item of vm.girls"&gt;{{ item.name }}&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;li *ngFor="let item of vm.dogs"&gt;{{ item.nickName }}&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;li *ngFor="let item of vm.cats"&gt;{{ item.nickName }}&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;/ng-container&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">BuyerComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">readonly</span> <span class="nx">vm$</span> <span class="o">=</span> <span class="nx">combineLatest</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">queryParams</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">switchMap</span><span class="p">(</span><span class="nx">params</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">apiService</span><span class="p">.</span><span class="nx">fetchBoys</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">queryParams</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">switchMap</span><span class="p">(</span><span class="nx">params</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">apiService</span><span class="p">.</span><span class="nx">fetchGirls</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">apiService</span><span class="p">.</span><span class="nx">fetchDogs</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">apiService</span><span class="p">.</span><span class="nx">fetchCats</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">]).</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">map</span><span class="p">(([</span><span class="nx">boys</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">girls</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">dogs</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">cats</span> <span class="o">=</span> <span class="p">[]])</span> <span class="o">=&gt;</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">boys</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">girls</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">dogs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">cats</span>
</span></span><span class="line"><span class="cl">    <span class="p">}))</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">route</span>: <span class="kt">ActivatedRoute</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">apiService</span>: <span class="kt">ApiService</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>自从 Angular 的编译和渲染引擎切换到 Ivy 之后：</p><ol><li>ChangeDetectionStrategy.Default 策略下，在每次“变更检测”的过程中，“纯”管道的 transform 方法，只有在入参发生变化的情况下才会被调用；</li><li>ChangeDetectionStrategy.Default 策略下，在每次“变更检测”的过程中，“非纯”管道的 transform 方法都会被调用；</li><li>当使用 async 管道时（它是“非纯”的），最好使用 ChangeDetectionStrategy.OnPush 策略；</li><li>无论是否是“纯”管道，每个管道都会有自己的实例（ViewEngine 时期，“纯”管道是共享实例的）；</li><li>在同一模版中，使用了两次 A 管道，则会有两个 A 管道的实例存在。</li></ol><h2 id="服务">服务</h2><p>服务是 Angular 的核心，他是专门用来处理某件事情的（数据请求、数据共享等）具有明确定义的 class；一般情况下，服务用来创建与视图无关但需要跨组件共享的数据/逻辑。</p><p>官方推崇“Component 处理页面展示，Service 处理内在逻辑”的原则（有点像 React 中的 UI 组件和逻辑组件）。</p><p>服务一般（具体看 providedIn 的取值）以单例的形式存在，实例化之后，应用于整个应用。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Injectable</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * providedIn 有四种取值：
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 1. platform：平台级别注入，所有应用共享一个服务单例（仅适用于在一个 window 下运行多个 Angular 应用，有点微前端的意思）；
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 2. root：应用程序（AppModule）/系统/全局/根级别注入，服务可以在整个应用中使用，而且共享同一个服务实例；
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 3. [NgModule]：仅注入指定的 NgModule 中，仅可在指定的 NgModule 中使用，有 TreeShaking 加成；
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 4. any：在每个注入的模块中，提供一个模块内的唯一的实例；
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 5. null：仅仅表明可注入。
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 这种方式要优于 @NgModule({providers: [xxx]})，因为可以被 TreeShaking
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">'root'</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">ApiPublicService</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 服务也可依赖别的服务，这里就依赖了 HttpClient
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">http</span>: <span class="kt">HttpClient</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">paginationData</span><span class="p">(</span><span class="nx">data</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">PaginationData</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">total</span>: <span class="kt">data.total</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pageSize</span>: <span class="kt">data.size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pageIndex</span>: <span class="kt">data.current</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">buildResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">temp</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">success</span>: <span class="kt">response.success</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">status</span>: <span class="kt">response.status</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">data</span>: <span class="kt">response.data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">raw</span>: <span class="kt">response</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">records</span>: <span class="kt">response?.data?.records</span> <span class="o">||</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">objects</span>: <span class="kt">response?.data</span> <span class="o">||</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">errorCode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">temp</span><span class="p">.</span><span class="nx">errorCode</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">errorCode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">errorMessage</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">temp</span><span class="p">.</span><span class="nx">errorMessage</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">errorMessage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="nx">toResponse() {</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">map</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">buildResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">tap</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">errorCode</span> <span class="o">===</span> <span class="s1">'LOGIN_INVALID'</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">public</span> <span class="nx">fetchList</span><span class="p">(</span><span class="nx">params</span>: <span class="kt">ApiParams</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">environment</span><span class="p">.</span><span class="nx">apiHost</span><span class="si">}</span><span class="sb">/api/v1/list`</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">params</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">toResponse</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">map</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="nx">paginationData</span>: <span class="kt">this.paginationData</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">records</span>: <span class="kt">response.data.records</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">pages</span>: <span class="kt">response.data.pages</span>
</span></span><span class="line"><span class="cl">        <span class="p">}))</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="模块">模块</h2><p>NgModule 是 Angular 的基本构造块（NgModule 和 ESModule 不同但互补），也是 Angular 对“依赖”进行组织的一种形式；其为组件提供了编译上下文；一个 Angular 应用由至少一个根模块（AppModule）和多个特性模块组成。</p><p>NgModule 可以将组件及其相关代码（服务等）关联，形成功能单元（一般是按照业务划分的）；模块之间即相互独立又可通过 imports/exports 建立联系；模块可以让代码更“内聚”。</p><p>一个 Angular 应用一般包含四种模块：</p><ul><li>根模块（引导模块），一个应用仅有一个根模块；</li><li>核心模块，为应用提供基础能力的模块，比如：路由模块、数据请求模块；</li><li>公共模块，包含了：公共组件、公共管道、公共指令；</li><li>业务模块，封装了具体业务的模块。</li></ul><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@NgModule</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 使用：platformBrowserDynamic().bootstrapModule(AppModule) 启动根模块
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 只有根模块（一个应用只有一个）才设置这个属性
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 表示该模块应用的主视图（一般是根组件）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 同时也表明这个模块是“根模块”
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 声明该模块（包含/定义）的组件、管道、指令
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 这些组件、管道、指令是当前模块“私有的”（如果没有放入 exports）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 一个组件/指令/管道只能属于一个模块，不能同时把一个类声明在几个模块中
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span><span class="nx">ExampleComponent</span><span class="p">,</span> <span class="nx">ExamplePipe</span><span class="p">,</span> <span class="nx">ExampleDirective</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 如果组件没有直接在模版中使用，AOT 就不会提前编译组件
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 如果将组件添加到 entryComponents
</span></span></span><span class="line"><span class="cl"><span class="cm">   * AOT 就会提前编译组件
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entryComponents</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 当前 NgModule 在 getNgModuleById 中的名字或唯一标识符
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 如果为 undefined，则该模块不会被注册到 getNgModuleById 中
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 用到的不多，官网也没做过多介绍，Angular 会自动帮我们处理
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">undefined</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 导入（当前模块运行需要依赖的的）其他模块：
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 1. 被导入模块的 exports（低优先级）会和当前模块的 declarations（高优先级）合并
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 2. 被导入模块的 providers 会和当前模块的 providers 合并
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 3. 被导入模块的路由会和当前模块的路由合并
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">BrowserModule</span><span class="p">,</span> <span class="nx">OneModule</span><span class="p">,</span> <span class="nx">TwoModule</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 暴露（可供其他模块使用的）当前模块中的一些组件、指令和管道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">exports</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 编译器选项，详见“指令”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">jit</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 当前模块需要的提供者（可注入对象，例如：ApiService）
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 如果 provider 在根模块注入，则注入的 provider 为单例模式
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">providers</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 当前 NgModule 中允许使用的声明元素的 HTML 架构
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 当遇到不认识的元素时，怎么做处理
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 用于测试代码，业务中用不上
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">schemas</span><span class="o">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">ExampleModule</span> <span class="p">{}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="表单">表单</h2><p>Angular 提供了两种不同的方法来通过表单处理用户输入：响应式表单和模板驱动表单。两者都从视图中捕获用户输入事件、验证用户输入、创建表单模型、修改数据模型，并提供跟踪这些更改的途径：</p><ul><li>响应式表单：提供对底层表单对象模型直接、显式的访问；可伸缩性、可扩展性、可复用性和可测试性都更高；视图和数据模型之间使用同步数据流；</li><li>模版驱动表单：依赖模板中的指令来创建和操作底层的对象模型，在扩展性方面不如响应式表单，专注于简单场景，视图和数据模型之间使用异步数据流。</li></ul><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 使用“响应式表单”，需要在 NgModule 中导入 ReactiveFormsModule 和 FormsModule：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ReactiveFormsModule：提供 formControl、ngFormGroup 等指令；
</span></span></span><span class="line"><span class="cl"><span class="cm"> * FormsModule：提供 ngForm、ngModel 等模版驱动指令。
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ngForm 的 selector 包含了 form:not([formGroup]) ；
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 所以，一般不用显式添加 ngForm 指令。
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">FormBuilder</span><span class="p">,</span> <span class="c1">// 提供一种更方便使用 FormGroup、FormArray 和 FormControl 的方式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">FormControl</span><span class="p">,</span> <span class="c1">// 保存了字段的值和状态（是否合法、是否修改、是否禁用等）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">FormGroup</span><span class="p">,</span> <span class="c1">// 用来创建和管理一组 FormControl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">Validators</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="kr">from</span> <span class="s1">'@angular/forms'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * submit 与 ngSubmit 的区别：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * submit 是 DOM 事件，ngSubmit 是 Angular 事件；
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 阻止默认行为需要在 submit 中进行；
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ngSubmit 比 submit 先触发；
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 两者的事件对象是一样的。
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'app-form'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;form [formGroup]="validateForm" (ngSubmit)="handleSubmit($event)"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;label for="name"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;span&gt;Name:&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;input id="name" name="name" type="text" formControlName="name" /&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;/label&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;label for="age"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;span&gt;Age:&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;input id="age" name="age" type="text" formControlName="age" /&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;/label&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;div formGroupName="address" alt="嵌套表单组"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;label for="street"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;span&gt;Street:&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;input
</span></span></span><span class="line"><span class="cl"><span class="sb">            id="street"
</span></span></span><span class="line"><span class="cl"><span class="sb">            name="street"
</span></span></span><span class="line"><span class="cl"><span class="sb">            type="text"
</span></span></span><span class="line"><span class="cl"><span class="sb">            formControlName="street"
</span></span></span><span class="line"><span class="cl"><span class="sb">          /&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;/label&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;label for="city"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;span&gt;City:&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;input id="city" name="city" type="text" formControlName="city" /&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;/label&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;label for="state"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;span&gt;State:&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;input id="state" name="state" type="text" formControlName="state" /&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;/label&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;button (click)="handleFormUpdate()"&gt;Update&lt;/button&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;button type="submit"&gt;Submit&lt;/button&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;/form&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">FormComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">validateForm</span>: <span class="kt">FormGroup</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">fb</span>: <span class="kt">FormBuilder</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 一般使用这种，并且对于“动态表单”，最好在初始化的时候就将所有表单属性列出
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 而不是根据条件来动态的 addControl/removeControl
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 因为那样，整个表单逻辑会非常不直观和零散
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">validateForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">age</span><span class="o">:</span> <span class="p">[</span><span class="s1">'18'</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">address</span>: <span class="kt">this.fb.group</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">street</span><span class="o">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">city</span><span class="o">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span><span class="o">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 很少使用这种
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">validateForm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormGroup</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span>: <span class="kt">new</span> <span class="nx">FormControl</span><span class="p">(</span><span class="s1">''</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">age</span>: <span class="kt">new</span> <span class="nx">FormControl</span><span class="p">(</span><span class="s1">'18'</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">address</span>: <span class="kt">new</span> <span class="nx">FormGroup</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">street</span>: <span class="kt">new</span> <span class="nx">FormControl</span><span class="p">(</span><span class="s1">''</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">city</span>: <span class="kt">new</span> <span class="nx">FormControl</span><span class="p">(</span><span class="s1">''</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span>: <span class="kt">new</span> <span class="nx">FormControl</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">       * 表单不仅可以是一个对象，而且可以是一个数组
</span></span></span><span class="line"><span class="cl"><span class="cm">       * 不过在表单验证的时候，可能需要类型断言
</span></span></span><span class="line"><span class="cl"><span class="cm">       */</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">exampleForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">formBuilder</span><span class="p">.</span><span class="nx">array</span><span class="p">([]);</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">       * 通过 push 向数组表单中添加表单项
</span></span></span><span class="line"><span class="cl"><span class="cm">       * 还有 insert、removeAt 等方法
</span></span></span><span class="line"><span class="cl"><span class="cm">       */</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">exampleForm</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">formBuilder</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="kr">type</span><span class="o">:</span> <span class="p">[</span><span class="s1">'SELF_EMPLOYED'</span><span class="p">,</span> <span class="p">[]],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">accountName</span><span class="o">:</span> <span class="p">[</span><span class="nx">accountName</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">accountNo</span><span class="o">:</span> <span class="p">[</span><span class="nx">accountNo</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">bankName</span><span class="o">:</span> <span class="p">[</span><span class="nx">bankName</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">bankBranchName</span><span class="o">:</span> <span class="p">[</span><span class="nx">bankBranchName</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">validateForm</span><span class="p">.</span><span class="nx">valueChanges</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">form</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 可以通过 valueChanges 来监听表单变化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleSetDefault() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 单个赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">validateForm</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">).</span><span class="nx">setValue</span><span class="p">(</span><span class="s1">'Bob'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">validateForm</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">'address'</span><span class="p">).</span><span class="kr">get</span><span class="p">(</span><span class="s1">'street'</span><span class="p">).</span><span class="nx">setValue</span><span class="p">(</span><span class="s1">'Gongshu'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 批量赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">validateForm</span><span class="p">.</span><span class="nx">patchValue</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">gender</span><span class="o">:</span> <span class="s1">'male'</span><span class="p">,</span> <span class="c1">// 不会抛出错误
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">age</span><span class="o">:</span> <span class="s1">'21'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">address</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">city</span><span class="o">:</span> <span class="s1">'Zhejiang'</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">validArray</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">valid</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">validateForm</span><span class="p">,</span> <span class="nx">validArray</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">validArray</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">validateForm</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 对于嵌套多层的表单，可以使用递归进行验证
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">valid</span><span class="p">(</span><span class="nx">form</span><span class="p">,</span> <span class="nx">temp</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">form</span> <span class="k">instanceof</span> <span class="nx">FormGroup</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">controls</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">control</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">valid</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">controls</span><span class="p">[</span><span class="nx">control</span><span class="p">],</span> <span class="nx">temp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">form</span> <span class="k">instanceof</span> <span class="nx">FormArray</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">form</span><span class="p">.</span><span class="nx">controls</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">control</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">valid</span><span class="p">(</span><span class="nx">control</span><span class="p">,</span> <span class="nx">temp</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">form</span> <span class="k">instanceof</span> <span class="nx">FormControl</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">form</span><span class="p">.</span><span class="nx">markAsDirty</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">form</span><span class="p">.</span><span class="nx">updateValueAndValidity</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">temp</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">valid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="路由">路由</h2><p>Router 是一个提供导航和操纵 URL 能力的 NgModule；通过将浏览器 URL 解释为更改视图的操作指令来启用导航：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">Route</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">canActivate?</span>: <span class="kt">any</span><span class="p">[];</span> <span class="c1">// 调用 canActivate 钩子来确定“是否激活匹配到的路由”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">canActivateChild?</span>: <span class="kt">any</span><span class="p">[];</span> <span class="c1">// 调用 canActivateChild 钩子来确定“路径参数的变化时，是否激活匹配到的子路由”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">canDeactivate?</span>: <span class="kt">any</span><span class="p">[];</span> <span class="c1">// 调用 canDeactivate 钩子来确定“是否允许离开当前路由”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">canLoad?</span>: <span class="kt">any</span><span class="p">[];</span> <span class="c1">// 调用 canLoad 钩子来确定“是否允许加载‘懒加载’的模块”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">children?</span>: <span class="kt">Route</span><span class="p">[];</span> <span class="c1">// 嵌套子路由配置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">component?</span>: <span class="kt">Type</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;;</span> <span class="c1">// 匹配之后，要实例化的组件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">data?</span>: <span class="kt">Data</span><span class="p">;</span> <span class="c1">// 携带的数据，可通过 ActivatedRoute 获取
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">loadChildren?</span>: <span class="kt">LoadChildren</span><span class="p">;</span> <span class="c1">// 懒加载模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">matcher?</span>: <span class="kt">UrlMatcher</span><span class="p">;</span> <span class="c1">// 自定义匹配算
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">outlet?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 当同级有多个 &lt;router-outlet name="xxx"/&gt; 时，指定从渲染出口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">path?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 匹配路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">pathMatch?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 路径匹配策略，prefix（默认）｜full
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">redirectTo?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 匹配之后，要重定向的路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">resolve?</span>: <span class="kt">ResolveData</span><span class="p">;</span> <span class="c1">// 与路由关联的解析数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">runGuardsAndResolvers?</span>: <span class="kt">RunGuardsAndResolvers</span><span class="p">;</span> <span class="c1">// 定义 Guards 和 Resolvers 的运行时机
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 路由配置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">routes</span>: <span class="kt">Route</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="s1">'/login'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">canActivate</span><span class="o">:</span> <span class="p">[</span><span class="nx">LoginGuard</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 懒加载只适用于“模块”，不适用于“组件”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">loadChildren</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="s1">'./login/login.module'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">m</span> <span class="o">=&gt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">LoginModule</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="s1">'**'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">component</span>: <span class="kt">NotFoundComponent</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kd">@NgModule</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// forRoot 表示“这是一个根路由模块”，在一个应用中只会使用一次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">routes</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">       * initialNavigation 取值：
</span></span></span><span class="line"><span class="cl"><span class="cm">       * enabled/enabledBlocking，引导程序被阻止，直到初始导航完成，一般 SSR 的时候才用得到
</span></span></span><span class="line"><span class="cl"><span class="cm">       * enabledNonBlocking，引导程序不会被阻塞
</span></span></span><span class="line"><span class="cl"><span class="cm">       * disabled，不执行初始导航
</span></span></span><span class="line"><span class="cl"><span class="cm">       */</span>
</span></span><span class="line"><span class="cl">      <span class="nx">initialNavigation</span><span class="o">:</span> <span class="s1">'enabledNonBlocking'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">anchorScrolling</span><span class="o">:</span> <span class="s1">'enabled'</span><span class="p">,</span> <span class="c1">// 当 URL 中有锚点时，是否滚动到锚点（'disabled'|'enabled'|'top'）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">enableTracing</span>: <span class="kt">false</span><span class="p">,</span> <span class="c1">// 为 true 时，Router 会将每次导航过程中触发的“路由生命周期”输出到控制台
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">onSameUrlNavigation</span><span class="o">:</span> <span class="s1">'ignore'</span><span class="p">,</span> <span class="c1">// 当导航到当前地址是的行为（'reload'|'ignore'）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">paramsInheritanceStrategy</span><span class="o">:</span> <span class="s1">'emptyOnly'</span><span class="p">,</span> <span class="c1">// 如何将参数、数据从父路由合并到子路由
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">preloadingStrategy</span><span class="o">:</span> <span class="s1">'NoPreloading'</span><span class="p">,</span> <span class="c1">// 预加载策略
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">scrollPositionRestoration</span><span class="o">:</span> <span class="s1">'enabled'</span><span class="p">,</span> <span class="c1">// 发生“导航回退”是否重置滚动位置（'disabled'|'enabled'|'top'）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">relativeLinkResolution</span><span class="o">:</span> <span class="s1">'legacy'</span><span class="p">,</span> <span class="c1">// 相对路径的导航策略
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">urlUpdateStrategy</span><span class="o">:</span> <span class="s1">'deferred'</span><span class="p">,</span> <span class="c1">// 浏览器地址栏的更新策略（默认在导航成功之后再更新）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">useHash</span>: <span class="kt">false</span><span class="p">,</span> <span class="c1">// 环境不支持 History API 时，可使用哈希导航
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">errorHandler</span>: <span class="kt">error</span> <span class="o">=&gt;</span> <span class="nx">error</span><span class="p">,</span> <span class="c1">// 自定义错误处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">scrollOffset</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1">// 路由导航后的滚动偏移量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">exports</span><span class="o">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppRoutingModule</span> <span class="p">{}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>路由钩子：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Injectable</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">'root'</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">LoginGuard</span> <span class="kr">implements</span> <span class="nx">CanActive</span><span class="p">,</span> <span class="nx">CanActiveChild</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">canActive</span><span class="p">(</span><span class="nx">route</span>: <span class="kt">ActivatedRouteSnapshot</span><span class="p">,</span> <span class="nx">state</span>: <span class="kt">RouterStateSnapshot</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">auth</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">authService</span><span class="p">.</span><span class="nx">currentAuth</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">authService</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">route</span><span class="p">.</span><span class="nx">url</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">'login'</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">'auth'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">'user'</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">auth</span> <span class="o">||</span> <span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>在组件中获取路由信息：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ActivatedRoute</span><span class="p">,</span> <span class="nx">NavigationEnd</span><span class="p">,</span> <span class="nx">Router</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'@angular/router'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'app-general'</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">GeneralComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">isExclusive</span>: <span class="kt">boolean</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">get</span> <span class="nx">currentQueryParams() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 可以通过 router 获取查询参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">parseUrl</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">{</span> <span class="nx">queryParams</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">parseUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">queryParams</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">route</span>: <span class="kt">ActivatedRoute</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">router</span>: <span class="kt">Router</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 在组件初始化的时候，订阅路由查询参数的变化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">queryParams</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">params</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">handleFetchData</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 订阅路由事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="k">instanceof</span> <span class="nx">NavigationEnd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">handleNavigationEnd</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleFetchData</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleNavigationEnd() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 在导航结束时
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span> <span class="nx">exclusive</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentQueryParams</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">isExclusive</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">exclusive</span><span class="p">)</span> <span class="o">===</span> <span class="s1">'true'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleSwitchUrl</span><span class="p">(</span><span class="nx">$event</span><span class="p">,</span> <span class="p">{</span> <span class="nx">exclusive</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">path</span> <span class="o">=</span> <span class="kc">null</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">temp</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">queryParams</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">queryParamsHandling</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">temp</span> <span class="o">=</span> <span class="p">[</span><span class="nx">path</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">exclusive</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">queryParams</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">exclusive</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 相对于当前路由进行导航并重置 URL 中的查询参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">temp</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">relativeTo</span>: <span class="kt">this.route</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">queryParams</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">queryParamsHandling</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="依赖注入">依赖注入</h2><p>依赖是指系统中的各个组成部分之间的相互关系；具体到 Angular，是指某个 class 执行其功能“所需的”服务（@Injectable）或对象。</p><p>在传统模式中，如果组件 A 依赖服务 B，A 会在内部创建一个 B 的实例；在依赖注入模式中，依赖项 B 会通过 A 的 constructor 注入（默认行为是 new 调用），保存在 A 的私有属性上。</p><p>当 class 需要某个依赖时，该依赖就会作为参数添加到 class 的构造函数中。当 Angular 实例化 class 时，DI 会在“注入器树”中查找（从局部开始，向上冒泡，直到 root）provider；如果没有找到 provider，会报错。</p><p>如果要保证外部注入的服务是自己（当前 class）独有的（<a class="link" href="https://angular.cn/guide/dependency-injection-in-action#multiple-service-instances-sandboxing" target="_blank" rel="noopener">
沙箱式隔离
</a>），只需在自己的元数据 providers 中列出 Service 即可（就能拥有自己独有的服务实例）。</p><p>如果“允许依赖缺失”或者需要“限制依赖查找范围”，可以使用修饰符更改默认的依赖查找机制：</p><ul><li>@Host 表示禁止在“请求该依赖的组件”以上查找依赖；</li><li>@Self 表示只在该组件的注入器中查找提供者，就是仅在 @Component({providers:[]}) 中查找，找不到就报错；</li><li>@SkipSelf 表示跳过局部注入器，向上查找，与 @Self 相反；</li><li>@Optional 表示找不到依赖就返回 null，即使找不到，也不报错。</li></ul><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 如果不需要“独有”服务实例，就不需要 providers
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 在每个 @Component({providers:[xxx]}) 中单独声明
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 每个 Component 就独享这个 Service 实例
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">providers</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">provide</span>: <span class="kt">AaService</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 为 DI 令牌（依赖的标识）关联一个“固定的值”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">useValue</span>: <span class="kt">123</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">provide</span>: <span class="kt">BbService</span><span class="p">,</span> <span class="c1">// DI 令牌
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">       * 为公共类/默认类换上一个“替代实现”
</span></span></span><span class="line"><span class="cl"><span class="cm">       * 令牌和注入内容不一定“同名”
</span></span></span><span class="line"><span class="cl"><span class="cm">       */</span>
</span></span><span class="line"><span class="cl">      <span class="nx">useClass</span>: <span class="kt">CcService</span> <span class="c1">// DI 内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">provide</span>: <span class="kt">AliasService</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">       * useExisting 的意思是，复用已经存在的实例，而不是重新创建一个私有实例
</span></span></span><span class="line"><span class="cl"><span class="cm">       * 为服务创建别名，提供了两种途径来访问同一服务对象
</span></span></span><span class="line"><span class="cl"><span class="cm">       * 也可以用来“收窄/简化”BbService
</span></span></span><span class="line"><span class="cl"><span class="cm">       */</span>
</span></span><span class="line"><span class="cl">      <span class="nx">useExisting</span>: <span class="kt">BbService</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">provide</span>: <span class="kt">Example</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 通过“工厂函数”来创建依赖实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">useFactory</span>: <span class="kt">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="k">new</span> <span class="nx">SignUp</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="nx">SignIn</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 用于指定“工厂函数”所使用的依赖
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">deps</span><span class="o">:</span> <span class="p">[</span><span class="nx">User</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">DdService</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">ExampleComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kd">@Inject</span><span class="p">(</span><span class="nx">AaService</span><span class="p">)</span> <span class="kr">private</span> <span class="nx">aa</span>: <span class="kt">any</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kd">@SkipSelf</span><span class="p">()</span> <span class="kr">private</span> <span class="nx">bb</span>: <span class="kt">BbService</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">eg</span>: <span class="kt">Example</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="双向绑定">双向绑定</h2><p>Angular 也有 Vue 中的 v-model 机制（modelValue/update:modelValue），语法为 [(value)]；实现思路同样也是基于“组件传值”和“自定义事件”（语法糖）。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'&lt;div&gt;&lt;app-input-model [(example)]="exampleValue"&gt;&lt;/app-input-model&gt;&lt;span&gt;{{ exampleValue }}&lt;/span&gt;&lt;/div&gt;'</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">FormComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">exampleValue</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'&lt;input type="text" [value]="example" (input)="handleInput($event)" /&gt;'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'app-input-model'</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">InputModelComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Input</span><span class="p">()</span> <span class="nx">example</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 事件名称必须和 @Input 属性相对应，为 xxxChange
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">@Output</span><span class="p">()</span> <span class="nx">exampleChange</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleInput</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 官方文档中，在这里直接对 example 进行了修改，我表示不理解
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">exampleChange</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="绑定语法">绑定语法</h2><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">my-component</span>
</span></span><span class="line"><span class="cl">  <span class="err">#</span><span class="na">component</span>
</span></span><span class="line"><span class="cl">  <span class="err">[@</span><span class="na">animation</span><span class="err">]="</span><span class="na">animation</span><span class="err">"</span>
</span></span><span class="line"><span class="cl">  <span class="err">[(</span><span class="na">banana</span><span class="err">)]="</span><span class="na">banana</span><span class="err">"</span>
</span></span><span class="line"><span class="cl">  <span class="err">[</span><span class="na">options</span><span class="err">]="</span><span class="na">options</span><span class="err">"</span>
</span></span><span class="line"><span class="cl">  <span class="err">(</span><span class="na">output</span><span class="err">)="</span><span class="na">onOutput</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span>
</span></span><span class="line"><span class="cl">  <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">onClick</span><span class="err">()"</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&lt;/</span><span class="nt">my-component</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- 如果你有强迫症的话，Ng 支持另一种模版语法 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">my-component</span>
</span></span><span class="line"><span class="cl">  <span class="na">ref-component</span>
</span></span><span class="line"><span class="cl">  <span class="na">bind-animate-animation</span><span class="o">=</span><span class="s">"animation"</span>
</span></span><span class="line"><span class="cl">  <span class="na">bind-on-banana</span><span class="o">=</span><span class="s">"banana"</span>
</span></span><span class="line"><span class="cl">  <span class="na">bind-options</span><span class="o">=</span><span class="s">"options"</span>
</span></span><span class="line"><span class="cl">  <span class="na">on-output</span><span class="o">=</span><span class="s">"onOutput($event)"</span>
</span></span><span class="line"><span class="cl">  <span class="na">on-click</span><span class="o">=</span><span class="s">"onClick()"</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&lt;/</span><span class="nt">my-component</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="模版变量">模版变量</h2><p>模版变量，顾名思义，就是存在于组件模版中的变量；模版变量可以引用：元素、指令、组件等：</p><ul><li>如果在组件上声明变量，该变量就会引用该组件实例；</li><li>如果在原生 HTML 标签上声明变量，该变量就会引用该元素；</li><li>如果你在 &lt;ng-template/&gt; 上声明变量，该变量就会引用一个 TemplateRef 实例；</li><li>如果该变量在右侧指定了一个名字（例如，#var=“ngModel”），该变量就会引用所在元素上具有这个 exportAs 名字的指令或组件。</li></ul><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- # 声明了一个模版变量 phone --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">input</span> <span class="err">#</span><span class="na">phone</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">"phone number"</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- button 通过模版变量获取到了 input 的 value --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">button</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">callPhone</span><span class="err">(</span><span class="na">phone</span><span class="err">.</span><span class="na">value</span><span class="err">)"</span><span class="p">&gt;</span>take a call<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- 模版输入变量 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">ng-template</span> <span class="err">#</span><span class="na">heroRef</span> <span class="na">let-hero</span> <span class="na">let-i</span><span class="o">=</span><span class="s">"index"</span> <span class="na">let-even</span><span class="o">=</span><span class="s">"!isOdd"</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">span</span> <span class="err">[</span><span class="na">class</span><span class="err">]="{</span> <span class="err">'</span><span class="na">even-row</span><span class="err">'</span><span class="na">:</span> <span class="na">even</span> <span class="err">}"</span><span class="p">&gt;</span>{{ i }}: {{ hero.name }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">ng-template</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>模版变量可以在“包含此模板变量”的模板中的任何地方引用它；既然使用模版变量的前提是“包含此模板变量”，那么决定模版边界的“结构型指令（例如，ngIf、ngFor）”也决定了模版变量的<strong>作用域</strong>。</p><h2 id="网络请求">网络请求</h2><p>要使用 HttpClient，需要在模块中导入 HttpClientModule；一般情况下，在 AppModule 导入：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserModule</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'@angular/platform-browser'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpClientModule</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'@angular/common/http'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@NgModule</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">providers</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * HTTP_INTERCEPTORS 是 InjectionToken 实例
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 可以作为各个依赖项的唯一标识，方便依赖项被查找
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 当然，唯一标识不一定要是 InjectionToken 实例
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 可以被“唯一识别”就好，比如，NZ_I18N
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="nx">provide</span>: <span class="kt">NZ_I18N</span><span class="p">,</span> <span class="nx">useValue</span>: <span class="kt">zh_CN</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 使用一个 InjectionToken 初始化多个 provider
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 酱紫就可以通过 @Inject(HTTP_INTERCEPTORS) 获取多个 provider
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 如果 multi: false，后边的 provide 会覆盖前边的 provider
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="nx">provide</span>: <span class="kt">HTTP_INTERCEPTORS</span><span class="p">,</span> <span class="nx">useClass</span>: <span class="kt">SpinInterceptor</span><span class="p">,</span> <span class="nx">multi</span>: <span class="kt">true</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="nx">provide</span>: <span class="kt">HTTP_INTERCEPTORS</span><span class="p">,</span> <span class="nx">useClass</span>: <span class="kt">ErrorInterceptor</span><span class="p">,</span> <span class="nx">multi</span>: <span class="kt">true</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">BrowserModule</span><span class="p">,</span> <span class="nx">HttpClientModule</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>发起 HTTP 请求：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">HttpClient</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">HttpErrorResponse</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">HttpHeaders</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">HttpParams</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="kr">from</span> <span class="s1">'@angular/common/http'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">catchError</span><span class="p">,</span> <span class="nx">retry</span><span class="p">,</span> <span class="nx">throwError</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'rxjs/operators'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Injectable</span><span class="p">({})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">ApiService</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * HttpClient 返回的 Observer 是“冷的”，不需要手动 unsubscribe
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 请求成功时，会在 responseObserver.next 调用之后，调用 responseObserver.complete
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 请求失败时，会调用 responseObserver.error
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">http</span>: <span class="kt">HttpClient</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 自定义请求头
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">headers</span>: <span class="kt">new</span> <span class="nx">HttpHeaders</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'multipart/form-data'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">Authorization</span><span class="o">:</span> <span class="s1">'au9mtPT3WwkDxfs'</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 指定要返回的响应内容（联合类型：'body'|'events'|'response'）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">observe</span><span class="o">:</span> <span class="s1">'body'</span> <span class="kr">as</span> <span class="kr">const</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 查询参数，会被 encode 进 URL 中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">params</span>: <span class="kt">new</span> <span class="nx">HttpParams</span><span class="p">({}),</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 是否回报请求进度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">reportProgress</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 指定返回数据的格式（联合类型：'arraybuffer'|'blob'|'json'|'text'）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">responseType</span><span class="o">:</span> <span class="s1">'json'</span> <span class="kr">as</span> <span class="kr">const</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">withCredentials</span>: <span class="kt">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">getConfig</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">environment</span><span class="p">.</span><span class="nx">apiHost</span><span class="si">}</span><span class="sb">/api/v1`</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">params</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">retry</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="c1">// 如果请求失败，最多重复请求三次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">catchError</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleError</span><span class="p">)</span> <span class="c1">// 错误处理函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">updateConfig</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="sb">`</span><span class="si">${</span><span class="nx">environment</span><span class="p">.</span><span class="nx">apiHost</span><span class="si">}</span><span class="sb">/api/v1`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">body</span> <span class="cm">/* 请求体 */</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">options</span> <span class="cm">/* 请求选项 */</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modifyConfig</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="sb">`</span><span class="si">${</span><span class="nx">environment</span><span class="p">.</span><span class="nx">apiHost</span><span class="si">}</span><span class="sb">/api/v1`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">body</span> <span class="cm">/* 请求体 */</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">options</span> <span class="cm">/* 请求选项 */</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">deleteConfig</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">environment</span><span class="p">.</span><span class="nx">apiHost</span><span class="si">}</span><span class="sb">/api/v1`</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">params</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">throwError</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="特殊标签">特殊标签</h2><p>&lt;ng-container/&gt;，类似于 Vue 模版中的 &lt;template/&gt; 或者 React.Fragment；无实际意义，用来对模板片段按照展示逻辑进行<strong>分组</strong>：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- ng-container 最常使用的场景就是和 *ngFor 搭配 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">nz-select</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">ng-container</span> <span class="err">*</span><span class="na">ngFor</span><span class="o">=</span><span class="s">"let item of branchList"</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">nz-option</span>
</span></span><span class="line"><span class="cl">      <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">"item.show"</span>
</span></span><span class="line"><span class="cl">      <span class="err">[</span><span class="na">nzValue</span><span class="err">]="</span><span class="na">item</span><span class="err">.</span><span class="na">brabank_id</span><span class="err">"</span>
</span></span><span class="line"><span class="cl">      <span class="err">[</span><span class="na">nzLabel</span><span class="err">]="</span><span class="na">item</span><span class="err">.</span><span class="na">brabank_name</span><span class="err">"</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&lt;/</span><span class="nt">nz-option</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">ng-container</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">nz-select</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>&lt;ng-template/&gt;，用来<strong>定义</strong>（声明）模版片段；默认情况下，定义的模版片段不会直接渲染，需要指定渲染的位置；一般配合结构性指令使用：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- 当 seconds 被重置时，会条件渲染 #actionResendSMS 片段 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">ng-container</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">"seconds !== 0; else actionResendSMS"</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>接受短信大约需要 {{ seconds }} 秒<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">ng-container</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">ng-template</span> <span class="err">#</span><span class="na">actionResendSMS</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">a</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">handleSendSMS</span><span class="err">()"</span><span class="p">&gt;</span>重新获取验证码<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">ng-template</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>&lt;ng-container/&gt; 搭配 &lt;ng-template/&gt; 可以构造<strong>作用域插槽</strong>，实现逻辑与 UI 的分离，从而实现逻辑复用：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// 封装逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'app-user-list-slot'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;ng-container
</span></span></span><span class="line"><span class="cl"><span class="sb">      *ngTemplateOutlet="userListSlot; context: temp"
</span></span></span><span class="line"><span class="cl"><span class="sb">    &gt;&lt;/ng-container&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">UserListSlotComponent</span> <span class="kr">implements</span> <span class="nx">OnChange</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 通过 userListSlot 指向一段 HTML 片段
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 可以使用 @ContentChild(TemplateRef)
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 那样无需我们指定“投射内容”
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 标签包含的所有 HTML
</span></span></span><span class="line"><span class="cl"><span class="cm">   * 都是“投射内容”
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Input</span><span class="p">()</span> <span class="nx">userListSlot</span>: <span class="kt">TemplateRef</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Input</span><span class="p">()</span> <span class="nx">formatFn</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Input</span><span class="p">()</span> <span class="nx">groupId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@Output</span><span class="p">()</span> <span class="nx">updated</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">temp</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">loading</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">list</span><span class="o">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">apiService</span>: <span class="kt">ApiService</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnChanges</span><span class="p">(</span><span class="nx">changes</span>: <span class="kt">SimpleChanges</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">changes</span><span class="o">?</span><span class="p">.</span><span class="nx">groupId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">fetchUserList</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fetchUserList() {</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">temp</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">apiService</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">getUserList</span><span class="p">({</span> <span class="nx">groupId</span>: <span class="kt">this.groupId</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">subscribe</span><span class="p">(({</span> <span class="nx">success</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">this</span><span class="p">.</span><span class="nx">temp</span><span class="p">.</span><span class="nx">list</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">formatFn</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">temp</span><span class="p">.</span><span class="nx">list</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">temp</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">updated</span><span class="p">.</span><span class="nx">emit</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="p">...</span><span class="nx">temp</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">originalData</span>: <span class="kt">data</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 使用插槽
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;div&gt;...&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;app-user-list-slot
</span></span></span><span class="line"><span class="cl"><span class="sb">      [userListSlot]="userListTemplate"
</span></span></span><span class="line"><span class="cl"><span class="sb">      [formatFn]="userListFormatter"
</span></span></span><span class="line"><span class="cl"><span class="sb">      [groupId]="groupId"
</span></span></span><span class="line"><span class="cl"><span class="sb">      (updated)="(handleUserListUpdated)"
</span></span></span><span class="line"><span class="cl"><span class="sb">    &gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;ng-template
</span></span></span><span class="line"><span class="cl"><span class="sb">        #userListTemplate
</span></span></span><span class="line"><span class="cl"><span class="sb">        let-userList="list"
</span></span></span><span class="line"><span class="cl"><span class="sb">        let-loadingUserList="loading"
</span></span></span><span class="line"><span class="cl"><span class="sb">      &gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;nz-select [nzLoading]="loadingUserList"&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;nz-option
</span></span></span><span class="line"><span class="cl"><span class="sb">            [nzValue]="option.id"
</span></span></span><span class="line"><span class="cl"><span class="sb">            [nzLabel]="option.name"
</span></span></span><span class="line"><span class="cl"><span class="sb">            *ngFor="let option of userList"
</span></span></span><span class="line"><span class="cl"><span class="sb">          &gt;&lt;/nz-option&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;/nz-select&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;/ng-template&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;/app-user-list-slot&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;div&gt;...&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">DormitoryConfigureComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">groupId</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">userListFormatter</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">handleUserListUpdated</span><span class="p">({</span> <span class="nx">originalData</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">originalData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>&lt;ng-content/&gt;，使用在组件内部，可以使组件<a class="link" href="https://angular.cn/guide/content-projection" target="_blank" rel="noopener">
“接受外部插入进来的内容”
</a>，相当于 Vue 模版中的 &lt;slot/&gt;：</p><ol><li>Angular 中并没有“<strong>具名插槽</strong>”的概念，但是 &lt;ng-content/&gt; 有一个 select 属性（CSS 选择器，不支持变量），可以起到对外部插入的内容进行<strong>过滤</strong>的作用；</li><li>相比于 &lt;router-outlet/&gt;，&lt;ng-content/&gt; 展示的内容是由<strong>外部插入</strong>的，&lt;router-outlet/&gt; 展示的内容是由路由表<strong>指定</strong>的；</li><li>如果你的组件包含不带 select 属性的 &lt;ng-content/&gt; 元素，则该实例将接收所有与其他 &lt;ng-content/&gt; 元素都不匹配的投影组件。</li></ol><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- 例如，nz-button 的 template --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">i</span> <span class="na">nz-icon</span> <span class="na">nzType</span><span class="o">=</span><span class="s">"loading"</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">"nzLoading"</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">ng-content</span><span class="p">&gt;&lt;/</span><span class="nt">ng-content</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- 使用时 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">nz-button</span><span class="p">&gt;</span>例子<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">  渲染的结果，“例子”会被插入到 ng-content
</span></span></span><span class="line"><span class="cl"><span class="c">  当作 Vue 中的“具名插槽”理解就好
</span></span></span><span class="line"><span class="cl"><span class="c">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">nz-button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">i</span> <span class="na">nz-icon</span> <span class="na">nzType</span><span class="o">=</span><span class="s">"loading"</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">"nzLoading"</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  例子
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="特殊选择器">特殊选择器</h2><ul><li>::ng-deep、/deep/、&gt;&gt;&gt;，将样式应用到全局；所以请在 ::ng-deep 之前带上 :host，防止污染全局样式；</li><li>:host、:host(condition)，宿主元素选择器/当“宿主元素”满足 condition 时；</li><li>:host-context(condition)，当“宿主的祖先元素”满足 condition 时。</li></ul><h2 id="contentchild-与-viewchild">ContentChild 与 ViewChild</h2><p>@ViewChild() 从当前<strong>组件模版中</strong>获取组件对象（Vue/React 中 ref 的功能）：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'user-list'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="s1">'&lt;nz-spin&gt;&lt;form #form&gt;&lt;/form&gt;&lt;user-detail&gt;&lt;/user-detail&gt;&lt;/nz-spin&gt;'</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">UserListComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">AfterViewInit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@ViewChild</span><span class="p">(</span><span class="nx">NzSpinComponent</span><span class="p">)</span> <span class="nx">nzSpinRef</span>: <span class="kt">NzSpinComponent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@ViewChild</span><span class="p">(</span><span class="s1">'form'</span><span class="p">)</span> <span class="nx">formRef</span>: <span class="kt">ElementRef</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 在 ngOnInit 钩子中是获取不到的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nzSpinRef</span><span class="p">);</span> <span class="c1">// undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">formRef</span><span class="p">);</span> <span class="c1">// undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngAfterViewInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 通过 ViewChild 从当前模版中获取组件实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nzSpinRef</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">formRef</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>@ContentChild() 从**当前组件模版的外部投射进来的内容（类似 React 中的 props.children）**中获取组件对象：</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'user-list'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'&lt;user-detail&gt;&lt;span #span&gt;用户交易&lt;/span&gt;&lt;user-trade&gt;&lt;/user-trade&gt;&lt;/user-detail&gt;'</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">UserListComponent</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">selector</span><span class="o">:</span> <span class="s1">'user-detail'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"&lt;h2&gt;用户详情&lt;/h2&gt;&lt;div class='user-detail'&gt;&lt;ng-content&gt;&lt;/ng-content&gt;&lt;/div&gt;"</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">UserDetailComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">AfterViewInit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@ContentChild</span><span class="p">(</span><span class="s1">'span'</span><span class="p">)</span> <span class="nx">spanRef</span>: <span class="kt">ElementRef</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@ContentChild</span><span class="p">(</span><span class="nx">UserTradeComponent</span><span class="p">)</span> <span class="nx">userTradeRef</span>: <span class="kt">UserTradeComponent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 在 ngOnInit 钩子中是获取不到的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">spanRef</span><span class="p">);</span> <span class="c1">// undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">userTradeRef</span><span class="p">);</span> <span class="c1">// undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngAfterViewInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 从 ng-content 中获取组件/DOM 元素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">spanRef</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">userTradeRef</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>说明：</p><ul><li>ContentChild 和 ViewChild 指向的类型不同（一个在当前模版中查找，一个在当前模版的外部投射内容中查找）；</li><li>ViewChild 对应的是 ngAfterViewInit、ngAfterViewChecked；</li><li>ContentChild 对应的是 ngAfterContentInit、ngAfterContentChecked；</li><li>AfterView 关心的是 ViewChildren，ViewChildren 的元素标签会出现在当前组件的模版中；</li><li>AfterContent 关心的是 ContentChildren，ContentChildren 被投射进当前组件中。</li></ul><h2 id="changedetectorref">ChangeDetectorRef</h2><p>首先，每个组件都有自己的变更检测器，一个应用包含多个组件，组件之间的层级关系形成了“组件树”。</p><p>Angular 的默认检测机制是：当一个组件发生变更时，无论它在组件树的什么位置，都会触发树中的所有的变更检测器；Ng 会从“自顶向下”，扫描树所有节点。</p><p>ChangeDetectorRef 为组件实例提供了<strong>自定义变更检测功能</strong>，可以将组件从<strong>变更检测树</strong>中添加或删除；ChangeDetectorRef 提供了五个方法：</p><ol><li>markForCheck()，在 ChangeDetectionStrategy.OnPush 策略下，将视图标记为“需要变更检测”；</li><li>detach()，将组件从<strong>变更检测树</strong>中<strong>删除</strong>，在 reattach 被调用之前，不会再进行变更检测；</li><li>reattach()，将之前被 detach 的组件<strong>添加</strong>到<strong>变更检测树</strong>中；</li><li>checkNoChanges()，对该视图及其子视图进行变更检测，如有变化，报异常（仅在开发环境有效）；</li><li>detectChanges()，对该视图及其子视图<strong>手动</strong>进行一次变更检测。</li></ol><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">DataListProvider</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">get</span> <span class="nx">data() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 假设数据量很大，并且变化频繁
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;li *ngFor="let item of dataProvider.data"&gt;{{ item }}&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">GiantList</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">ref</span>: <span class="kt">ChangeDetectorRef</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">dataProvider</span>: <span class="kt">DataListProvider</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 放弃 Ng 的变更检测策略
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">ref</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 间隔 5 秒手动进行变更检测，提高应用性能
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">ref</span><span class="p">.</span><span class="nx">detectChanges</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>在开发的过程中，可能会遇到**<a class="link" href="https://angular.cn/errors/NG0100" target="_blank" rel="noopener">
NG100 错误
</a>**，特别是在 ngAfterViewInit 钩子中执行“手动”渲染操作时；原因是，在开发模式下，每次"变更检测"后，都会执行一次"附加检查"，如果在附加检查过程中，视图和"变更检测"后的视图不一致，会报 NG100 错误。</p><p>解决方法是，将同步渲染逻辑改为异步（宏任务、微任务均可），或者同步调用 detectChanges 重新进行变更检测。</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;ng-container #vcf&gt;&lt;/ng-container&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">CodesComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">AfterViewInit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@ContentChild</span><span class="p">(</span><span class="nx">TemplateRef</span><span class="p">)</span> <span class="nx">content</span>: <span class="kt">TemplateRef</span><span class="p">&lt;</span><span class="nt">any</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">@ViewChild</span><span class="p">(</span><span class="s1">'vcf'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">read</span>: <span class="kt">ViewContainerRef</span> <span class="p">})</span> <span class="nx">vcf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">list</span>: <span class="kt">CodeItem</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">cdf</span>: <span class="kt">ChangeDetectorRef</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">ngOnInit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ngAfterViewInit() {</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">?</span><span class="p">.</span><span class="nx">vcf</span><span class="o">?</span><span class="p">.</span><span class="nx">createEmbeddedView</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">handleChecked</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleChecked</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">$implicit</span>: <span class="kt">this.list</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 渲染完后，进行一次变更检测
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">cdf</span><span class="p">.</span><span class="nx">detectChanges</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="aot-与-jit">AOT 与 JIT</h2><p>组件和模版需要经过编译，才能在浏览器中运行；Angular 提供了两种编译方式：</p><ul><li>Ahead-Of-Time 预编译（在打包/构建时编译，Angular 9 之后）：<ul><li>和别的模版一样，*.vue 和 *.jsx 也需要进行编译才能在浏览器中运行；</li><li>可以尽早地检测到代码中的错误，用户体验更有保障；</li><li>省去了在运行时编译的开销，应用响应更快；</li><li>减少了受 XSS 攻击的风险；</li><li>可以减小应用的体积。</li></ul></li><li>Just-In-Time 即时编译（在运行时编译，Angular 9 之前）：<ul><li>代码修改之后不需要重新编译，编译会在代码执行之前进行（按需编译）；</li><li>编译工作大多在浏览器内部进行，编译时间更短；</li><li>在项目中，较少被用到的组件更适合即时编译。</li></ul></li></ul><p>AOT 预编译分为三个阶段：</p><ol><li>代码分析：收集元数据并检验元数据中的错误：<ul><li>被收集的元数据存在于类装饰器/构造函数中；</li><li>AOT 收集器会根据 TS 编译器生成的 *.d.ts 输出 *.metadata.json；</li><li>*.metadata.json 包括了全部装饰器的元数据，结构就像 AST 一样；</li><li>AOT 编译器不支持“箭头函数”，所以不要在元数据中使用“() =&gt; {}”。</li></ul></li><li>代码生成：解释元数据（*.metadata.json），并对含有 useClass、useValue、useFactory 和 data 的对象字面量进行特殊处理（元数据重写）；</li><li>模版类型检查：TS 编译器会验证模版中绑定的表达式。</li></ol><p>JIT 编译器可以替代 AOT 编译器，在“运行时”将模板编译（需要将 compiler 打包）为浏览器中的可执行模板代码。</p><h2 id="安全">安全</h2><p>为了防范 XSS，Angular 认为所有值都是不可信任的；任何值在插入 DOM 之前，都会被进行“无害化”处理（前提是使用 Angular 模版，如果在代码中直接使用 DOM API，将没有“无害化”处理）。</p><p>Angular 定义了四个安全上下文：</p><ul><li>HTML：被解释为 HTML 的值，例如被绑定到 innerHTML 的值；</li><li>CSS：作为 CSS 被绑定到 style 属性的值；</li><li>网址：作为 URL 使用的值，例如被绑定到 a 标签 href 属性的值；</li><li>资源：作为代码需要被下载并运行的值，例如被绑定到 script 标签 src 属性的值。</li></ul><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;!-- {{ 插值中的内容总会被“无害化”}} --&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;p class="e2e-inner-html-interpolated"&gt;{{ htmlSnippet }}&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;!--
</span></span></span><span class="line"><span class="cl"><span class="sb">      绑定到 innerHTML 属性上的值，默认被认为是“不安全”的
</span></span></span><span class="line"><span class="cl"><span class="sb">      会被自动进行“无害化”
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;script&gt; 会被移除
</span></span></span><span class="line"><span class="cl"><span class="sb">    --&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;p class="e2e-inner-html-bound" [innerHTML]="htmlSnippet"&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">InnerHtmlComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">htmlSnippet</span> <span class="o">=</span> <span class="s1">'&lt;script&gt;alert("...")&lt;/script&gt;&lt;b&gt;Syntax&lt;/b&gt;'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><p>如果某个值被确认是可信的，可以通过 <a class="link" href="https://angular.cn/api/platform-browser/DomSanitizer" target="_blank" rel="noopener">DomSanitizer
</a>将这个值标记为安全值，安全的值将不会被进行“无害化”。</p><p>DomSanitizer 提供了六种方法：</p><ul><li>sanitize(context, value)：根据给定的安全上下文 context，对 value 进行“无害化”；</li><li>bypassSecurityTrustHtml(value)：信任给定的值 value 是一个安全的 HTML；</li><li>bypassSecurityTrustStyle(value)：信任给定的值 value 是一个安全的样式；</li><li>bypassSecurityTrustScript(value)：信任给定的值 value 是一个安全的 JS；</li><li>bypassSecurityTrustUrl(value)：信任给定的值 value 是一个安全的 URL；</li><li>bypassSecurityTrustResourceUrl(value)：信任给定的值 value 是一个安全的资源。</li></ul><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">@Component</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;h4&gt;自动无害化处理&lt;/h4&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;p&gt;&lt;a [href]="dangerousUrl"&gt;Click Me&lt;/a&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;h4&gt;不会进行无害化处理&lt;/h4&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;p&gt;&lt;a [href]="trustedUrl"&gt;Click Me&lt;/a&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  `</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">BypassSecurityTrustComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">sanitizer</span>: <span class="kt">DomSanitizer</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dangerousUrl</span> <span class="o">=</span> <span class="s1">'javascript:alert("Hello")'</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">trustUrl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sanitizer</span><span class="p">.</span><span class="nx">bypassSecurityTrustUrl</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dangerousUrl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="参考">参考</h2><ul><li><a class="link" href="https://dev.to/christiankohler/improved-dependeny-injection-with-the-new-providedin-scopes-any-and-platform-30bb" target="_blank" rel="noopener">Improved Dependency Injection With The New ProvidedIn Scopes ‘any’ And ‘platform’</a></li><li><a class="link" href="https://juejin.cn/post/7012492445506093092" target="_blank" rel="noopener">深入理解 Angular 依赖注入（二）：依赖注入在 Angular 中的应用</a></li><li><a class="link" href="https://limeii.github.io/2019/06/angular-changeDetectionStrategy-OnPush" target="_blank" rel="noopener">Angular Change Detection：变更检测策略</a></li><li><a class="link" href="https://www.geeksforgeeks.org/what-is-aot-and-jit-compiler-in-angular" target="_blank" rel="noopener">What Is AOT And JIT Compiler In Angular?</a></li><li><a class="link" href="https://juejin.cn/post/6869995328330792968" target="_blank" rel="noopener">ng-template、ng-content、ng-container</a></li><li><a class="link" href="https://www.cnblogs.com/laixiangran/p/8723166.html" target="_blank" rel="noopener">使用 ng-content 进行组件内容投射</a></li><li><a class="link" href="https://blog.kevinyang.net/2018/01/19/angular-viewproviders-providers" target="_blank" rel="noopener">viewProviders vs providers</a></li></ul></section><footer class="article-footer"><section class="article-not-by-ai-badge"><a href="https://notbyai.fyi/cn/" target="_blank" title="Not By AI"><svg width="131" height="42" viewBox="0 0 131 42" fill="none"><path d="M.5.5H116c8.008.0 14.5 6.49187 14.5 14.5V41.5H15C6.99187 41.5.5 35.0081.5 27V.5z" fill="#fff" stroke="#000"></path><path d="M17.9605 24.1575c3.4661 2.8068 8.4231 2.8068 11.8892.0l-1.3402-1.6549c-2.6847 2.174-6.5241 2.174-9.2088.0l-1.3402 1.6549z" fill="#000"></path><path d="M19.404 20.5134V17.6365h2.1296v2.8769H19.404z" fill="#000"></path><path d="M26.012 17.6365v2.8769h2.1295V17.6365H26.012z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M35 21.5C35 27.8513 29.8513 33 23.5 33S12 27.8513 12 21.5C12 15.1487 17.1487 10 23.5 10S35 15.1487 35 21.5zm-2.1295.0c0 5.1752-4.1953 9.3705-9.3705 9.3705S14.1295 26.6752 14.1295 21.5s4.1953-9.3705 9.3705-9.3705 9.3705 4.1953 9.3705 9.3705z" fill="#000"></path><path d="M61.844 12.1721l.1995.711L62.2294 12.8197C62.5169 12.7216 62.8276 12.6155 63.1503 12.5052v2.55C63.1503 15.1818 63.1005 15.2208 62.9709 15.2208 62.8612 15.2208 62.4922 15.2208 62.0634 15.211 62.1631 15.4156 62.2628 15.7273 62.2928 15.9123 62.901 15.9123 63.28 15.8929 63.5293 15.776 63.7686 15.6591 63.8583 15.4545 63.8583 15.0455V12.2629C64.2106 12.1421 64.5673 12.0195 64.9154 11.8994L64.8057 11.2273C64.4898 11.3348 64.1706 11.4415 63.8583 11.5441V9.63961H64.8057V8.95779H63.8583V7H63.1503V8.95779H61.9936v.68182h1.1567V11.7732C62.6577 11.9301 62.2064 12.0683 61.844 12.1721z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M66.0322 10.7695C65.3142 10.7695 65.1347 10.5162 65.1347 9.8052V7.39935h2.6127V9.32792H65.763V9.81494C65.763 10.1169 65.8128 10.2045 66.0322 10.2045H67.2986C67.4781 10.2045 67.7474 10.1948 67.9069 10.1656 67.9134 10.2165 67.92 10.2777 67.9268 10.3422 67.941 10.4754 67.9566 10.6224 67.9767 10.7208 67.8371 10.7597 67.5779 10.7695 67.3086 10.7695H66.0322zM65.763 7.90584H67.1391V8.82143H65.763V7.90584z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M69.0736 10.7208C68.3656 10.7208 68.1861 10.4773 68.1861 9.76623V7.39935H70.8087V9.2987H68.8144V9.77597C68.8144 10.0682 68.8642 10.1656 69.0936 10.1656h1.3262C70.5993 10.1656 70.8985 10.1461 71.058 10.1071 71.068 10.2825 71.0979 10.5357 71.1179 10.6721 70.9783 10.7208 70.709 10.7208 70.4298 10.7208H69.0736zM68.8144 7.90584h1.396v.88637h-1.396V7.90584z" fill="#000"></path><path d="M66.83 14.1299C66.2715 14.6753 65.3142 15.1818 64.4567 15.5032 64.6262 15.6201 64.9054 15.8539 65.035 15.9805 65.8727 15.6104 66.8898 14.9968 67.5081 14.3831L66.83 14.1299z" fill="#000"></path><path d="M68.4554 14.4513C69.2132 14.9091 70.1905 15.5812 70.6791 16L71.2974 15.6104C70.7788 15.1818 69.7916 14.539 69.0437 14.1007L68.4554 14.4513z" fill="#000"></path><path d="M50.4761 15.9318C49.798 15.5617 48.6612 15.0942 47.5344 14.7338L48.0031 14.2468C49.1299 14.5974 50.3564 15.0552 51.0844 15.4253L50.4761 15.9318z" fill="#000"></path><path d="M42 15.4156C43.067 15.1623 44.4032 14.6656 45.0713 14.2468L45.7594 14.6753C44.9218 15.1721 43.5855 15.6786 42.5185 15.9513 42.4088 15.8052 42.1596 15.5519 42 15.4156z" fill="#000"></path><path d="M56.1556 7.21693C56.1571 7.15007 56.1585 7.0868 56.1601 7.02922H56.9877L56.9868 7.0714C56.9788 7.4194 56.968 7.88942 56.9233 8.43665 57.0639 9.58208 57.6711 13.7136 61.2258 15.2597 61.0064 15.4253 60.787 15.6786 60.6773 15.8831c-2.5071-1.144-3.5872-3.5484-4.0775-5.3684C56.13 12.4644 55.0681 14.6445 52.63 15.9221 52.5004 15.7273 52.2511 15.5032 52.0217 15.3474c3.9976-1.9757 4.0968-6.45452 4.1339-8.13047z" fill="#000"></path><path d="M75.0586 9.43506C75.1376 9.06022 75.2116 8.69288 75.2761 8.3539L74.5283 8.27597C74.3089 9.50325 73.9299 11.1688 73.6408 12.1623L74.3986 12.2305C74.4264 12.1301 74.4552 12.0226 74.4848 11.9091H78.3699C78.3296 12.3408 78.2883 12.7224 78.2455 13.0584H72.0851V13.7403h6.0611C78.0034 14.5883 77.8408 15.0239 77.6395 15.1916 77.5198 15.289 77.4002 15.2987 77.1708 15.2987 76.9215 15.2987 76.2334 15.2987 75.5454 15.2305 75.675 15.4253 75.7747 15.7175 75.7947 15.9221 76.4429 15.961 77.091 15.9708 77.4201 15.9513 77.799 15.9318 78.0284 15.8636 78.2677 15.6396 78.532 15.3814 78.7263 14.8409 78.8969 13.7403H81V13.0584H78.991C79.0434 12.6344 79.0943 12.1472 79.1452 11.5877 79.1552 11.4805 79.1751 11.2565 79.1751 11.2565H74.6483C74.7379 10.8862 74.8303 10.4846 74.92 10.0779H79.2948V9.43506H75.0586z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M65.1746 11.6266V12.25H66.5109v1.1299H64.7558v.6233H71.1079v-.6233H69.5523V12.25h1.3262v-.6234H69.5523v-.6623H68.8642v.6623H67.189V10.9838H66.5109V11.6266H65.1746zm2.0144 1.7533V12.25h1.6752v1.1299H67.189z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M42.1895 14.0909v-.6234h1.4359V9.06494h2.5129V8.4513H42.4687V7.81818h3.6696V7.00974H46.8762v.80844H50.7852V8.4513H46.8762v.61364h2.7623V13.4675h1.406v.6234h-8.855zm2.1539-.6234h4.5472V12.7857H44.3434V13.4675zm0-1.1493h4.5472V11.7338H44.3434V12.3182zm0-1.0617h4.5472v-.5747H44.3434v.5747zm0-1.0325h4.5472V9.58117H44.3434V10.224z" fill="#000"></path><path d="M72.3245 9.65909V7.52597h8.4362V9.65909H79.9829V8.20779H73.0624v1.4513H72.3245z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M105.32 26.2505C105.32 25.9898 105.336 25.4196 105.336 25.4196H101.424V23.8717H105.573C105.764 26.2238 106.11 28.471 106.651 30.2984c-.875.9892-1.892 1.8173-3.039 2.4531C104.107 33.2077 104.953 34.2016 105.288 34.7067 106.138 34.1597 106.93 33.5082 107.658 32.7639 108.338 33.9391 109.193 34.6415 110.254 34.6415 111.898 34.6415 112.649 33.9572 113 30.78 112.377 30.5356 111.563 29.9817 111.036 29.4277 110.956 31.4155 110.765 32.2301 110.445 32.2301 110.06 32.2301 109.67 31.686 109.312 30.7655 110.465 29.1244 111.389 27.1985 112.058 25.0611L109.711 24.4908C109.396 25.6095 108.983 26.659 108.478 27.6243 108.264 26.4884 108.09 25.2105 107.974 23.8717h4.866V21.5418H111.142L111.946 20.6945C111.387 20.1568 110.27 19.4399 109.455 19l-1.405 1.4175C108.553 20.7329 109.148 21.1437 109.647 21.5418H107.835C107.811 20.7923 107.808 20.0385 107.827 19.2933h-2.443C105.387 20.0364 105.403 20.7892 105.433 21.5418H98.9812v4.8879C98.9812 28.5642 98.9014 31.4481 97.7199 33.3707 98.2468 33.6477 99.3006 34.5275 99.6997 35 100.514 33.7498 100.957 32.0088 101.189 30.2753 101.506 30.8638 101.745 31.7506 101.775 32.4257 102.51 32.4257 103.18 32.4094 103.612 32.3279 104.091 32.2301 104.458 32.0672 104.809 31.5947 105.192 31.0733 105.272 29.5743 105.32 26.2505zM101.197 30.2141C101.316 29.3052 101.378 28.4 101.406 27.5703h1.652C103.023 29.1922 102.963 29.8644 102.829 30.0631 102.701 30.2261 102.558 30.2749 102.35 30.2749 102.102 30.2749 101.674 30.2596 101.197 30.2141z" fill="#000"></path><path d="M86.8673 22.112C87.1314 21.4187 87.3672 20.705 87.565 19.9939L85.1541 19.4399C84.6112 21.6395 83.5893 23.8717 82.3599 25.2077 82.9507 25.5336 83.9885 26.2342 84.4515 26.6415 84.9297 26.0332 85.4007 25.2744 85.839 24.4257h3.0672v2.4928H84.7709v2.2811h4.1353V32.002H82.8708v2.3137H97.4005V32.002H91.3332V29.1996H95.9156V26.9185H91.3332V24.4257H96.5543V22.112H91.3332V19.277H88.9062v2.835H86.8673z" fill="#000"></path><path d="M47.3436 28.4645C47.4377 28.0285 47.4856 27.6141 47.4988 27.2444H43.8462V25.11h3.6564V23.4807h-3.816V21.2811h3.816V19.3585h2.2992V27c0 2.8513-.862200000000001 6.0611-4.774 7.9837C44.6446 34.4134 43.9261 33.6802 43.3672 33.224 44.7784 32.6761 45.7414 31.786 46.3804 30.8057 45.6568 30.9237 44.9507 31.0375 44.2921 31.1436L43.4151 31.2851 43 28.9226C44.1273 28.8236 45.7056 28.6496 47.3436 28.4645z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M72.6755 34.3305 67.632 19.7976H64.2697L59.1875 34.3305h3.1111L63.2841 31.3431H68.5306l.9178 2.9874H72.6755zM65.9218 23.1202l1.7778 5.7186H64.0861l1.8357-5.7186z" fill="#000"></path><path d="M53.7456 19.3585v1.9226h4.1833v2.1996H53.7456V25.11H57.5457v2.1344H53.7456v1.6619H58.2163v2.1996H53.7456v3.6497H51.4144V19.3585h2.3312z" fill="#000"></path><path d="M75.2125 22.2696v9.5922H73.4582v2.4721H79.719V31.8618h-1.55V22.2696h1.55v-2.472H73.4582v2.472h1.7543z" fill="#000"></path></svg></a></section></footer></article><aside class="related-content--wrapper"><h2 class="section-title">相关文章</h2><div class="related-content"><div class="flex article-list--tile"><article class="has-image"><a href="/p/angular-%E8%B7%AF%E7%94%B1%E5%A4%8D%E7%94%A8/"><div class="article-image"><img src="/img/cover/angular.png" loading="lazy" data-key="" data-hash="/img/cover/angular.png" alt="" decoding="async" width="1200" height="720" jampack-sized="true"></div><div class="article-details"><h2 class="article-title">Angular 路由复用</h2></div></a></article><article class="has-image"><a href="/p/%E5%B0%81%E8%A3%85-prosearch-%E4%B8%8E-protable-%E7%BB%84%E4%BB%B6/"><div class="article-image"><img src="/img/cover/angular.png" loading="lazy" data-key="" data-hash="/img/cover/angular.png" alt="" decoding="async" width="1200" height="720" jampack-sized="true"></div><div class="article-details"><h2 class="article-title">封装 ProSearch 与 ProTable 组件</h2></div></a></article><article class="has-image"><a href="/p/angular-%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/"><div class="article-image"><img src="/img/cover/angular.png" loading="lazy" data-key="" data-hash="/img/cover/angular.png" alt="" decoding="async" width="1200" height="720" jampack-sized="true"></div><div class="article-details"><h2 class="article-title">Angular 组件设计</h2></div></a></article></div></div></aside><footer class="site-footer"><section class="copyright" style="display:flex;justify-content:flex-start;align-items:center">©
2017 -
2025
<a href="https://github.com/ElementRef" target="_blank">馬腊咯稽
</a><a href="https://ipw.cn/ipv6webcheck/?site=elementref.github.io" target="_blank" title="本站支持 IPv6 访问"><img style="display:inline-block;vertical-align:middle" src="https://static.ipw.cn/icon/ipv6-certified-lite-s1.svg" alt="本站支持 IPv6 访问" loading="lazy" decoding="async"></a></section><section class="powerby">Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>, Deploy by Actions<br>主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.13.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计</section></footer><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="关闭"></button>
<button class="pswp__button pswp__button--fs" title="全屏"></button>
<button class="pswp__button pswp__button--zoom" title="缩放"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="上一张"></button>
<button class="pswp__button pswp__button--arrow--right" title="下一张"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js" integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin="anonymous" defer=""></script><script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin="anonymous" defer=""></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css" crossorigin="anonymous"></main><aside class="sidebar sticky right-sidebar"><section class="archives widget"><div class="widget-icon"><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><line x1="5" y1="9" x2="19" y2="9"></line><line x1="5" y1="15" x2="19" y2="15"></line><line x1="11" y1="4" x2="7" y2="20"></line><line x1="17" y1="4" x2="13" y2="20"></line></svg></div><h2 class="section-title widget-title">目录</h2><div class="widget--toc"><nav id="TableOfContents"><ol><li><a href="#组件">组件</a></li><li><a href="#指令没有模版的特殊组件">指令（没有“模版”的特殊组件）</a></li><li><a href="#管道">管道</a></li><li><a href="#服务">服务</a></li><li><a href="#模块">模块</a></li><li><a href="#表单">表单</a></li><li><a href="#路由">路由</a></li><li><a href="#依赖注入">依赖注入</a></li><li><a href="#双向绑定">双向绑定</a></li><li><a href="#绑定语法">绑定语法</a></li><li><a href="#模版变量">模版变量</a></li><li><a href="#网络请求">网络请求</a></li><li><a href="#特殊标签">特殊标签</a></li><li><a href="#特殊选择器">特殊选择器</a></li><li><a href="#contentchild-与-viewchild">ContentChild 与 ViewChild</a></li><li><a href="#changedetectorref">ChangeDetectorRef</a></li><li><a href="#aot-与-jit">AOT 与 JIT</a></li><li><a href="#安全">安全</a></li><li><a href="#参考">参考</a></li></ol></nav></div></section></aside></div><script src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js" integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin="anonymous"></script><script type="text/javascript" src="/ts/main.js" defer=""></script><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><script>NProgress.configure({showSpinner:!1}),NProgress.start(),document.addEventListener("readystatechange",()=>{document.readyState==="interactive"&&NProgress.inc(.8),document.readyState==="complete"&&NProgress.done()})</script></body></html>